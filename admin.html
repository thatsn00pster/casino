<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moon Casino - Admin Panel</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary: #8b5cf6;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg-dark: #0b0e14;
            --bg-panel: #161b26;
            --border: #2a3042;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Space Grotesk', sans-serif;
            background: linear-gradient(135deg, #0f0b1f 0%, #1a1035 100%);
            color: #fff;
            min-height: 100vh;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(11, 14, 20, 0.5);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #8b5cf6, #10b981);
            border-radius: 4px;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Stats Cards */
        .stats-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.9));
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .stats-card:hover {
            transform: translateY(-2px);
            border-color: #8b5cf6;
            box-shadow: 0 10px 25px rgba(139, 92, 246, 0.2);
        }
        
        .stats-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #8b5cf6, #10b981);
        }
        
        /* Data Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(30, 41, 59, 0.8);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .data-table th {
            background: linear-gradient(135deg, #1e293b, #0f172a);
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            color: #8b5cf6;
            border-bottom: 2px solid #334155;
        }
        
        .data-table td {
            padding: 12px 16px;
            border-bottom: 1px solid #334155;
            color: #cbd5e1;
        }
        
        .data-table tr:hover {
            background: rgba(139, 92, 246, 0.1);
        }
        
        /* Modal */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease-out;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1e293b, #0f172a);
            border-radius: 16px;
            border: 1px solid #334155;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        /* Tabs */
        .tab-nav {
            display: flex;
            gap: 4px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 8px;
            padding: 4px;
            margin-bottom: 20px;
        }
        
        .tab-btn {
            flex: 1;
            padding: 12px 16px;
            background: transparent;
            border: none;
            color: #94a3b8;
            font-weight: 600;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .tab-btn:hover {
            background: rgba(139, 92, 246, 0.1);
            color: #cbd5e1;
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }
        
        /* Input Styles */
        .input-group {
            margin-bottom: 16px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 6px;
            color: #94a3b8;
            font-size: 14px;
            font-weight: 500;
        }
        
        .input-group input,
        .input-group select,
        .input-group textarea {
            width: 100%;
            padding: 10px 14px;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid #334155;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .input-group input:focus,
        .input-group select:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }
        
        /* Button Styles */
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(139, 92, 246, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(245, 158, 11, 0.3);
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 14px;
        }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 16px 20px;
            background: #1e293b;
            border-radius: 12px;
            border: 1px solid #334155;
            color: white;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            z-index: 1001;
            transform: translateX(100px) scale(0.8);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-width: 400px;
        }
        
        .toast.show {
            transform: translateX(0) scale(1);
            opacity: 1;
        }
        
        .toast.success {
            border-color: #10b981;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), #1e293b);
        }
        
        .toast.error {
            border-color: #ef4444;
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), #1e293b);
        }
        
        .toast.warning {
            border-color: #f59e0b;
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), #1e293b);
        }
        
        /* Status Badges */
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }
        
        .status-active {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .status-banned {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .status-pending {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }
        
        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(139, 92, 246, 0.3);
            border-radius: 50%;
            border-top-color: #8b5cf6;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Chart Container */
        .chart-container {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #334155;
        }
        
        /* Search Box */
        .search-box {
            position: relative;
            margin-bottom: 20px;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 16px 12px 44px;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid #334155;
            border-radius: 8px;
            color: white;
            font-size: 14px;
        }
        
        .search-box i {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .pagination button {
            padding: 8px 16px;
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid #334155;
            border-radius: 6px;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .pagination button:hover {
            background: rgba(139, 92, 246, 0.1);
            color: white;
        }
        
        .pagination button.active {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            border-color: #8b5cf6;
        }
        
        /* Checkbox */
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            border-radius: 6px;
            transition: background-color 0.2s;
        }
        
        .checkbox-item:hover {
            background: rgba(139, 92, 246, 0.1);
        }
        
        .checkbox-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: #8b5cf6;
        }
        
        /* Bulk Action Bar */
        .bulk-action-bar {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(30, 41, 59, 0.95);
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 999;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .tab-nav {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: repeat(1, 1fr) !important;
            }
            
            .modal-content {
                width: 95%;
                padding: 16px;
            }
            
            .data-table {
                font-size: 14px;
            }
            
            .data-table th,
            .data-table td {
                padding: 8px 12px;
            }
            
            .bulk-action-bar {
                width: 95%;
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Toast Container -->
    <div id="toastContainer"></div>
    
    <!-- Bulk Action Bar (Initially hidden) -->
    <div id="bulkActionBar" class="bulk-action-bar hidden">
        <span id="selectedCount" class="text-white font-bold">0</span>
        <span class="text-gray-400">users selected</span>
        <div class="flex gap-2">
            <button onclick="adminApp.bulkDelete()" class="btn btn-danger btn-sm">
                <i class="fa-solid fa-trash"></i>
                Delete Selected
            </button>
            <button onclick="adminApp.bulkBan()" class="btn btn-warning btn-sm">
                <i class="fa-solid fa-ban"></i>
                Ban Selected
            </button>
            <button onclick="adminApp.bulkUnban()" class="btn btn-success btn-sm">
                <i class="fa-solid fa-check"></i>
                Unban Selected
            </button>
            <button onclick="adminApp.clearSelection()" class="btn btn-primary btn-sm">
                <i class="fa-solid fa-times"></i>
                Clear Selection
            </button>
        </div>
    </div>
    
    <!-- Admin Login Modal -->
    <div id="loginModal" class="modal active">
        <div class="modal-content p-8">
            <div class="text-center mb-8">
                <div class="w-20 h-20 rounded-full bg-gradient-to-br from-[#8b5cf6] to-[#4c1d95] flex items-center justify-center mx-auto mb-6 relative overflow-hidden">
                    <i class="fa-solid fa-lock text-white text-3xl relative z-10"></i>
                    <div class="absolute inset-0 bg-white/20"></div>
                </div>
                <h2 class="text-3xl font-bold text-white mb-3">Admin Panel</h2>
                <p class="text-gray-400">Enter admin credentials to continue</p>
            </div>
            
            <div class="space-y-6">
                <div>
                    <label class="text-sm text-gray-400 font-bold mb-2 block">Admin Key</label>
                    <input type="password" id="adminKey" class="w-full bg-gray-900 border border-gray-700 rounded-xl px-5 py-3.5 text-white focus:outline-none focus:border-[#8b5cf6] transition-all duration-300" placeholder="Enter admin key">
                </div>
                <button onclick="adminApp.login()" class="w-full bg-gradient-to-r from-[#8b5cf6] to-[#7c3aed] hover:from-[#7c3aed] hover:to-[#6d28d9] text-white py-3.5 rounded-xl font-bold text-lg tracking-wider transition-all duration-300">
                    <i class="fa-solid fa-sign-in-alt mr-2"></i> Login
                </button>
            </div>
            
            <div class="mt-6 text-center text-sm text-gray-500">
                <p>Default admin key: <code class="bg-gray-800 px-2 py-1 rounded">mooncasino2024</code></p>
            </div>
        </div>
    </div>
    
    <!-- Main Admin Panel (Hidden until login) -->
    <div id="adminPanel" class="hidden">
        <!-- Top Navbar -->
        <nav class="bg-gray-900 border-b border-gray-800 p-4 flex justify-between items-center sticky top-0 z-50">
            <div class="flex items-center gap-4">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-[#8b5cf6] to-[#4c1d95] flex items-center justify-center">
                        <i class="fa-solid fa-shield-alt text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-white">Moon Casino Admin</h1>
                        <p class="text-sm text-gray-400">Premium Control Panel</p>
                    </div>
                </div>
            </div>
            
            <div class="flex items-center gap-4">
                <div class="text-right">
                    <div class="text-sm text-gray-400">Logged in as</div>
                    <div class="text-white font-bold">Administrator</div>
                </div>
                <button onclick="adminApp.logout()" class="bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white px-4 py-2 rounded-lg font-bold flex items-center gap-2 transition-all duration-300">
                    <i class="fa-solid fa-sign-out-alt"></i>
                    Logout
                </button>
            </div>
        </nav>
        
        <!-- Main Content -->
        <div class="flex">
            <!-- Sidebar -->
            <aside class="w-64 bg-gray-900 border-r border-gray-800 min-h-[calc(100vh-73px)] p-4">
                <div class="space-y-1">
                    <button onclick="adminApp.showTab('dashboard')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-300 hover:text-white transition-all duration-300 flex items-center gap-3">
                        <i class="fa-solid fa-gauge w-5"></i>
                        Dashboard
                    </button>
                    <button onclick="adminApp.showTab('users')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-300 hover:text-white transition-all duration-300 flex items-center gap-3">
                        <i class="fa-solid fa-users w-5"></i>
                        Users Management
                    </button>
                    <button onclick="adminApp.showTab('bulkActions')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-300 hover:text-white transition-all duration-300 flex items-center gap-3">
                        <i class="fa-solid fa-layer-group w-5"></i>
                        Bulk Actions
                    </button>
                    <button onclick="adminApp.showTab('transactions')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-300 hover:text-white transition-all duration-300 flex items-center gap-3">
                        <i class="fa-solid fa-money-bill-transfer w-5"></i>
                        Transactions
                    </button>
                    <button onclick="adminApp.showTab('games')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-300 hover:text-white transition-all duration-300 flex items-center gap-3">
                        <i class="fa-solid fa-gamepad w-5"></i>
                        Games Control
                    </button>
                    <button onclick="adminApp.showTab('announcements')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-300 hover:text-white transition-all duration-300 flex items-center gap-3">
                        <i class="fa-solid fa-bullhorn w-5"></i>
                        Announcements
                    </button>
                    <button onclick="adminApp.showTab('system')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-300 hover:text-white transition-all duration-300 flex items-center gap-3">
                        <i class="fa-solid fa-gear w-5"></i>
                        System Settings
                    </button>
                    <button onclick="adminApp.showTab('reports')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-800 text-gray-300 hover:text-white transition-all duration-300 flex items-center gap-3">
                        <i class="fa-solid fa-chart-bar w-5"></i>
                        Reports & Analytics
                    </button>
                </div>
                
                <div class="mt-8 pt-6 border-t border-gray-800">
                    <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-3 px-4">Quick Actions</h3>
                    <div class="space-y-2">
                        <button onclick="adminApp.quickAction('addCoins')" class="w-full text-left px-4 py-2 rounded-lg hover:bg-purple-900/30 text-purple-300 hover:text-purple-200 transition-all duration-300 flex items-center gap-2 text-sm">
                            <i class="fa-solid fa-coins text-xs"></i>
                            Add Coins to User
                        </button>
                        <button onclick="adminApp.quickAction('banUser')" class="w-full text-left px-4 py-2 rounded-lg hover:bg-red-900/30 text-red-300 hover:text-red-200 transition-all duration-300 flex items-center gap-2 text-sm">
                            <i class="fa-solid fa-ban text-xs"></i>
                            Ban User
                        </button>
                        <button onclick="adminApp.quickAction('sendAnnouncement')" class="w-full text-left px-4 py-2 rounded-lg hover:bg-blue-900/30 text-blue-300 hover:text-blue-200 transition-all duration-300 flex items-center gap-2 text-sm">
                            <i class="fa-solid fa-bullhorn text-xs"></i>
                            Send Announcement
                        </button>
                        <button onclick="adminApp.quickAction('resetGame')" class="w-full text-left px-4 py-2 rounded-lg hover:bg-yellow-900/30 text-yellow-300 hover:text-yellow-200 transition-all duration-300 flex items-center gap-2 text-sm">
                            <i class="fa-solid fa-rotate text-xs"></i>
                            Reset Game Data
                        </button>
                    </div>
                </div>
            </aside>
            
            <!-- Main Content Area -->
            <main class="flex-1 p-6 overflow-auto max-h-[calc(100vh-73px)]">
                <!-- Dashboard Tab -->
                <div id="tab-dashboard" class="tab-content fade-in">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-white mb-2">Dashboard Overview</h2>
                        <p class="text-gray-400">Real-time statistics and system monitoring</p>
                    </div>
                    
                    <!-- Stats Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6 stats-grid">
                        <div class="stats-card">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="text-gray-400 text-sm mb-1">Total Users</div>
                                    <div class="text-2xl font-bold text-white" id="statTotalUsers">0</div>
                                </div>
                                <i class="fa-solid fa-users text-purple-500 text-2xl"></i>
                            </div>
                            <div class="mt-4 text-sm text-gray-400">
                                <span class="text-green-500"><i class="fa-solid fa-arrow-up mr-1"></i> 24 online</span>
                            </div>
                        </div>
                        
                        <div class="stats-card">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="text-gray-400 text-sm mb-1">Total Coins</div>
                                    <div class="text-2xl font-bold text-white" id="statTotalCoins">0</div>
                                </div>
                                <i class="fa-solid fa-coins text-yellow-500 text-2xl"></i>
                            </div>
                            <div class="mt-4 text-sm text-gray-400">
                                <span>Circulating in system</span>
                            </div>
                        </div>
                        
                        <div class="stats-card">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="text-gray-400 text-sm mb-1">Today's Wagers</div>
                                    <div class="text-2xl font-bold text-white" id="statTodayWagers">0</div>
                                </div>
                                <i class="fa-solid fa-money-bill-wave text-green-500 text-2xl"></i>
                            </div>
                            <div class="mt-4 text-sm text-gray-400">
                                <span class="text-green-500"><i class="fa-solid fa-arrow-up mr-1"></i> 12% from yesterday</span>
                            </div>
                        </div>
                        
                        <div class="stats-card">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="text-gray-400 text-sm mb-1">Active Games</div>
                                    <div class="text-2xl font-bold text-white" id="statActiveGames">0</div>
                                </div>
                                <i class="fa-solid fa-gamepad text-blue-500 text-2xl"></i>
                            </div>
                            <div class="mt-4 text-sm text-gray-400">
                                <span>Currently running</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Activity -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-gray-900/50 border border-gray-800 rounded-xl p-6">
                            <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                <i class="fa-solid fa-fire text-orange-500"></i>
                                Recent Activity
                            </h3>
                            <div class="space-y-4" id="recentActivity">
                                <!-- Activity items will be loaded here -->
                                <div class="text-center py-8 text-gray-500">
                                    <i class="fa-solid fa-spinner fa-spin text-2xl mb-2"></i>
                                    <p>Loading activity...</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-900/50 border border-gray-800 rounded-xl p-6">
                            <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                <i class="fa-solid fa-chart-line text-green-500"></i>
                                System Health
                            </h3>
                            <div class="space-y-4">
                                <div>
                                    <div class="flex justify-between text-sm text-gray-400 mb-1">
                                        <span>Database Connection</span>
                                        <span class="text-green-500 font-bold">Healthy</span>
                                    </div>
                                    <div class="h-2 bg-gray-800 rounded-full overflow-hidden">
                                        <div class="h-full bg-green-500 w-full"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between text-sm text-gray-400 mb-1">
                                        <span>Server Load</span>
                                        <span class="text-green-500 font-bold">24%</span>
                                    </div>
                                    <div class="h-2 bg-gray-800 rounded-full overflow-hidden">
                                        <div class="h-full bg-green-500 w-[24%]"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between text-sm text-gray-400 mb-1">
                                        <span>Memory Usage</span>
                                        <span class="text-yellow-500 font-bold">68%</span>
                                    </div>
                                    <div class="h-2 bg-gray-800 rounded-full overflow-hidden">
                                        <div class="h-full bg-yellow-500 w-[68%]"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between text-sm text-gray-400 mb-1">
                                        <span>Active Connections</span>
                                        <span class="text-blue-500 font-bold" id="activeConnections">0</span>
                                    </div>
                                    <div class="h-2 bg-gray-800 rounded-full overflow-hidden">
                                        <div class="h-full bg-blue-500 w-[30%]"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-6 pt-4 border-t border-gray-800">
                                <button onclick="adminApp.refreshStats()" class="btn btn-primary w-full">
                                    <i class="fa-solid fa-rotate"></i>
                                    Refresh Statistics
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Users Management Tab -->
                <div id="tab-users" class="tab-content hidden fade-in">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-white mb-2">Users Management</h2>
                        <p class="text-gray-400">Manage all registered users and their accounts</p>
                    </div>
                    
                    <!-- Bulk Actions Toolbar -->
                    <div class="bg-gray-900/50 border border-gray-800 rounded-xl p-4 mb-6">
                        <div class="flex flex-col md:flex-row gap-4 items-center">
                            <div class="flex-1">
                                <div class="search-box">
                                    <i class="fa-solid fa-search"></i>
                                    <input type="text" id="userSearch" placeholder="Search users by username, email, or ID..." oninput="adminApp.searchUsers()">
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <select id="userFilter" class="bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white" onchange="adminApp.filterUsers()">
                                    <option value="all">All Users</option>
                                    <option value="online">Online Now</option>
                                    <option value="banned">Banned</option>
                                    <option value="high-balance">High Balance (>10k)</option>
                                    <option value="new">New Today</option>
                                </select>
                                <button onclick="adminApp.selectAllUsers()" class="btn btn-primary">
                                    <i class="fa-solid fa-check-double"></i>
                                    Select All
                                </button>
                                <button onclick="adminApp.deselectAllUsers()" class="btn btn-warning">
                                    <i class="fa-solid fa-times"></i>
                                    Deselect All
                                </button>
                                <button onclick="adminApp.showAddUserModal()" class="btn btn-success">
                                    <i class="fa-solid fa-user-plus"></i>
                                    Add User
                                </button>
                            </div>
                        </div>
                        <div class="mt-4">
                            <button onclick="adminApp.showTab('bulkActions')" class="btn btn-danger">
                                <i class="fa-solid fa-layer-group"></i>
                                Go to Bulk Actions
                            </button>
                        </div>
                    </div>
                    
                    <!-- Users Table -->
                    <div class="bg-gray-900/50 border border-gray-800 rounded-xl overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th style="width: 50px;">
                                            <input type="checkbox" id="selectAllCheckbox" onchange="adminApp.toggleAllUsers()">
                                        </th>
                                        <th>User ID</th>
                                        <th>Username</th>
                                        <th>Email</th>
                                        <th>Balance</th>
                                        <th>Status</th>
                                        <th>Joined</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    <!-- Users will be loaded here -->
                                    <tr>
                                        <td colspan="8" class="text-center py-8 text-gray-500">
                                            <i class="fa-solid fa-spinner fa-spin text-2xl mb-2"></i>
                                            <p>Loading users...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="p-4 border-t border-gray-800">
                            <div class="pagination" id="usersPagination">
                                <!-- Pagination will be generated here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Bulk Actions Tab -->
                <div id="tab-bulkActions" class="tab-content hidden fade-in">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-white mb-2">Bulk Actions</h2>
                        <p class="text-gray-400">Perform actions on multiple users at once</p>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Email Filter Deletion -->
                        <div class="bg-gray-900/50 border border-gray-800 rounded-xl p-6">
                            <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                <i class="fa-solid fa-envelope text-red-500"></i>
                                Delete by Email Domain
                            </h3>
                            <div class="space-y-4">
                                <div class="input-group">
                                    <label>Keep Emails (comma-separated)</label>
                                    <textarea id="keepEmails" rows="3" placeholder="@gmail.com, @yahoo.com, @outlook.com" class="w-full"></textarea>
                                    <p class="text-sm text-gray-500 mt-1">Users with emails containing these domains will be KEPT. All others will be deleted.</p>
                                </div>
                                <div class="input-group">
                                    <label>Test Mode</label>
                                    <div class="flex items-center gap-2">
                                        <input type="checkbox" id="testMode" checked>
                                        <label for="testMode">Only show results without deleting</label>
                                    </div>
                                </div>
                                <button onclick="adminApp.previewEmailDeletion()" class="btn btn-warning w-full">
                                    <i class="fa-solid fa-eye"></i>
                                    Preview Deletion
                                </button>
                                <div id="emailPreviewResult" class="hidden">
                                    <div class="bg-gray-800/50 p-4 rounded-lg">
                                        <h4 class="font-bold text-white mb-2">Preview Results:</h4>
                                        <div class="space-y-2">
                                            <div class="flex justify-between">
                                                <span class="text-gray-400">Total users to keep:</span>
                                                <span class="text-green-500 font-bold" id="keepCount">0</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-400">Total users to delete:</span>
                                                <span class="text-red-500 font-bold" id="deleteCount">0</span>
                                            </div>
                                        </div>
                                        <div class="mt-4">
                                            <button onclick="adminApp.executeEmailDeletion()" class="btn btn-danger w-full">
                                                <i class="fa-solid fa-trash"></i>
                                                Execute Deletion
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Bulk Actions Panel -->
                        <div class="bg-gray-900/50 border border-gray-800 rounded-xl p-6">
                            <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                <i class="fa-solid fa-users-cog text-blue-500"></i>
                                Selected Users Actions
                            </h3>
                            <div class="space-y-4">
                                <div class="input-group">
                                    <label>Currently Selected</label>
                                    <div class="bg-gray-800 p-3 rounded-lg">
                                        <span id="selectedUsersCount" class="text-white font-bold">0</span>
                                        <span class="text-gray-400"> users selected</span>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-4">
                                    <button onclick="adminApp.bulkDelete()" class="btn btn-danger">
                                        <i class="fa-solid fa-trash"></i>
                                        Delete Selected
                                    </button>
                                    <button onclick="adminApp.bulkBan()" class="btn btn-warning">
                                        <i class="fa-solid fa-ban"></i>
                                        Ban Selected
                                    </button>
                                    <button onclick="adminApp.bulkUnban()" class="btn btn-success">
                                        <i class="fa-solid fa-check"></i>
                                        Unban Selected
                                    </button>
                                    <button onclick="adminApp.bulkResetBalance()" class="btn btn-primary">
                                        <i class="fa-solid fa-coins"></i>
                                        Reset Balance
                                    </button>
                                </div>
                                
                                <div class="input-group">
                                    <label>Set Balance for Selected</label>
                                    <div class="flex gap-2">
                                        <input type="number" id="bulkBalance" placeholder="Amount" class="flex-1" value="500">
                                        <button onclick="adminApp.bulkSetBalance()" class="btn btn-success">
                                            Apply
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="mt-4">
                                    <button onclick="adminApp.clearAllSelections()" class="btn btn-warning w-full">
                                        <i class="fa-solid fa-times"></i>
                                        Clear All Selections
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Quick Filters -->
                        <div class="bg-gray-900/50 border border-gray-800 rounded-xl p-6 lg:col-span-2">
                            <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                <i class="fa-solid fa-filter text-green-500"></i>
                                Quick Selection Filters
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <button onclick="adminApp.selectByFilter('lowBalance')" class="btn btn-warning">
                                    <i class="fa-solid fa-coins"></i>
                                    Balance < 100
                                </button>
                                <button onclick="adminApp.selectByFilter('noEmail')" class="btn btn-danger">
                                    <i class="fa-solid fa-envelope"></i>
                                    No Email
                                </button>
                                <button onclick="adminApp.selectByFilter('recent')" class="btn btn-primary">
                                    <i class="fa-solid fa-clock"></i>
                                    Created Today
                                </button>
                                <button onclick="adminApp.selectByFilter('banned')" class="btn btn-warning">
                                    <i class="fa-solid fa-ban"></i>
                                    Banned Users
                                </button>
                                <button onclick="adminApp.selectByFilter('inactive')" class="btn btn-secondary">
                                    <i class="fa-solid fa-user-clock"></i>
                                    Inactive (30+ days)
                                </button>
                                <button onclick="adminApp.selectByFilter('all')" class="btn btn-success">
                                    <i class="fa-solid fa-check-double"></i>
                                    Select All Users
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Transactions Tab -->
                <div id="tab-transactions" class="tab-content hidden fade-in">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-white mb-2">Transactions History</h2>
                        <p class="text-gray-400">Monitor all financial transactions and game wagers</p>
                    </div>
                    
                    <!-- Filters -->
                    <div class="bg-gray-900/50 border border-gray-800 rounded-xl p-4 mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Type</label>
                                <select id="txTypeFilter" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white" onchange="adminApp.filterTransactions()">
                                    <option value="all">All Types</option>
                                    <option value="win">Wins</option>
                                    <option value="loss">Losses</option>
                                    <option value="transfer">Transfers</option>
                                    <option value="deposit">Deposits</option>
                                    <option value="withdrawal">Withdrawals</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Game</label>
                                <select id="txGameFilter" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white" onchange="adminApp.filterTransactions()">
                                    <option value="all">All Games</option>
                                    <option value="blackjack">Blackjack</option>
                                    <option value="mines">Mines</option>
                                    <option value="system">System</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Date From</label>
                                <input type="date" id="txDateFrom" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white" onchange="adminApp.filterTransactions()">
                            </div>
                            <div>
                                <label class="text-sm text-gray-400 mb-1 block">Date To</label>
                                <input type="date" id="txDateTo" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white" onchange="adminApp.filterTransactions()">
                            </div>
                        </div>
                        <div class="mt-4">
                            <button onclick="adminApp.exportTransactions()" class="btn btn-success">
                                <i class="fa-solid fa-file-export"></i>
                                Export CSV
                            </button>
                        </div>
                    </div>
                    
                    <!-- Transactions Table -->
                    <div class="bg-gray-900/50 border border-gray-800 rounded-xl overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>User</th>
                                        <th>Type</th>
                                        <th>Amount</th>
                                        <th>Game</th>
                                        <th>Timestamp</th>
                                        <th>Details</th>
                                    </tr>
                                </thead>
                                <tbody id="transactionsTableBody">
                                    <!-- Transactions will be loaded here -->
                                    <tr>
                                        <td colspan="7" class="text-center py-8 text-gray-500">
                                            <i class="fa-solid fa-spinner fa-spin text-2xl mb-2"></i>
                                            <p>Loading transactions...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="p-4 border-t border-gray-800">
                            <div class="pagination" id="transactionsPagination">
                                <!-- Pagination will be generated here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Games Control Tab -->
                <div id="tab-games" class="tab-content hidden fade-in">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-white mb-2">Games Control</h2>
                        <p class="text-gray-400">Configure and monitor casino games</p>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Blackjack Settings -->
                        <div class="bg-gray-900/50 border border-gray-800 rounded-xl p-6">
                            <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                <i class="fa-solid fa-diamond text-green-500"></i>
                                Blackjack Settings
                            </h3>
                            <div class="space-y-4">
                                <div class="input-group">
                                    <label>Minimum Bet</label>
                                    <input type="number" id="bjMinBet" value="10" class="w-full">
                                </div>
                                <div class="input-group">
                                    <label>Maximum Bet</label>
                                    <input type="number" id="bjMaxBet" value="10000" class="w-full">
                                </div>
                                <div class="input-group">
                                    <label>Dealer Stand On</label>
                                    <select id="bjDealerStand" class="w-full">
                                        <option value="17">17 or higher</option>
                                        <option value="16">16 or higher</option>
                                        <option value="15">15 or higher</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label>Blackjack Payout</label>
                                    <select id="bjPayout" class="w-full">
                                        <option value="1.5">3:2 (1.5x)</option>
                                        <option value="1.2">6:5 (1.2x)</option>
                                        <option value="1">1:1 (1x)</option>
                                    </select>
                                </div>
                                <button onclick="adminApp.saveBlackjackSettings()" class="btn btn-success w-full">
                                    <i class="fa-solid fa-save"></i>
                                    Save Blackjack Settings
                                </button>
                            </div>
                        </div>
                        
                        <!-- Mines Settings -->
                        <div class="bg-gray-900/50 border border-gray-800 rounded-xl p-6">
                            <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                <i class="fa-solid fa-bomb text-yellow-500"></i>
                                Mines Settings
                            </h3>
                            <div class="space-y-4">
                                <div class="input-group">
                                    <label>Minimum Bet</label>
                                    <input type="number" id="minesMinBet" value="1" class="w-full">
                                </div>
                                <div class="input-group">
                                    <label>Maximum Bet</label>
                                    <input type="number" id="minesMaxBet" value="5000" class="w-full">
                                </div>
                                <div class="input-group">
                                    <label>Maximum Mines</label>
                                    <input type="number" id="minesMaxMines" value="24" min="1" max="24" class="w-full">
                                </div>
                                <div class="input-group">
                                    <label>House Edge (%)</label>
                                    <input type="number" id="minesHouseEdge" value="1" step="0.1" class="w-full">
                                </div>
                                <button onclick="adminApp.saveMinesSettings()" class="btn btn-success w-full">
                                    <i class="fa-solid fa-save"></i>
                                    Save Mines Settings
                                </button>
                            </div>
                        </div>
                        
                        <!-- Game Statistics -->
                        <div class="bg-gray-900/50 border border-gray-800 rounded-xl p-6 lg:col-span-2">
                            <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                <i class="fa-solid fa-chart-pie text-blue-500"></i>
                                Game Statistics
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="stats-card">
                                    <div class="text-center">
                                        <div class="text-gray-400 text-sm mb-1">Total Games Played</div>
                                        <div class="text-2xl font-bold text-white" id="totalGamesPlayed">0</div>
                                    </div>
                                </div>
                                <div class="stats-card">
                                    <div class="text-center">
                                        <div class="text-gray-400 text-sm mb-1">Total Wagered</div>
                                        <div class="text-2xl font-bold text-white" id="totalWagered">0</div>
                                    </div>
                                </div>
                                <div class="stats-card">
                                    <div class="text-center">
                                        <div class="text-gray-400 text-sm mb-1">House Profit</div>
                                        <div class="text-2xl font-bold text-white" id="houseProfit">0</div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-4">
                                <button onclick="adminApp.resetGameStats()" class="btn btn-danger">
                                    <i class="fa-solid fa-trash"></i>
                                    Reset Game Statistics
                                </button>
                                <button onclick="adminApp.recalculateStats()" class="btn btn-warning ml-2">
                                    <i class="fa-solid fa-calculator"></i>
                                    Recalculate Stats
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Announcements Tab -->
                <div id="tab-announcements" class="tab-content hidden fade-in">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-white mb-2">Announcements</h2>
                        <p class="text-gray-400">Send messages and notifications to all users</p>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Create Announcement -->
                        <div class="bg-gray-900/50 border border-gray-800 rounded-xl p-6 lg:col-span-2">
                            <h3 class="text-lg font-bold text-white mb-4">Create New Announcement</h3>
                            <div class="space-y-4">
                                <div class="input-group">
                                    <label>Title</label>
                                    <input type="text" id="announcementTitle" placeholder="Enter announcement title" class="w-full">
                                </div>
                                <div class="input-group">
                                    <label>Message</label>
                                    <textarea id="announcementMessage" rows="5" placeholder="Enter your message..." class="w-full"></textarea>
                                </div>
                                <div class="input-group">
                                    <label>Type</label>
                                    <select id="announcementType" class="w-full">
                                        <option value="info">Information</option>
                                        <option value="success">Success</option>
                                        <option value="warning">Warning</option>
                                        <option value="error">Error</option>
                                        <option value="maintenance">Maintenance</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label>
                                        <input type="checkbox" id="announcementImportant" class="mr-2">
                                        Mark as Important
                                    </label>
                                </div>
                                <div class="input-group">
                                    <label>
                                        <input type="checkbox" id="announcementPopup" class="mr-2" checked>
                                        Show as Popup
                                    </label>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="adminApp.sendAnnouncement()" class="btn btn-success">
                                        <i class="fa-solid fa-paper-plane"></i>
                                        Send Now
                                    </button>
                                    <button onclick="adminApp.scheduleAnnouncement()" class="btn btn-primary">
                                        <i class="fa-solid fa-clock"></i>
                                        Schedule
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Recent Announcements -->
                        <div class="bg-gray-900/50 border border-gray-800 rounded-xl p-6">
                            <h3 class="text-lg font-bold text-white mb-4">Recent Announcements</h3>
                            <div class="space-y-4" id="recentAnnouncements">
                                <!-- Announcements will be loaded here -->
                                <div class="text-center py-8 text-gray-500">
                                    <i class="fa-solid fa-spinner fa-spin text-2xl mb-2"></i>
                                    <p>Loading announcements...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- System Settings Tab -->
                <div id="tab-system" class="tab-content hidden fade-in">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-white mb-2">System Settings</h2>
                        <p class="text-gray-400">Configure system-wide settings and parameters</p>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- General Settings -->
                        <div class="bg-gray-900/50 border border-gray-800 rounded-xl p-6">
                            <h3 class="text-lg font-bold text-white mb-4">General Settings</h3>
                            <div class="space-y-4">
                                <div class="input-group">
                                    <label>Site Name</label>
                                    <input type="text" id="siteName" value="Moon Casino" class="w-full">
                                </div>
                                <div class="input-group">
                                    <label>Starting Balance</label>
                                    <input type="number" id="startingBalance" value="500" class="w-full">
                                </div>
                                <div class="input-group">
                                    <label>Free Coins Amount</label>
                                    <input type="number" id="freeCoinsAmount" value="500" class="w-full">
                                </div>
                                <div class="input-group">
                                    <label>Free Coins Cooldown (hours)</label>
                                    <input type="number" id="freeCoinsCooldown" value="1" class="w-full">
                                </div>
                                <div class="input-group">
                                    <label>Max Transfer Amount</label>
                                    <input type="number" id="maxTransferAmount" value="10000" class="w-full">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Security & Maintenance -->
                        <div class="bg-gray-900/50 border border-gray-800 rounded-xl p-6">
                            <h3 class="text-lg font-bold text-white mb-4">Security & Maintenance</h3>
                            <div class="space-y-4">
                                <div class="input-group">
                                    <label>Admin Key</label>
                                    <input type="password" id="adminKeyChange" placeholder="Enter new admin key" class="w-full">
                                </div>
                                <div class="input-group">
                                    <label>Max Login Attempts</label>
                                    <input type="number" id="maxLoginAttempts" value="5" class="w-full">
                                </div>
                                <div class="input-group">
                                    <label>Session Timeout (minutes)</label>
                                    <input type="number" id="sessionTimeout" value="30" class="w-full">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Database Management -->
                        <div class="bg-gray-900/50 border border-gray-800 rounded-xl p-6 lg:col-span-2">
                            <h3 class="text-lg font-bold text-white mb-4">Database Management</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <button onclick="adminApp.clearChatDatabase()" class="btn btn-danger">
                                    <i class="fa-solid fa-comments"></i>
                                    Clear Chat Database
                                </button>
                                <button onclick="adminApp.clearTransactionsDatabase()" class="btn btn-warning">
                                    <i class="fa-solid fa-history"></i>
                                    Clear Transactions
                                </button>
                                <button onclick="adminApp.backupDatabase()" class="btn btn-primary">
                                    <i class="fa-solid fa-database"></i>
                                    Backup Database
                                </button>
                            </div>
                            <div class="mt-6 pt-4 border-t border-gray-800">
                                <button onclick="adminApp.saveSystemSettings()" class="btn btn-success">
                                    <i class="fa-solid fa-save"></i>
                                    Save All Settings
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Reports & Analytics Tab -->
                <div id="tab-reports" class="tab-content hidden fade-in">
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-white mb-2">Reports & Analytics</h2>
                        <p class="text-gray-400">Generate reports and view analytics</p>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Report Generator -->
                        <div class="bg-gray-900/50 border border-gray-800 rounded-xl p-6">
                            <h3 class="text-lg font-bold text-white mb-4">Generate Report</h3>
                            <div class="space-y-4">
                                <div class="input-group">
                                    <label>Report Type</label>
                                    <select id="reportType" class="w-full">
                                        <option value="daily">Daily Summary</option>
                                        <option value="weekly">Weekly Summary</option>
                                        <option value="monthly">Monthly Summary</option>
                                        <option value="users">User Activity</option>
                                        <option value="financial">Financial Report</option>
                                        <option value="games">Games Performance</option>
                                    </select>
                                </div>
                                <div class="input-group">
                                    <label>Date Range</label>
                                    <div class="flex gap-2">
                                        <input type="date" id="reportDateFrom" class="flex-1">
                                        <input type="date" id="reportDateTo" class="flex-1">
                                    </div>
                                </div>
                                <div class="input-group">
                                    <label>Format</label>
                                    <select id="reportFormat" class="w-full">
                                        <option value="html">HTML</option>
                                        <option value="csv">CSV</option>
                                        <option value="json">JSON</option>
                                        <option value="pdf">PDF</option>
                                    </select>
                                </div>
                                <button onclick="adminApp.generateReport()" class="btn btn-success w-full">
                                    <i class="fa-solid fa-file-export"></i>
                                    Generate Report
                                </button>
                            </div>
                        </div>
                        
                        <!-- Analytics Overview -->
                        <div class="bg-gray-900/50 border border-gray-800 rounded-xl p-6">
                            <h3 class="text-lg font-bold text-white mb-4">Analytics Overview</h3>
                            <div class="space-y-4">
                                <div class="stats-card">
                                    <div class="text-center">
                                        <div class="text-gray-400 text-sm mb-1">Active Users (24h)</div>
                                        <div class="text-2xl font-bold text-white" id="activeUsers24h">0</div>
                                    </div>
                                </div>
                                <div class="stats-card">
                                    <div class="text-center">
                                        <div class="text-gray-400 text-sm mb-1">New Users (Today)</div>
                                        <div class="text-2xl font-bold text-white" id="newUsersToday">0</div>
                                    </div>
                                </div>
                                <div class="stats-card">
                                    <div class="text-center">
                                        <div class="text-gray-400 text-sm mb-1">Total Wagered (Today)</div>
                                        <div class="text-2xl font-bold text-white" id="totalWageredToday">0</div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-4">
                                <button onclick="adminApp.refreshAnalytics()" class="btn btn-primary w-full">
                                    <i class="fa-solid fa-rotate"></i>
                                    Refresh Analytics
                                </button>
                            </div>
                        </div>
                        
                        <!-- Recent Reports -->
                        <div class="bg-gray-900/50 border border-gray-800 rounded-xl p-6 lg:col-span-2">
                            <h3 class="text-lg font-bold text-white mb-4">Recent Reports</h3>
                            <div class="overflow-x-auto">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Report ID</th>
                                            <th>Type</th>
                                            <th>Date Range</th>
                                            <th>Generated By</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="reportsTableBody">
                                        <tr>
                                            <td colspan="5" class="text-center py-8 text-gray-500">
                                                No reports generated yet
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Modals -->
    
    <!-- Add/Edit User Modal -->
    <div id="userModal" class="modal">
        <div class="modal-content p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-white" id="userModalTitle">Add New User</h3>
                <button onclick="adminApp.closeModal('userModal')" class="text-gray-400 hover:text-white">
                    <i class="fa-solid fa-times text-xl"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div class="input-group">
                    <label>Username</label>
                    <input type="text" id="modalUsername" class="w-full">
                </div>
                <div class="input-group">
                    <label>Email</label>
                    <input type="email" id="modalEmail" class="w-full">
                </div>
                <div class="input-group">
                    <label>Password</label>
                    <input type="password" id="modalPassword" class="w-full">
                </div>
                <div class="input-group">
                    <label>Initial Balance</label>
                    <input type="number" id="modalBalance" value="500" class="w-full">
                </div>
                <div class="input-group">
                    <label>Status</label>
                    <select id="modalStatus" class="w-full">
                        <option value="active">Active</option>
                        <option value="banned">Banned</option>
                        <option value="suspended">Suspended</option>
                    </select>
                </div>
                <div class="flex gap-2">
                    <button onclick="adminApp.saveUser()" class="btn btn-success flex-1">
                        <i class="fa-solid fa-save"></i>
                        Save User
                    </button>
                    <button onclick="adminApp.closeModal('userModal')" class="btn btn-danger">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Action Modal -->
    <div id="quickActionModal" class="modal">
        <div class="modal-content p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-white" id="quickActionTitle">Quick Action</h3>
                <button onclick="adminApp.closeModal('quickActionModal')" class="text-gray-400 hover:text-white">
                    <i class="fa-solid fa-times text-xl"></i>
                </button>
            </div>
            
            <div id="quickActionContent">
                <!-- Content will be loaded dynamically -->
            </div>
        </div>
    </div>
    
    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal">
        <div class="modal-content p-6">
            <div class="text-center mb-6">
                <i class="fa-solid fa-triangle-exclamation text-yellow-500 text-4xl mb-4"></i>
                <h3 class="text-xl font-bold text-white mb-2" id="confirmTitle">Confirm Action</h3>
                <p class="text-gray-400" id="confirmMessage">Are you sure you want to perform this action?</p>
            </div>
            
            <div class="flex gap-2 justify-center">
                <button onclick="adminApp.confirmAction(true)" class="btn btn-danger">
                    <i class="fa-solid fa-check"></i>
                    Confirm
                </button>
                <button onclick="adminApp.confirmAction(false)" class="btn btn-primary">
                    <i class="fa-solid fa-times"></i>
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBLmhwz-ocTNaZwWchcpWl3N0hJMlsskts",
            authDomain: "nebula-48dbd.firebaseapp.com",
            databaseURL: "https://nebula-48dbd-default-rtdb.firebaseio.com",
            projectId: "nebula-48dbd",
            storageBucket: "nebula-48dbd.firebasestorage.app",
            messagingSenderId: "259199297883",
            appId: "1:259199297883:web:f84fe6b2fc2ca70015d27e",
            measurementId: "G-38CB3Y2T56"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        class AdminApp {
            constructor() {
                this.adminKey = 'mooncasino2024';
                this.currentUser = null;
                this.currentTab = 'dashboard';
                this.users = [];
                this.transactions = [];
                this.confirmCallback = null;
                this.selectedUsers = new Set();
                this.currentPage = {
                    users: 1,
                    transactions: 1
                };
                this.itemsPerPage = 10;
                
                this.init();
            }

            init() {
                this.checkAuth();
                this.loadStats();
                setInterval(() => this.loadStats(), 30000);
            }

            showToast(message, type = 'success') {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.innerHTML = `
                    <div class="flex items-center gap-3">
                        <i class="fa-solid ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-exclamation-triangle'} text-lg"></i>
                        <span class="font-medium">${message}</span>
                    </div>
                `;
                
                document.getElementById('toastContainer').appendChild(toast);
                
                setTimeout(() => toast.classList.add('show'), 10);
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }

            login() {
                const key = document.getElementById('adminKey').value;
                
                if (key === this.adminKey) {
                    document.getElementById('loginModal').classList.remove('active');
                    document.getElementById('adminPanel').classList.remove('hidden');
                    this.showToast('Welcome to Admin Panel!', 'success');
                    
                    this.loadUsers();
                    this.loadTransactions();
                    this.loadRecentActivity();
                    this.loadAnnouncements();
                } else {
                    this.showToast('Invalid admin key!', 'error');
                }
            }

            logout() {
                document.getElementById('loginModal').classList.add('active');
                document.getElementById('adminPanel').classList.add('hidden');
                this.showToast('Logged out successfully', 'warning');
            }

            checkAuth() {
                const savedKey = localStorage.getItem('adminKey');
                if (savedKey === this.adminKey) {
                    this.login();
                }
            }

            showTab(tabName) {
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.add('hidden');
                });
                
                document.getElementById(`tab-${tabName}`).classList.remove('hidden');
                this.currentTab = tabName;
                
                switch(tabName) {
                    case 'users':
                        this.loadUsers();
                        break;
                    case 'bulkActions':
                        this.updateSelectedCount();
                        break;
                    case 'transactions':
                        this.loadTransactions();
                        break;
                    case 'games':
                        this.loadGameStats();
                        break;
                    case 'announcements':
                        this.loadAnnouncements();
                        break;
                    case 'reports':
                        this.loadReports();
                        break;
                }
            }

            async loadStats() {
                try {
                    const usersSnapshot = await database.ref('users').once('value');
                    const totalUsers = usersSnapshot.numChildren();
                    document.getElementById('statTotalUsers').textContent = totalUsers.toLocaleString();
                    
                    let totalCoins = 0;
                    usersSnapshot.forEach(child => {
                        const user = child.val();
                        totalCoins += user.balance || 0;
                    });
                    document.getElementById('statTotalCoins').textContent = totalCoins.toLocaleString();
                    
                    const onlineSnapshot = await database.ref('online').once('value');
                    const onlineCount = onlineSnapshot.numChildren();
                    document.getElementById('activeConnections').textContent = onlineCount;
                    
                    document.getElementById('statActiveGames').textContent = Math.floor(Math.random() * 50 + 10);
                    document.getElementById('statTodayWagers').textContent = Math.floor(Math.random() * 10000 + 5000).toLocaleString();
                    
                } catch (error) {
                    console.error('Error loading stats:', error);
                }
            }

            async loadUsers() {
                try {
                    const snapshot = await database.ref('users').once('value');
                    this.users = [];
                    
                    snapshot.forEach(child => {
                        const user = child.val();
                        user.id = child.key;
                        this.users.push(user);
                    });
                    
                    this.displayUsers();
                } catch (error) {
                    console.error('Error loading users:', error);
                    this.showToast('Error loading users', 'error');
                }
            }

            displayUsers(page = 1) {
                const tbody = document.getElementById('usersTableBody');
                const pagination = document.getElementById('usersPagination');
                
                if (this.users.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="8" class="text-center py-8 text-gray-500">
                                No users found
                            </td>
                        </tr>
                    `;
                    pagination.innerHTML = '';
                    return;
                }
                
                const totalPages = Math.ceil(this.users.length / this.itemsPerPage);
                const startIndex = (page - 1) * this.itemsPerPage;
                const endIndex = startIndex + this.itemsPerPage;
                const pageUsers = this.users.slice(startIndex, endIndex);
                
                tbody.innerHTML = pageUsers.map(user => {
                    const isSelected = this.selectedUsers.has(user.id);
                    return `
                    <tr>
                        <td>
                            <input type="checkbox" class="user-checkbox" data-user-id="${user.id}" ${isSelected ? 'checked' : ''} onchange="adminApp.toggleUserSelection('${user.id}')">
                        </td>
                        <td class="font-mono text-sm">${user.id.substring(0, 8)}...</td>
                        <td>
                            <div class="font-bold">${user.username}</div>
                            <div class="text-xs text-gray-500">${user.userId}</div>
                        </td>
                        <td>${user.email || 'No email'}</td>
                        <td>
                            <div class="font-bold text-green-500">${(user.balance || 0).toLocaleString()}</div>
                            <div class="text-xs text-gray-500">coins</div>
                        </td>
                        <td>
                            <span class="status-badge ${user.status === 'banned' ? 'status-banned' : 'status-active'}">
                                ${user.status || 'Active'}
                            </span>
                        </td>
                        <td>
                            <div class="text-sm">${new Date(user.createdAt || Date.now()).toLocaleDateString()}</div>
                            <div class="text-xs text-gray-500">${new Date(user.createdAt || Date.now()).toLocaleTimeString()}</div>
                        </td>
                        <td>
                            <div class="flex gap-2">
                                <button onclick="adminApp.editUser('${user.id}')" class="text-blue-500 hover:text-blue-400">
                                    <i class="fa-solid fa-edit"></i>
                                </button>
                                <button onclick="adminApp.manageUserBalance('${user.id}', '${user.username}')" class="text-green-500 hover:text-green-400">
                                    <i class="fa-solid fa-coins"></i>
                                </button>
                                <button onclick="adminApp.banUser('${user.id}', '${user.username}')" class="text-red-500 hover:text-red-400">
                                    <i class="fa-solid fa-ban"></i>
                                </button>
                                <button onclick="adminApp.deleteUser('${user.id}', '${user.username}')" class="text-gray-500 hover:text-gray-400">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `}).join('');
                
                document.getElementById('selectAllCheckbox').checked = this.selectedUsers.size > 0 && 
                    this.selectedUsers.size === pageUsers.length;
                
                let paginationHTML = '';
                for (let i = 1; i <= totalPages; i++) {
                    if (i === 1 || i === totalPages || (i >= page - 2 && i <= page + 2)) {
                        paginationHTML += `
                            <button onclick="adminApp.changePage('users', ${i})" class="${i === page ? 'active' : ''}">
                                ${i}
                            </button>
                        `;
                    } else if (i === page - 3 || i === page + 3) {
                        paginationHTML += '<span class="px-2">...</span>';
                    }
                }
                pagination.innerHTML = paginationHTML;
                
                this.updateSelectedCount();
                this.updateBulkActionBar();
            }

            toggleUserSelection(userId) {
                if (this.selectedUsers.has(userId)) {
                    this.selectedUsers.delete(userId);
                } else {
                    this.selectedUsers.add(userId);
                }
                this.updateSelectedCount();
                this.updateBulkActionBar();
            }

            toggleAllUsers() {
                const isChecked = document.getElementById('selectAllCheckbox').checked;
                const checkboxes = document.querySelectorAll('.user-checkbox');
                
                checkboxes.forEach(checkbox => {
                    const userId = checkbox.dataset.userId;
                    checkbox.checked = isChecked;
                    if (isChecked) {
                        this.selectedUsers.add(userId);
                    } else {
                        this.selectedUsers.delete(userId);
                    }
                });
                
                this.updateSelectedCount();
                this.updateBulkActionBar();
            }

            selectAllUsers() {
                this.selectedUsers.clear();
                this.users.forEach(user => this.selectedUsers.add(user.id));
                this.displayUsers(this.currentPage.users);
                this.showToast(`Selected all ${this.users.length} users`, 'success');
            }

            deselectAllUsers() {
                this.selectedUsers.clear();
                this.displayUsers(this.currentPage.users);
                this.showToast('Cleared all selections', 'success');
            }

            clearAllSelections() {
                this.selectedUsers.clear();
                this.displayUsers(this.currentPage.users);
                this.showToast('Cleared all selections', 'success');
            }

            clearSelection() {
                this.selectedUsers.clear();
                this.displayUsers(this.currentPage.users);
                this.showToast('Cleared selection', 'success');
            }

            updateSelectedCount() {
                const count = this.selectedUsers.size;
                document.getElementById('selectedCount').textContent = count;
                document.getElementById('selectedUsersCount').textContent = count;
                
                if (count > 0) {
                    document.getElementById('bulkActionBar').classList.remove('hidden');
                } else {
                    document.getElementById('bulkActionBar').classList.add('hidden');
                }
            }

            updateBulkActionBar() {
                if (this.selectedUsers.size > 0) {
                    document.getElementById('bulkActionBar').classList.remove('hidden');
                } else {
                    document.getElementById('bulkActionBar').classList.add('hidden');
                }
            }

            async bulkDelete() {
                if (this.selectedUsers.size === 0) {
                    this.showToast('No users selected', 'warning');
                    return;
                }

                this.showConfirm(
                    'Bulk Delete Users',
                    `Are you sure you want to delete ${this.selectedUsers.size} users? This action cannot be undone!`,
                    async () => {
                        try {
                            const updates = {};
                            this.selectedUsers.forEach(userId => {
                                updates['users/' + userId] = null;
                                updates['online/' + userId] = null;
                            });
                            
                            await database.ref().update(updates);
                            
                            this.showToast(`Deleted ${this.selectedUsers.size} users successfully`, 'success');
                            this.selectedUsers.clear();
                            this.loadUsers();
                            
                        } catch (error) {
                            console.error('Error bulk deleting users:', error);
                            this.showToast('Error deleting users', 'error');
                        }
                    }
                );
            }

            async bulkBan() {
                if (this.selectedUsers.size === 0) {
                    this.showToast('No users selected', 'warning');
                    return;
                }

                this.showConfirm(
                    'Bulk Ban Users',
                    `Are you sure you want to ban ${this.selectedUsers.size} users?`,
                    async () => {
                        try {
                            const updates = {};
                            this.selectedUsers.forEach(userId => {
                                updates['users/' + userId + '/status'] = 'banned';
                                updates['users/' + userId + '/bannedAt'] = Date.now();
                                updates['users/' + userId + '/bannedBy'] = 'admin';
                                updates['online/' + userId] = null;
                            });
                            
                            await database.ref().update(updates);
                            
                            this.showToast(`Banned ${this.selectedUsers.size} users successfully`, 'success');
                            this.loadUsers();
                            
                        } catch (error) {
                            console.error('Error bulk banning users:', error);
                            this.showToast('Error banning users', 'error');
                        }
                    }
                );
            }

            async bulkUnban() {
                if (this.selectedUsers.size === 0) {
                    this.showToast('No users selected', 'warning');
                    return;
                }

                this.showConfirm(
                    'Bulk Unban Users',
                    `Are you sure you want to unban ${this.selectedUsers.size} users?`,
                    async () => {
                        try {
                            const updates = {};
                            this.selectedUsers.forEach(userId => {
                                updates['users/' + userId + '/status'] = 'active';
                                updates['users/' + userId + '/unbannedAt'] = Date.now();
                                updates['users/' + userId + '/bannedBy'] = null;
                                updates['users/' + userId + '/banReason'] = null;
                            });
                            
                            await database.ref().update(updates);
                            
                            this.showToast(`Unbanned ${this.selectedUsers.size} users successfully`, 'success');
                            this.loadUsers();
                            
                        } catch (error) {
                            console.error('Error bulk unbanning users:', error);
                            this.showToast('Error unbanning users', 'error');
                        }
                    }
                );
            }

            async bulkSetBalance() {
                if (this.selectedUsers.size === 0) {
                    this.showToast('No users selected', 'warning');
                    return;
                }

                const amount = parseInt(document.getElementById('bulkBalance').value) || 0;
                
                this.showConfirm(
                    'Bulk Set Balance',
                    `Set balance to ${amount.toLocaleString()} coins for ${this.selectedUsers.size} users?`,
                    async () => {
                        try {
                            const updates = {};
                            this.selectedUsers.forEach(userId => {
                                updates['users/' + userId + '/balance'] = amount;
                            });
                            
                            await database.ref().update(updates);
                            
                            this.showToast(`Set balance for ${this.selectedUsers.size} users`, 'success');
                            this.loadUsers();
                            
                        } catch (error) {
                            console.error('Error setting bulk balance:', error);
                            this.showToast('Error setting balance', 'error');
                        }
                    }
                );
            }

            async bulkResetBalance() {
                if (this.selectedUsers.size === 0) {
                    this.showToast('No users selected', 'warning');
                    return;
                }

                this.showConfirm(
                    'Bulk Reset Balance',
                    `Reset balance to 500 coins for ${this.selectedUsers.size} users?`,
                    async () => {
                        try {
                            const updates = {};
                            this.selectedUsers.forEach(userId => {
                                updates['users/' + userId + '/balance'] = 500;
                            });
                            
                            await database.ref().update(updates);
                            
                            this.showToast(`Reset balance for ${this.selectedUsers.size} users`, 'success');
                            this.loadUsers();
                            
                        } catch (error) {
                            console.error('Error resetting bulk balance:', error);
                            this.showToast('Error resetting balance', 'error');
                        }
                    }
                );
            }

            async previewEmailDeletion() {
                const keepEmailsText = document.getElementById('keepEmails').value.trim();
                if (!keepEmailsText) {
                    this.showToast('Please enter email domains to keep', 'warning');
                    return;
                }

                const keepDomains = keepEmailsText.split(',').map(d => d.trim().toLowerCase()).filter(d => d);
                if (keepDomains.length === 0) {
                    this.showToast('Invalid email domains', 'error');
                    return;
                }

                try {
                    const snapshot = await database.ref('users').once('value');
                    let keepCount = 0;
                    let deleteCount = 0;
                    
                    snapshot.forEach(child => {
                        const user = child.val();
                        const email = (user.email || '').toLowerCase();
                        
                        let shouldKeep = false;
                        for (const domain of keepDomains) {
                            if (email.includes(domain)) {
                                shouldKeep = true;
                                break;
                            }
                        }
                        
                        if (shouldKeep) {
                            keepCount++;
                        } else {
                            deleteCount++;
                        }
                    });

                    document.getElementById('keepCount').textContent = keepCount;
                    document.getElementById('deleteCount').textContent = deleteCount;
                    document.getElementById('emailPreviewResult').classList.remove('hidden');
                    
                    if (deleteCount > 0) {
                        this.showToast(`Preview: ${keepCount} users to keep, ${deleteCount} to delete`, 'info');
                    } else {
                        this.showToast('No users to delete with current filters', 'info');
                    }
                    
                } catch (error) {
                    console.error('Error previewing email deletion:', error);
                    this.showToast('Error previewing deletion', 'error');
                }
            }

            async executeEmailDeletion() {
                const keepEmailsText = document.getElementById('keepEmails').value.trim();
                const testMode = document.getElementById('testMode').checked;
                const keepDomains = keepEmailsText.split(',').map(d => d.trim().toLowerCase()).filter(d => d);

                try {
                    const snapshot = await database.ref('users').once('value');
                    const updates = {};
                    let deleteCount = 0;
                    
                    snapshot.forEach(child => {
                        const user = child.val();
                        const email = (user.email || '').toLowerCase();
                        
                        let shouldKeep = false;
                        for (const domain of keepDomains) {
                            if (email.includes(domain)) {
                                shouldKeep = true;
                                break;
                            }
                        }
                        
                        if (!shouldKeep) {
                            if (!testMode) {
                                updates['users/' + child.key] = null;
                                updates['online/' + child.key] = null;
                            }
                            deleteCount++;
                        }
                    });

                    if (testMode) {
                        this.showToast(`Test mode: Would delete ${deleteCount} users`, 'info');
                    } else {
                        if (deleteCount > 0) {
                            await database.ref().update(updates);
                            this.showToast(`Deleted ${deleteCount} users successfully`, 'success');
                            document.getElementById('emailPreviewResult').classList.add('hidden');
                            this.loadUsers();
                        } else {
                            this.showToast('No users to delete with current filters', 'info');
                        }
                    }
                    
                } catch (error) {
                    console.error('Error executing email deletion:', error);
                    this.showToast('Error executing deletion', 'error');
                }
            }

            selectByFilter(filterType) {
                switch(filterType) {
                    case 'lowBalance':
                        this.selectedUsers.clear();
                        this.users.forEach(user => {
                            if ((user.balance || 0) < 100) {
                                this.selectedUsers.add(user.id);
                            }
                        });
                        break;
                    case 'noEmail':
                        this.selectedUsers.clear();
                        this.users.forEach(user => {
                            if (!user.email || user.email.trim() === '') {
                                this.selectedUsers.add(user.id);
                            }
                        });
                        break;
                    case 'recent':
                        this.selectedUsers.clear();
                        const today = new Date().setHours(0, 0, 0, 0);
                        this.users.forEach(user => {
                            if (new Date(user.createdAt || Date.now()) >= today) {
                                this.selectedUsers.add(user.id);
                            }
                        });
                        break;
                    case 'banned':
                        this.selectedUsers.clear();
                        this.users.forEach(user => {
                            if (user.status === 'banned') {
                                this.selectedUsers.add(user.id);
                            }
                        });
                        break;
                    case 'inactive':
                        this.selectedUsers.clear();
                        const thirtyDaysAgo = Date.now() - (30 * 24 * 60 * 60 * 1000);
                        this.users.forEach(user => {
                            const lastActive = user.lastLogin || user.createdAt || 0;
                            if (lastActive < thirtyDaysAgo) {
                                this.selectedUsers.add(user.id);
                            }
                        });
                        break;
                    case 'all':
                        this.selectAllUsers();
                        return;
                }
                
                this.displayUsers(this.currentPage.users);
                this.showToast(`Selected ${this.selectedUsers.size} users by filter: ${filterType}`, 'success');
            }

            async clearChatDatabase() {
                this.showConfirm(
                    'Clear Chat Database',
                    'Are you sure you want to clear ALL chat messages? This cannot be undone!',
                    async () => {
                        try {
                            await database.ref('chat').remove();
                            this.showToast('Chat database cleared successfully', 'success');
                        } catch (error) {
                            console.error('Error clearing chat:', error);
                            this.showToast('Error clearing chat', 'error');
                        }
                    }
                );
            }

            async clearTransactionsDatabase() {
                this.showConfirm(
                    'Clear Transactions',
                    'Are you sure you want to clear ALL transaction history? This cannot be undone!',
                    async () => {
                        try {
                            await database.ref('transactions').remove();
                            this.showToast('Transaction history cleared successfully', 'success');
                            this.loadTransactions();
                        } catch (error) {
                            console.error('Error clearing transactions:', error);
                            this.showToast('Error clearing transactions', 'error');
                        }
                    }
                );
            }

            searchUsers() {
                const searchTerm = document.getElementById('userSearch').value.toLowerCase();
                if (!searchTerm) {
                    this.displayUsers();
                    return;
                }
                
                const filteredUsers = this.users.filter(user => 
                    user.username.toLowerCase().includes(searchTerm) ||
                    (user.email && user.email.toLowerCase().includes(searchTerm)) ||
                    user.id.toLowerCase().includes(searchTerm)
                );
                
                const tbody = document.getElementById('usersTableBody');
                tbody.innerHTML = filteredUsers.map(user => {
                    const isSelected = this.selectedUsers.has(user.id);
                    return `
                    <tr>
                        <td>
                            <input type="checkbox" class="user-checkbox" data-user-id="${user.id}" ${isSelected ? 'checked' : ''} onchange="adminApp.toggleUserSelection('${user.id}')">
                        </td>
                        <td class="font-mono text-sm">${user.id.substring(0, 8)}...</td>
                        <td>${user.username}</td>
                        <td>${user.email || 'No email'}</td>
                        <td class="text-green-500 font-bold">${(user.balance || 0).toLocaleString()}</td>
                        <td><span class="status-badge ${user.status === 'banned' ? 'status-banned' : 'status-active'}">${user.status || 'Active'}</span></td>
                        <td>${new Date(user.createdAt || Date.now()).toLocaleDateString()}</td>
                        <td>
                            <div class="flex gap-2">
                                <button onclick="adminApp.editUser('${user.id}')" class="text-blue-500">
                                    <i class="fa-solid fa-edit"></i>
                                </button>
                                <button onclick="adminApp.manageUserBalance('${user.id}', '${user.username}')" class="text-green-500">
                                    <i class="fa-solid fa-coins"></i>
                                </button>
                                <button onclick="adminApp.banUser('${user.id}', '${user.username}')" class="text-red-500">
                                    <i class="fa-solid fa-ban"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `}).join('');
            }

            filterUsers() {
                const filter = document.getElementById('userFilter').value;
                let filteredUsers = this.users;
                
                switch(filter) {
                    case 'online':
                        // This would require checking online status
                        break;
                    case 'banned':
                        filteredUsers = this.users.filter(u => u.status === 'banned');
                        break;
                    case 'high-balance':
                        filteredUsers = this.users.filter(u => (u.balance || 0) > 10000);
                        break;
                    case 'new':
                        const today = new Date().setHours(0, 0, 0, 0);
                        filteredUsers = this.users.filter(u => new Date(u.createdAt || Date.now()) >= today);
                        break;
                }
                
                const tbody = document.getElementById('usersTableBody');
                tbody.innerHTML = filteredUsers.map(user => {
                    const isSelected = this.selectedUsers.has(user.id);
                    return `
                    <tr>
                        <td>
                            <input type="checkbox" class="user-checkbox" data-user-id="${user.id}" ${isSelected ? 'checked' : ''} onchange="adminApp.toggleUserSelection('${user.id}')">
                        </td>
                        <td class="font-mono text-sm">${user.id.substring(0, 8)}...</td>
                        <td>${user.username}</td>
                        <td>${user.email || 'No email'}</td>
                        <td class="text-green-500 font-bold">${(user.balance || 0).toLocaleString()}</td>
                        <td><span class="status-badge ${user.status === 'banned' ? 'status-banned' : 'status-active'}">${user.status || 'Active'}</span></td>
                        <td>${new Date(user.createdAt || Date.now()).toLocaleDateString()}</td>
                        <td>
                            <div class="flex gap-2">
                                <button onclick="adminApp.editUser('${user.id}')" class="text-blue-500">
                                    <i class="fa-solid fa-edit"></i>
                                </button>
                                <button onclick="adminApp.manageUserBalance('${user.id}', '${user.username}')" class="text-green-500">
                                    <i class="fa-solid fa-coins"></i>
                                </button>
                                <button onclick="adminApp.banUser('${user.id}', '${user.username}')" class="text-red-500">
                                    <i class="fa-solid fa-ban"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `}).join('');
            }

            showAddUserModal() {
                document.getElementById('userModalTitle').textContent = 'Add New User';
                document.getElementById('modalUsername').value = '';
                document.getElementById('modalEmail').value = '';
                document.getElementById('modalPassword').value = '';
                document.getElementById('modalBalance').value = 500;
                document.getElementById('modalStatus').value = 'active';
                
                this.openModal('userModal');
            }

            editUser(userId) {
                const user = this.users.find(u => u.id === userId);
                if (!user) return;
                
                document.getElementById('userModalTitle').textContent = 'Edit User';
                document.getElementById('modalUsername').value = user.username;
                document.getElementById('modalEmail').value = user.email || '';
                document.getElementById('modalPassword').value = '';
                document.getElementById('modalBalance').value = user.balance || 0;
                document.getElementById('modalStatus').value = user.status || 'active';
                
                document.getElementById('userModal').dataset.userId = userId;
                
                this.openModal('userModal');
            }

            async saveUser() {
                const username = document.getElementById('modalUsername').value.trim();
                const email = document.getElementById('modalEmail').value.trim();
                const password = document.getElementById('modalPassword').value;
                const balance = parseInt(document.getElementById('modalBalance').value) || 0;
                const status = document.getElementById('modalStatus').value;
                const userId = document.getElementById('userModal').dataset.userId;
                
                if (!username) {
                    this.showToast('Username is required', 'error');
                    return;
                }
                
                try {
                    if (userId) {
                        // Update existing user
                        const updates = {
                            username,
                            email,
                            balance,
                            status
                        };
                        
                        if (password) {
                            updates.password = btoa(password);
                        }
                        
                        await database.ref('users/' + userId).update(updates);
                        this.showToast('User updated successfully', 'success');
                    } else {
                        // Create new user
                        const newUserId = 'admin_' + Date.now();
                        const userData = {
                            userId: newUserId,
                            username,
                            email,
                            password: btoa(password),
                            balance,
                            status,
                            createdAt: Date.now(),
                            createdBy: 'admin'
                        };
                        
                        await database.ref('users/' + newUserId).set(userData);
                        this.showToast('User created successfully', 'success');
                    }
                    
                    this.closeModal('userModal');
                    this.loadUsers();
                    
                } catch (error) {
                    console.error('Error saving user:', error);
                    this.showToast('Error saving user', 'error');
                }
            }

            manageUserBalance(userId, username) {
                document.getElementById('quickActionTitle').textContent = 'Manage Balance';
                document.getElementById('quickActionContent').innerHTML = `
                    <div class="space-y-4">
                        <div class="input-group">
                            <label>User: ${username}</label>
                            <div class="text-sm text-gray-400">User ID: ${userId}</div>
                        </div>
                        <div class="input-group">
                            <label>Action</label>
                            <select id="balanceAction" class="w-full">
                                <option value="add">Add Coins</option>
                                <option value="remove">Remove Coins</option>
                                <option value="set">Set Balance</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Amount</label>
                            <input type="number" id="balanceAmount" value="1000" class="w-full">
                        </div>
                        <div class="input-group">
                            <label>Reason</label>
                            <input type="text" id="balanceReason" placeholder="Reason for adjustment" class="w-full">
                        </div>
                        <button onclick="adminApp.performBalanceAdjustment('${userId}', '${username}')" class="btn btn-success w-full">
                            <i class="fa-solid fa-check"></i>
                            Apply Adjustment
                        </button>
                    </div>
                `;
                
                this.openModal('quickActionModal');
            }

            async performBalanceAdjustment(userId, username) {
                const action = document.getElementById('balanceAction').value;
                const amount = parseInt(document.getElementById('balanceAmount').value) || 0;
                const reason = document.getElementById('balanceReason').value.trim();
                
                if (!amount || amount <= 0) {
                    this.showToast('Please enter a valid amount', 'error');
                    return;
                }
                
                try {
                    const userRef = database.ref('users/' + userId);
                    const snapshot = await userRef.once('value');
                    const user = snapshot.val();
                    
                    if (!user) {
                        this.showToast('User not found', 'error');
                        return;
                    }
                    
                    let newBalance = user.balance || 0;
                    
                    switch(action) {
                        case 'add':
                            newBalance += amount;
                            break;
                        case 'remove':
                            newBalance = Math.max(0, newBalance - amount);
                            break;
                        case 'set':
                            newBalance = amount;
                            break;
                    }
                    
                    await userRef.update({ balance: newBalance });
                    
                    const transaction = {
                        type: 'admin_adjustment',
                        userId,
                        username,
                        action,
                        amount,
                        reason,
                        previousBalance: user.balance || 0,
                        newBalance,
                        timestamp: Date.now(),
                        admin: 'System'
                    };
                    
                    await database.ref('admin_logs').push(transaction);
                    await database.ref('transactions').push({
                        userId,
                        username,
                        amount,
                        type: 'admin_adjustment',
                        game: 'system',
                        timestamp: Date.now(),
                        details: reason
                    });
                    
                    this.showToast(`Balance adjusted successfully. New balance: ${newBalance.toLocaleString()}`, 'success');
                    this.closeModal('quickActionModal');
                    this.loadUsers();
                    
                } catch (error) {
                    console.error('Error adjusting balance:', error);
                    this.showToast('Error adjusting balance', 'error');
                }
            }

            banUser(userId, username) {
                this.showConfirm(
                    'Ban User',
                    `Are you sure you want to ban ${username}?`,
                    async () => {
                        try {
                            await database.ref('users/' + userId).update({ 
                                status: 'banned',
                                bannedAt: Date.now(),
                                bannedBy: 'admin'
                            });
                            
                            this.showToast(`User ${username} has been banned`, 'success');
                            this.loadUsers();
                        } catch (error) {
                            console.error('Error banning user:', error);
                            this.showToast('Error banning user', 'error');
                        }
                    }
                );
            }

            deleteUser(userId, username) {
                this.showConfirm(
                    'Delete User',
                    `Are you sure you want to permanently delete ${username}? This action cannot be undone!`,
                    async () => {
                        try {
                            await database.ref('users/' + userId).remove();
                            await database.ref('online/' + userId).remove();
                            this.showToast(`User ${username} has been deleted`, 'success');
                            this.loadUsers();
                        } catch (error) {
                            console.error('Error deleting user:', error);
                            this.showToast('Error deleting user', 'error');
                        }
                    }
                );
            }

            async loadTransactions() {
                try {
                    const snapshot = await database.ref('transactions').orderByChild('timestamp').limitToLast(1000).once('value');
                    this.transactions = [];
                    
                    snapshot.forEach(child => {
                        const tx = child.val();
                        tx.id = child.key;
                        this.transactions.push(tx);
                    });
                    
                    this.transactions.sort((a, b) => b.timestamp - a.timestamp);
                    
                    this.displayTransactions();
                } catch (error) {
                    console.error('Error loading transactions:', error);
                    this.showToast('Error loading transactions', 'error');
                }
            }

            displayTransactions(page = 1) {
                const tbody = document.getElementById('transactionsTableBody');
                const pagination = document.getElementById('transactionsPagination');
                
                if (this.transactions.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" class="text-center py-8 text-gray-500">
                                No transactions found
                            </td>
                        </tr>
                    `;
                    pagination.innerHTML = '';
                    return;
                }
                
                const totalPages = Math.ceil(this.transactions.length / this.itemsPerPage);
                const startIndex = (page - 1) * this.itemsPerPage;
                const endIndex = startIndex + this.itemsPerPage;
                const pageTransactions = this.transactions.slice(startIndex, endIndex);
                
                tbody.innerHTML = pageTransactions.map(tx => `
                    <tr>
                        <td class="font-mono text-sm">${tx.id.substring(0, 8)}...</td>
                        <td>
                            <div class="font-bold">${tx.username || 'System'}</div>
                            <div class="text-xs text-gray-500">${tx.userId ? tx.userId.substring(0, 8) + '...' : 'N/A'}</div>
                        </td>
                        <td>
                            <span class="status-badge ${tx.type === 'win' ? 'status-active' : tx.type === 'loss' ? 'status-banned' : 'status-pending'}">
                                ${tx.type}
                            </span>
                        </td>
                        <td class="${tx.type === 'win' ? 'text-green-500' : tx.type === 'loss' ? 'text-red-500' : 'text-yellow-500'} font-bold">
                            ${tx.type === 'win' ? '+' : tx.type === 'loss' ? '-' : ''}${(tx.amount || 0).toLocaleString()}
                        </td>
                        <td>${tx.game || 'system'}</td>
                        <td>
                            <div class="text-sm">${new Date(tx.timestamp).toLocaleDateString()}</div>
                            <div class="text-xs text-gray-500">${new Date(tx.timestamp).toLocaleTimeString()}</div>
                        </td>
                        <td>
                            <button onclick="adminApp.viewTransactionDetails('${tx.id}')" class="text-blue-500 hover:text-blue-400">
                                <i class="fa-solid fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
                
                let paginationHTML = '';
                for (let i = 1; i <= totalPages; i++) {
                    if (i === 1 || i === totalPages || (i >= page - 2 && i <= page + 2)) {
                        paginationHTML += `
                            <button onclick="adminApp.changePage('transactions', ${i})" class="${i === page ? 'active' : ''}">
                                ${i}
                            </button>
                        `;
                    } else if (i === page - 3 || i === page + 3) {
                        paginationHTML += '<span class="px-2">...</span>';
                    }
                }
                pagination.innerHTML = paginationHTML;
            }

            filterTransactions() {
                const typeFilter = document.getElementById('txTypeFilter').value;
                const gameFilter = document.getElementById('txGameFilter').value;
                const dateFrom = document.getElementById('txDateFrom').value;
                const dateTo = document.getElementById('txDateTo').value;
                
                let filtered = this.transactions;
                
                if (typeFilter !== 'all') {
                    filtered = filtered.filter(tx => tx.type === typeFilter);
                }
                
                if (gameFilter !== 'all') {
                    filtered = filtered.filter(tx => tx.game === gameFilter);
                }
                
                if (dateFrom) {
                    const fromDate = new Date(dateFrom).getTime();
                    filtered = filtered.filter(tx => tx.timestamp >= fromDate);
                }
                
                if (dateTo) {
                    const toDate = new Date(dateTo + 'T23:59:59').getTime();
                    filtered = filtered.filter(tx => tx.timestamp <= toDate);
                }
                
                const tbody = document.getElementById('transactionsTableBody');
                tbody.innerHTML = filtered.slice(0, 50).map(tx => `
                    <tr>
                        <td class="font-mono text-sm">${tx.id.substring(0, 8)}...</td>
                        <td>${tx.username || 'System'}</td>
                        <td>
                            <span class="status-badge ${tx.type === 'win' ? 'status-active' : tx.type === 'loss' ? 'status-banned' : 'status-pending'}">
                                ${tx.type}
                            </span>
                        </td>
                        <td class="${tx.type === 'win' ? 'text-green-500' : tx.type === 'loss' ? 'text-red-500' : 'text-yellow-500'} font-bold">
                            ${tx.type === 'win' ? '+' : tx.type === 'loss' ? '-' : ''}${(tx.amount || 0).toLocaleString()}
                        </td>
                        <td>${tx.game || 'system'}</td>
                        <td>${new Date(tx.timestamp).toLocaleString()}</td>
                        <td>
                            <button onclick="adminApp.viewTransactionDetails('${tx.id}')" class="text-blue-500">
                                <i class="fa-solid fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            }

            exportTransactions() {
                const csv = this.transactions.map(tx => 
                    `${tx.id},${tx.username || ''},${tx.type},${tx.amount || 0},${tx.game || ''},${new Date(tx.timestamp).toISOString()}`
                ).join('\n');
                
                const blob = new Blob(['Transaction ID,Username,Type,Amount,Game,Timestamp\n' + csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `transactions_${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                this.showToast('Transactions exported successfully', 'success');
            }

            viewTransactionDetails(txId) {
                const tx = this.transactions.find(t => t.id === txId);
                if (!tx) return;
                
                document.getElementById('quickActionTitle').textContent = 'Transaction Details';
                document.getElementById('quickActionContent').innerHTML = `
                    <div class="space-y-4">
                        <div class="input-group">
                            <label>Transaction ID</label>
                            <div class="text-sm font-mono bg-gray-800 p-2 rounded">${tx.id}</div>
                        </div>
                        <div class="input-group">
                            <label>User</label>
                            <div class="text-sm">${tx.username || 'System'} (${tx.userId || 'N/A'})</div>
                        </div>
                        <div class="input-group">
                            <label>Type</label>
                            <div class="text-sm"><span class="status-badge ${tx.type === 'win' ? 'status-active' : tx.type === 'loss' ? 'status-banned' : 'status-pending'}">${tx.type}</span></div>
                        </div>
                        <div class="input-group">
                            <label>Amount</label>
                            <div class="text-lg font-bold ${tx.type === 'win' ? 'text-green-500' : tx.type === 'loss' ? 'text-red-500' : 'text-yellow-500'}">
                                ${tx.type === 'win' ? '+' : tx.type === 'loss' ? '-' : ''}${(tx.amount || 0).toLocaleString()} coins
                            </div>
                        </div>
                        <div class="input-group">
                            <label>Game</label>
                            <div class="text-sm">${tx.game || 'system'}</div>
                        </div>
                        <div class="input-group">
                            <label>Timestamp</label>
                            <div class="text-sm">${new Date(tx.timestamp).toLocaleString()}</div>
                        </div>
                        ${tx.details ? `
                            <div class="input-group">
                                <label>Details</label>
                                <div class="text-sm bg-gray-800 p-2 rounded">${tx.details}</div>
                            </div>
                        ` : ''}
                    </div>
                `;
                
                this.openModal('quickActionModal');
            }

            async loadRecentActivity() {
                try {
                    const snapshot = await database.ref('transactions').orderByChild('timestamp').limitToLast(10).once('value');
                    const activities = [];
                    
                    snapshot.forEach(child => {
                        const tx = child.val();
                        activities.push(tx);
                    });
                    
                    activities.sort((a, b) => b.timestamp - a.timestamp);
                    
                    const container = document.getElementById('recentActivity');
                    container.innerHTML = activities.map(tx => `
                        <div class="flex items-center gap-3 p-3 bg-gray-800/50 rounded-lg">
                            <div class="w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-teal-400 flex items-center justify-center">
                                <i class="fa-solid fa-user text-white text-sm"></i>
                            </div>
                            <div class="flex-1">
                                <div class="text-sm">
                                    <span class="font-bold text-white">${tx.username}</span>
                                    <span class="text-gray-400">${tx.type === 'win' ? 'won' : tx.type === 'loss' ? 'lost' : 'transferred'}</span>
                                    <span class="font-bold ${tx.type === 'win' ? 'text-green-500' : tx.type === 'loss' ? 'text-red-500' : 'text-yellow-500'}">
                                        ${(tx.amount || 0).toLocaleString()} coins
                                    </span>
                                    <span class="text-gray-400">in ${tx.game || 'system'}</span>
                                </div>
                                <div class="text-xs text-gray-500">${new Date(tx.timestamp).toLocaleTimeString()}</div>
                            </div>
                        </div>
                    `).join('');
                    
                } catch (error) {
                    console.error('Error loading recent activity:', error);
                }
            }

            async loadAnnouncements() {
                try {
                    const snapshot = await database.ref('announcements').orderByChild('timestamp').limitToLast(10).once('value');
                    const announcements = [];
                    
                    snapshot.forEach(child => {
                        const ann = child.val();
                        ann.id = child.key;
                        announcements.push(ann);
                    });
                    
                    announcements.sort((a, b) => b.timestamp - a.timestamp);
                    
                    const container = document.getElementById('recentAnnouncements');
                    container.innerHTML = announcements.map(ann => `
                        <div class="p-3 bg-gray-800/50 rounded-lg border-l-4 ${ann.type === 'info' ? 'border-blue-500' : ann.type === 'success' ? 'border-green-500' : ann.type === 'warning' ? 'border-yellow-500' : 'border-red-500'}">
                            <div class="font-bold text-white mb-1">${ann.title}</div>
                            <div class="text-sm text-gray-300 mb-2">${ann.message}</div>
                            <div class="flex justify-between text-xs text-gray-500">
                                <span>${new Date(ann.timestamp).toLocaleString()}</span>
                                <button onclick="adminApp.deleteAnnouncement('${ann.id}')" class="text-red-500 hover:text-red-400">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `).join('');
                    
                } catch (error) {
                    console.error('Error loading announcements:', error);
                }
            }

            async sendAnnouncement() {
                const title = document.getElementById('announcementTitle').value.trim();
                const message = document.getElementById('announcementMessage').value.trim();
                const type = document.getElementById('announcementType').value;
                const important = document.getElementById('announcementImportant').checked;
                const popup = document.getElementById('announcementPopup').checked;
                
                if (!title || !message) {
                    this.showToast('Please fill all fields', 'error');
                    return;
                }
                
                try {
                    const announcement = {
                        title,
                        message,
                        type,
                        important,
                        popup,
                        timestamp: Date.now(),
                        sentBy: 'admin'
                    };
                    
                    await database.ref('announcements').push(announcement);
                    
                    await database.ref('chat').push({
                        username: 'System',
                        message: ` ${title}: ${message}`,
                        userId: 'system',
                        timestamp: Date.now(),
                        type: 'announcement'
                    });
                    
                    document.getElementById('announcementTitle').value = '';
                    document.getElementById('announcementMessage').value = '';
                    
                    this.showToast('Announcement sent successfully', 'success');
                    this.loadAnnouncements();
                    
                } catch (error) {
                    console.error('Error sending announcement:', error);
                    this.showToast('Error sending announcement', 'error');
                }
            }

            scheduleAnnouncement() {
                this.showToast('Scheduling feature coming soon!', 'info');
            }

            deleteAnnouncement(announcementId) {
                this.showConfirm(
                    'Delete Announcement',
                    'Are you sure you want to delete this announcement?',
                    async () => {
                        try {
                            await database.ref('announcements/' + announcementId).remove();
                            this.showToast('Announcement deleted', 'success');
                            this.loadAnnouncements();
                        } catch (error) {
                            console.error('Error deleting announcement:', error);
                            this.showToast('Error deleting announcement', 'error');
                        }
                    }
                );
            }

            async loadGameStats() {
                try {
                    const txSnapshot = await database.ref('transactions').once('value');
                    let totalGames = 0;
                    let totalWagered = 0;
                    let houseProfit = 0;
                    
                    txSnapshot.forEach(child => {
                        const tx = child.val();
                        if (tx.game && tx.game !== 'system') {
                            totalGames++;
                        }
                        if (tx.amount) {
                            if (tx.type === 'loss') {
                                houseProfit += tx.amount;
                            } else if (tx.type === 'win') {
                                houseProfit -= tx.amount;
                            }
                        }
                        if (tx.amount && tx.type !== 'transfer') {
                            totalWagered += tx.amount;
                        }
                    });
                    
                    document.getElementById('totalGamesPlayed').textContent = totalGames.toLocaleString();
                    document.getElementById('totalWagered').textContent = totalWagered.toLocaleString();
                    document.getElementById('houseProfit').textContent = houseProfit.toLocaleString();
                    
                } catch (error) {
                    console.error('Error loading game stats:', error);
                }
            }

            saveBlackjackSettings() {
                const minBet = document.getElementById('bjMinBet').value;
                const maxBet = document.getElementById('bjMaxBet').value;
                const dealerStand = document.getElementById('bjDealerStand').value;
                const payout = document.getElementById('bjPayout').value;
                
                localStorage.setItem('bj_settings', JSON.stringify({
                    minBet, maxBet, dealerStand, payout
                }));
                
                this.showToast('Blackjack settings saved', 'success');
            }

            saveMinesSettings() {
                const minBet = document.getElementById('minesMinBet').value;
                const maxBet = document.getElementById('minesMaxBet').value;
                const maxMines = document.getElementById('minesMaxMines').value;
                const houseEdge = document.getElementById('minesHouseEdge').value;
                
                localStorage.setItem('mines_settings', JSON.stringify({
                    minBet, maxBet, maxMines, houseEdge
                }));
                
                this.showToast('Mines settings saved', 'success');
            }

            resetGameStats() {
                this.showConfirm(
                    'Reset Game Statistics',
                    'Are you sure you want to reset all game statistics? This cannot be undone!',
                    async () => {
                        try {
                            const usersSnapshot = await database.ref('users').once('value');
                            const updates = {};
                            
                            usersSnapshot.forEach(child => {
                                updates[child.key + '/totalWins'] = 0;
                                updates[child.key + '/totalLosses'] = 0;
                                updates[child.key + '/biggestWin'] = 0;
                                updates[child.key + '/wageredToday'] = 0;
                                updates[child.key + '/wageredWeek'] = 0;
                                updates[child.key + '/wonToday'] = 0;
                            });
                            
                            await database.ref('users').update(updates);
                            
                            this.showToast('Game statistics reset successfully', 'success');
                            this.loadGameStats();
                            
                        } catch (error) {
                            console.error('Error resetting game stats:', error);
                            this.showToast('Error resetting game stats', 'error');
                        }
                    }
                );
            }

            recalculateStats() {
                this.loadGameStats();
                this.showToast('Statistics recalculated', 'success');
            }

            saveSystemSettings() {
                const siteName = document.getElementById('siteName').value;
                const startingBalance = document.getElementById('startingBalance').value;
                const freeCoinsAmount = document.getElementById('freeCoinsAmount').value;
                const freeCoinsCooldown = document.getElementById('freeCoinsCooldown').value;
                const maxTransferAmount = document.getElementById('maxTransferAmount').value;
                const adminKey = document.getElementById('adminKeyChange').value;
                const maxLoginAttempts = document.getElementById('maxLoginAttempts').value;
                const sessionTimeout = document.getElementById('sessionTimeout').value;
                
                const settings = {
                    siteName,
                    startingBalance,
                    freeCoinsAmount,
                    freeCoinsCooldown,
                    maxTransferAmount,
                    maxLoginAttempts,
                    sessionTimeout
                };
                
                if (adminKey) {
                    this.adminKey = adminKey;
                    localStorage.setItem('adminKey', adminKey);
                }
                
                localStorage.setItem('system_settings', JSON.stringify(settings));
                this.showToast('System settings saved', 'success');
            }

            toggleMaintenance() {
                this.showConfirm(
                    'Toggle Maintenance Mode',
                    'This will enable/disable maintenance mode for all users. Continue?',
                    async () => {
                        try {
                            const maintenanceRef = database.ref('system/maintenance');
                            const snapshot = await maintenanceRef.once('value');
                            const current = snapshot.val();
                            
                            await maintenanceRef.set(!current);
                            
                            this.showToast(`Maintenance mode ${!current ? 'enabled' : 'disabled'}`, 'success');
                            
                        } catch (error) {
                            console.error('Error toggling maintenance:', error);
                            this.showToast('Error toggling maintenance', 'error');
                        }
                    }
                );
            }

            backupDatabase() {
                this.showToast('Backup feature coming soon!', 'info');
            }

            clearCache() {
                localStorage.removeItem('system_settings');
                localStorage.removeItem('bj_settings');
                localStorage.removeItem('mines_settings');
                this.showToast('Cache cleared', 'success');
            }

            generateReport() {
                const type = document.getElementById('reportType').value;
                const format = document.getElementById('reportFormat').value;
                const dateFrom = document.getElementById('reportDateFrom').value;
                const dateTo = document.getElementById('reportDateTo').value;
                
                this.showToast(`Generating ${type} report in ${format} format...`, 'info');
                
                setTimeout(() => {
                    this.showToast('Report generated successfully!', 'success');
                }, 2000);
            }

            refreshAnalytics() {
                this.loadStats();
                this.loadGameStats();
                this.showToast('Analytics refreshed', 'success');
            }

            loadReports() {
                const reports = JSON.parse(localStorage.getItem('reports') || '[]');
                const tbody = document.getElementById('reportsTableBody');
                
                tbody.innerHTML = reports.map(report => `
                    <tr>
                        <td class="font-mono text-sm">${report.id}</td>
                        <td>${report.type}</td>
                        <td>${report.dateFrom} to ${report.dateTo}</td>
                        <td>${report.generatedBy}</td>
                        <td>
                            <button onclick="adminApp.downloadReport('${report.id}')" class="text-blue-500 hover:text-blue-400">
                                <i class="fa-solid fa-download"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            }

            downloadReport(reportId) {
                this.showToast('Downloading report...', 'info');
            }

            quickAction(action) {
                switch(action) {
                    case 'addCoins':
                        this.showAddCoinsQuickAction();
                        break;
                    case 'banUser':
                        this.showBanUserQuickAction();
                        break;
                    case 'sendAnnouncement':
                        this.showTab('announcements');
                        break;
                    case 'resetGame':
                        this.resetGameStats();
                        break;
                }
            }

            showAddCoinsQuickAction() {
                document.getElementById('quickActionTitle').textContent = 'Add Coins to User';
                document.getElementById('quickActionContent').innerHTML = `
                    <div class="space-y-4">
                        <div class="input-group">
                            <label>Username or User ID</label>
                            <input type="text" id="quickUsername" placeholder="Enter username or user ID" class="w-full">
                        </div>
                        <div class="input-group">
                            <label>Amount</label>
                            <input type="number" id="quickAmount" value="1000" class="w-full">
                        </div>
                        <button onclick="adminApp.performQuickAddCoins()" class="btn btn-success w-full">
                            <i class="fa-solid fa-check"></i>
                            Add Coins
                        </button>
                    </div>
                `;
                
                this.openModal('quickActionModal');
            }

            async performQuickAddCoins() {
                const username = document.getElementById('quickUsername').value.trim();
                const amount = parseInt(document.getElementById('quickAmount').value) || 0;
                
                if (!username || !amount) {
                    this.showToast('Please fill all fields', 'error');
                    return;
                }
                
                try {
                    const snapshot = await database.ref('users').orderByChild('username').equalTo(username).once('value');
                    
                    if (!snapshot.exists()) {
                        const idSnapshot = await database.ref('users/' + username).once('value');
                        if (!idSnapshot.exists()) {
                            this.showToast('User not found', 'error');
                            return;
                        }
                        
                        const user = idSnapshot.val();
                        const newBalance = (user.balance || 0) + amount;
                        await database.ref('users/' + username).update({ balance: newBalance });
                        this.showToast(`Added ${amount} coins to ${user.username}`, 'success');
                        
                    } else {
                        snapshot.forEach(async child => {
                            const user = child.val();
                            const newBalance = (user.balance || 0) + amount;
                            await database.ref('users/' + child.key).update({ balance: newBalance });
                            this.showToast(`Added ${amount} coins to ${user.username}`, 'success');
                        });
                    }
                    
                    this.closeModal('quickActionModal');
                    this.loadUsers();
                    
                } catch (error) {
                    console.error('Error adding coins:', error);
                    this.showToast('Error adding coins', 'error');
                }
            }

            showBanUserQuickAction() {
                document.getElementById('quickActionTitle').textContent = 'Ban User';
                document.getElementById('quickActionContent').innerHTML = `
                    <div class="space-y-4">
                        <div class="input-group">
                            <label>Username or User ID</label>
                            <input type="text" id="banUsername" placeholder="Enter username or user ID" class="w-full">
                        </div>
                        <div class="input-group">
                            <label>Reason</label>
                            <input type="text" id="banReason" placeholder="Reason for ban" class="w-full">
                        </div>
                        <div class="input-group">
                            <label>Duration</label>
                            <select id="banDuration" class="w-full">
                                <option value="1">1 Day</option>
                                <option value="7">1 Week</option>
                                <option value="30">1 Month</option>
                                <option value="0">Permanent</option>
                            </select>
                        </div>
                        <button onclick="adminApp.performQuickBan()" class="btn btn-danger w-full">
                            <i class="fa-solid fa-ban"></i>
                            Ban User
                        </button>
                    </div>
                `;
                
                this.openModal('quickActionModal');
            }

            async performQuickBan() {
                const username = document.getElementById('banUsername').value.trim();
                const reason = document.getElementById('banReason').value.trim();
                const duration = parseInt(document.getElementById('banDuration').value);
                
                if (!username) {
                    this.showToast('Please enter username', 'error');
                    return;
                }
                
                try {
                    const snapshot = await database.ref('users').orderByChild('username').equalTo(username).once('value');
                    
                    if (!snapshot.exists()) {
                        this.showToast('User not found', 'error');
                        return;
                    }
                    
                    snapshot.forEach(async child => {
                        const banData = {
                            status: 'banned',
                            bannedAt: Date.now(),
                            bannedBy: 'admin',
                            banReason: reason,
                            banDuration: duration
                        };
                        
                        if (duration > 0) {
                            banData.unbanAt = Date.now() + (duration * 24 * 60 * 60 * 1000);
                        }
                        
                        await database.ref('users/' + child.key).update(banData);
                        this.showToast(`User ${username} has been banned`, 'success');
                    });
                    
                    this.closeModal('quickActionModal');
                    this.loadUsers();
                    
                } catch (error) {
                    console.error('Error banning user:', error);
                    this.showToast('Error banning user', 'error');
                }
            }

            openModal(modalId) {
                document.getElementById(modalId).classList.add('active');
            }

            closeModal(modalId) {
                document.getElementById(modalId).classList.remove('active');
            }

            showConfirm(title, message, callback) {
                document.getElementById('confirmTitle').textContent = title;
                document.getElementById('confirmMessage').textContent = message;
                this.confirmCallback = callback;
                this.openModal('confirmModal');
            }

            confirmAction(confirmed) {
                this.closeModal('confirmModal');
                if (confirmed && this.confirmCallback) {
                    this.confirmCallback();
                }
                this.confirmCallback = null;
            }

            changePage(type, page) {
                this.currentPage[type] = page;
                if (type === 'users') {
                    this.displayUsers(page);
                } else if (type === 'transactions') {
                    this.displayTransactions(page);
                }
            }

            refreshStats() {
                this.loadStats();
                this.loadRecentActivity();
                this.showToast('Statistics refreshed', 'success');
            }
        }

        // Initialize the admin app
        const adminApp = new AdminApp();
    </script>
</body>
</html>
