<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moon Casino - Admin Panel</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary: #8b5cf6;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg-dark: #0b0e14;
            --bg-panel: #161b26;
            --border: #2a3042;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Space Grotesk', sans-serif;
            background: linear-gradient(135deg, #0f0720 0%, #000 100%);
            color: #b1bad3;
            min-height: 100vh;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(11, 14, 20, 0.5);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #8b5cf6, #10b981);
            border-radius: 4px;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Admin Card Styles */
        .admin-card {
            background: linear-gradient(145deg, #161b26, #11141c);
            border: 1px solid var(--border);
            border-radius: 12px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .admin-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #8b5cf6, #10b981, #8b5cf6);
            background-size: 200% 100%;
        }
        
        .admin-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.2);
        }
        
        /* Stats Cards */
        .stats-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.8));
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 16px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .stats-card:hover {
            transform: translateY(-2px);
            border-color: #8b5cf6;
        }
        
        .stats-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #8b5cf6, #10b981);
        }
        
        /* Button Styles */
        .btn-admin {
            background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
            color: white;
            transition: all 0.3s;
            font-weight: 600;
            border: none;
            position: relative;
            overflow: hidden;
        }
        
        .btn-admin:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(139,92,246,0.4);
        }
        
        .btn-admin::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.7s;
        }
        
        .btn-admin:hover::after {
            left: 100%;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        /* Modal */
        .modal {
            position: fixed;
            inset: 0;
            z-index: 50;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            animation: fadeIn 0.3s ease-out;
            padding: 16px;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: #161b26;
            border-radius: 16px;
            border: 1px solid #2a3042;
            box-shadow: 0 20px 40px -12px rgba(0, 0, 0, 0.8);
            max-width: 90%;
            width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideInRight 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 16px 20px;
            background: #1e293b;
            border-radius: 12px;
            border: 1px solid #334155;
            color: white;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            z-index: 1001;
            transform: translateX(100px) scale(0.8);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .toast.show {
            transform: translateX(0) scale(1);
            opacity: 1;
        }
        
        .toast.success {
            border-color: #10b981;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), #1e293b);
        }
        
        .toast.error {
            border-color: #ef4444;
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), #1e293b);
        }
        
        .toast.warning {
            border-color: #f59e0b;
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), #1e293b);
        }
        
        /* Table Styles */
        .admin-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .admin-table th {
            background: linear-gradient(135deg, #1e293b, #0f172a);
            color: #8b5cf6;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 0.5px;
            padding: 12px 16px;
            text-align: left;
            border-bottom: 2px solid #2a3042;
        }
        
        .admin-table td {
            padding: 12px 16px;
            border-bottom: 1px solid #2a3042;
            color: #b1bad3;
        }
        
        .admin-table tr:hover {
            background: rgba(139, 92, 246, 0.05);
        }
        
        /* Input Styles */
        .admin-input {
            width: 100%;
            background: linear-gradient(135deg, #0b0e14, #1e293b);
            border: 1px solid #2a3042;
            border-radius: 8px;
            padding: 12px 16px;
            color: white;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .admin-input:focus {
            outline: none;
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }
        
        /* Badge Styles */
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .badge-success {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .badge-danger {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .badge-warning {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }
        
        .badge-info {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid #2a3042;
            margin-bottom: 24px;
        }
        
        .tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            color: #b1bad3;
            font-weight: 600;
            cursor: pointer;
            position: relative;
            transition: all 0.3s;
        }
        
        .tab:hover {
            color: white;
        }
        
        .tab.active {
            color: #8b5cf6;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #8b5cf6, #10b981);
        }
        
        /* Loading Spinner */
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(139, 92, 246, 0.3);
            border-radius: 50%;
            border-top-color: #8b5cf6;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Chart Container */
        .chart-container {
            background: linear-gradient(145deg, #161b26, #11141c);
            border: 1px solid #2a3042;
            border-radius: 12px;
            padding: 20px;
            height: 300px;
        }
        
        /* User Status Indicators */
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-online {
            background: #10b981;
            box-shadow: 0 0 8px #10b981;
        }
        
        .status-offline {
            background: #6b7280;
        }
        
        .status-away {
            background: #f59e0b;
            box-shadow: 0 0 8px #f59e0b;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .modal-content {
                width: 100%;
                margin: 0 16px;
            }
            
            .tabs {
                overflow-x: auto;
                flex-wrap: nowrap;
            }
            
            .tab {
                padding: 12px 16px;
                white-space: nowrap;
            }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Navigation -->
    <nav class="h-16 bg-[#161b26]/95 backdrop-blur-xl flex items-center justify-between px-6 shadow-2xl border-b border-[#2a3042] sticky top-0 z-40">
        <div class="flex items-center gap-3">
            <div class="flex items-center gap-2 cursor-pointer group" onclick="window.location.href = 'index.html'">
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-[#8b5cf6] to-[#4c1d95] flex items-center justify-center shadow-lg">
                    <i class="fa-solid fa-shield text-white text-lg"></i>
                </div>
                <div class="text-2xl font-bold text-white">
                    Moon<span class="text-[#8b5cf6]">Admin</span>
                </div>
            </div>
        </div>
        
        <div class="flex items-center gap-4">
            <div class="bg-gradient-to-r from-[#0b0e14] to-[#1e2533] rounded-full px-3 py-1 border border-[#2a3042]">
                <span class="text-xs font-bold tracking-wider text-[#8b5cf6]">ADMIN PANEL</span>
            </div>
            
            <div class="flex items-center gap-3">
                <div class="text-right">
                    <div class="text-white font-bold text-sm" id="adminUsername">Loading...</div>
                    <div class="text-[#6b7280] text-xs" id="adminRole">Super Admin</div>
                </div>
                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-teal-400 flex items-center justify-center text-white font-bold text-sm border-2 border-[#161b26] shadow-lg">
                    A
                </div>
                <button onclick="admin.logout()" class="text-gray-400 hover:text-white transition-all duration-300 hover:scale-110">
                    <i class="fa-solid fa-right-from-bracket"></i>
                </button>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <div class="flex">
        <!-- Sidebar -->
        <aside class="w-64 bg-[#161b26]/95 backdrop-blur-xl border-r border-[#2a3042] min-h-[calc(100vh-64px)] sticky top-16">
            <div class="p-6">
                <div class="text-xs font-bold text-[#8b5cf6] mb-4 tracking-wider uppercase">Admin Navigation</div>
                
                <div class="space-y-1">
                    <button onclick="admin.switchTab('dashboard')" class="tab-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gradient-to-r hover:from-[#2a3042] hover:to-[#1e293b] text-[#b1bad3] hover:text-white font-medium transition-all duration-300" data-tab="dashboard">
                        <i class="fa-solid fa-chart-line w-4 text-center"></i> 
                        <span class="text-sm">Dashboard</span>
                    </button>
                    
                    <button onclick="admin.switchTab('users')" class="tab-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gradient-to-r hover:from-[#2a3042] hover:to-[#1e293b] text-[#b1bad3] hover:text-white font-medium transition-all duration-300" data-tab="users">
                        <i class="fa-solid fa-users w-4 text-center"></i> 
                        <span class="text-sm">User Management</span>
                    </button>
                    
                    <button onclick="admin.switchTab('transactions')" class="tab-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gradient-to-r hover:from-[#2a3042] hover:to-[#1e293b] text-[#b1bad3] hover:text-white font-medium transition-all duration-300" data-tab="transactions">
                        <i class="fa-solid fa-money-bill-transfer w-4 text-center"></i> 
                        <span class="text-sm">Transactions</span>
                    </button>
                    
                    <button onclick="admin.switchTab('games')" class="tab-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gradient-to-r hover:from-[#2a3042] hover:to-[#1e293b] text-[#b1bad3] hover:text-white font-medium transition-all duration-300" data-tab="games">
                        <i class="fa-solid fa-gamepad w-4 text-center"></i> 
                        <span class="text-sm">Game Settings</span>
                    </button>
                    
                    <button onclick="admin.switchTab('maintenance')" class="tab-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gradient-to-r hover:from-[#2a3042] hover:to-[#1e293b] text-[#b1bad3] hover:text-white font-medium transition-all duration-300" data-tab="maintenance">
                        <i class="fa-solid fa-tools w-4 text-center"></i> 
                        <span class="text-sm">Maintenance</span>
                    </button>
                    
                    <button onclick="admin.switchTab('broadcast')" class="tab-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gradient-to-r hover:from-[#2a3042] hover:to-[#1e293b] text-[#b1bad3] hover:text-white font-medium transition-all duration-300" data-tab="broadcast">
                        <i class="fa-solid fa-bullhorn w-4 text-center"></i> 
                        <span class="text-sm">Broadcast</span>
                    </button>
                    
                    <button onclick="admin.switchTab('system')" class="tab-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gradient-to-r hover:from-[#2a3042] hover:to-[#1e293b] text-[#b1bad3] hover:text-white font-medium transition-all duration-300" data-tab="system">
                        <i class="fa-solid fa-server w-4 text-center"></i> 
                        <span class="text-sm">System</span>
                    </button>
                    
                    <button onclick="admin.switchTab('reports')" class="tab-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gradient-to-r hover:from-[#2a3042] hover:to-[#1e293b] text-[#b1bad3] hover:text-white font-medium transition-all duration-300" data-tab="reports">
                        <i class="fa-solid fa-chart-pie w-4 text-center"></i> 
                        <span class="text-sm">Reports</span>
                    </button>
                    
                    <button onclick="admin.switchTab('logs')" class="tab-btn w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gradient-to-r hover:from-[#2a3042] hover:to-[#1e293b] text-[#b1bad3] hover:text-white font-medium transition-all duration-300" data-tab="logs">
                        <i class="fa-solid fa-clipboard-list w-4 text-center"></i> 
                        <span class="text-sm">Audit Logs</span>
                    </button>
                </div>
                
                <div class="h-px bg-gradient-to-r from-transparent via-[#2a3042] to-transparent my-6"></div>
                
                <div class="text-xs font-bold text-[#8b5cf6] mb-4 tracking-wider uppercase">Quick Actions</div>
                
                <div class="space-y-2">
                    <button onclick="admin.quickAction('flushChat')" class="w-full text-xs bg-gradient-to-r from-[#0b0e14] to-[#1e293b] border border-[#2a3042] text-[#b1bad3] rounded-lg py-2 px-3 hover:border-[#ef4444] hover:text-white transition-all duration-300 flex items-center gap-2">
                        <i class="fa-solid fa-trash text-xs"></i>
                        <span>Flush Chat</span>
                    </button>
                    
                    <button onclick="admin.quickAction('resetLeaderboard')" class="w-full text-xs bg-gradient-to-r from-[#0b0e14] to-[#1e293b] border border-[#2a3042] text-[#b1bad3] rounded-lg py-2 px-3 hover:border-[#f59e0b] hover:text-white transition-all duration-300 flex items-center gap-2">
                        <i class="fa-solid fa-trophy text-xs"></i>
                        <span>Reset Leaderboard</span>
                    </button>
                    
                    <button onclick="admin.quickAction('backupData')" class="w-full text-xs bg-gradient-to-r from-[#0b0e14] to-[#1e293b] border border-[#2a3042] text-[#b1bad3] rounded-lg py-2 px-3 hover:border-[#10b981] hover:text-white transition-all duration-300 flex items-center gap-2">
                        <i class="fa-solid fa-database text-xs"></i>
                        <span>Backup Data</span>
                    </button>
                </div>
            </div>
        </aside>
        
        <!-- Main Content Area -->
        <main class="flex-1 p-6" id="mainContent">
            <!-- Dashboard Tab -->
            <div id="dashboardTab" class="tab-content active">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-2xl font-bold text-white">Admin Dashboard</h1>
                    <div class="text-sm text-gray-400" id="lastUpdated">Last updated: Just now</div>
                </div>
                
                <!-- Stats Overview -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                    <div class="stats-card">
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="text-gray-400 text-sm mb-1">Total Users</div>
                                <div class="text-white font-bold text-2xl" id="totalUsers">0</div>
                            </div>
                            <i class="fa-solid fa-users text-2xl text-[#8b5cf6]"></i>
                        </div>
                        <div class="mt-3">
                            <div class="text-xs text-gray-400">Active: <span id="activeUsers" class="text-[#10b981] font-bold">0</span></div>
                        </div>
                    </div>
                    
                    <div class="stats-card">
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="text-gray-400 text-sm mb-1">Total Coins</div>
                                <div class="text-white font-bold text-2xl" id="totalCoins">0</div>
                            </div>
                            <i class="fa-solid fa-coins text-2xl text-[#f59e0b]"></i>
                        </div>
                        <div class="mt-3">
                            <div class="text-xs text-gray-400">In Circulation</div>
                        </div>
                    </div>
                    
                    <div class="stats-card">
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="text-gray-400 text-sm mb-1">Today's Wagers</div>
                                <div class="text-white font-bold text-2xl" id="todayWagers">0</div>
                            </div>
                            <i class="fa-solid fa-money-bill-wave text-2xl text-[#10b981]"></i>
                        </div>
                        <div class="mt-3">
                            <div class="text-xs text-gray-400">+<span id="todayGrowth" class="text-[#10b981] font-bold">0%</span> from yesterday</div>
                        </div>
                    </div>
                    
                    <div class="stats-card">
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="text-gray-400 text-sm mb-1">System Health</div>
                                <div class="text-white font-bold text-2xl" id="systemHealth">100%</div>
                            </div>
                            <i class="fa-solid fa-heart-pulse text-2xl text-[#ef4444]"></i>
                        </div>
                        <div class="mt-3">
                            <div id="healthStatus" class="text-xs badge badge-success">Healthy</div>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Activity -->
                <div class="admin-card p-6 mb-8">
                    <h2 class="text-lg font-bold text-white mb-4">Recent Activity</h2>
                    <div class="space-y-3" id="recentActivity">
                        <div class="flex items-center gap-3 p-3 bg-gradient-to-r from-[#0b0e14] to-[#1e293b] rounded-lg">
                            <div class="loading-spinner"></div>
                            <div class="text-gray-400">Loading activity...</div>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Stats -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="admin-card p-6">
                        <h2 class="text-lg font-bold text-white mb-4">Game Performance</h2>
                        <div class="space-y-4" id="gameStats">
                            <div class="flex items-center justify-between p-3 bg-gradient-to-r from-[#0b0e14] to-[#1e293b] rounded-lg">
                                <div class="text-gray-400">Loading game stats...</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="admin-card p-6">
                        <h2 class="text-lg font-bold text-white mb-4">Server Status</h2>
                        <div class="space-y-4" id="serverStatus">
                            <div class="space-y-3">
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-400">Database</span>
                                    <span class="badge badge-success">Online</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-400">Chat Service</span>
                                    <span class="badge badge-success">Online</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-400">Game Servers</span>
                                    <span class="badge badge-success">Online</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-400">Uptime</span>
                                    <span class="text-white font-mono" id="serverUptime">0d 0h 0m</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Users Management Tab -->
            <div id="usersTab" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-2xl font-bold text-white">User Management</h1>
                    <div class="flex gap-2">
                        <button onclick="admin.showAddUserModal()" class="btn-admin px-4 py-2 rounded-lg text-sm">
                            <i class="fa-solid fa-plus mr-1"></i> Add User
                        </button>
                        <button onclick="admin.refreshUsers()" class="bg-gradient-to-r from-[#0b0e14] to-[#1e293b] border border-[#2a3042] text-white px-4 py-2 rounded-lg text-sm hover:border-[#8b5cf6] transition-all duration-300">
                            <i class="fa-solid fa-rotate mr-1"></i> Refresh
                        </button>
                    </div>
                </div>
                
                <!-- Search and Filters -->
                <div class="admin-card p-6 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <input type="text" id="userSearch" placeholder="Search username or email..." class="admin-input" oninput="admin.searchUsers()">
                        <select id="userFilter" class="admin-input" onchange="admin.filterUsers()">
                            <option value="all">All Users</option>
                            <option value="online">Online Only</option>
                            <option value="banned">Banned</option>
                            <option value="admin">Admins</option>
                        </select>
                        <select id="userSort" class="admin-input" onchange="admin.sortUsers()">
                            <option value="balance_desc">Balance (High to Low)</option>
                            <option value="balance_asc">Balance (Low to High)</option>
                            <option value="created_desc">Newest First</option>
                            <option value="created_asc">Oldest First</option>
                        </select>
                        <button onclick="admin.exportUsers()" class="btn-success px-4 py-2 rounded-lg text-sm">
                            <i class="fa-solid fa-download mr-1"></i> Export
                        </button>
                    </div>
                </div>
                
                <!-- Users Table -->
                <div class="admin-card p-6">
                    <div class="overflow-x-auto">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Balance</th>
                                    <th>Status</th>
                                    <th>Created</th>
                                    <th>Wager/Loss</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <tr>
                                    <td colspan="6" class="text-center py-8 text-gray-400">
                                        <div class="loading-spinner mx-auto mb-3"></div>
                                        Loading users...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="flex justify-between items-center mt-4">
                        <div class="text-sm text-gray-400" id="usersCount">Showing 0 users</div>
                        <div class="flex gap-2">
                            <button onclick="admin.prevUsersPage()" class="px-3 py-1 bg-gradient-to-r from-[#0b0e14] to-[#1e293b] border border-[#2a3042] rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                                <i class="fa-solid fa-chevron-left"></i>
                            </button>
                            <span class="px-3 py-1 text-sm text-gray-400" id="usersPage">Page 1</span>
                            <button onclick="admin.nextUsersPage()" class="px-3 py-1 bg-gradient-to-r from-[#0b0e14] to-[#1e293b] border border-[#2a3042] rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                                <i class="fa-solid fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Transactions Tab -->
            <div id="transactionsTab" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-2xl font-bold text-white">Transaction Management</h1>
                    <div class="flex gap-2">
                        <button onclick="admin.exportTransactions()" class="btn-success px-4 py-2 rounded-lg text-sm">
                            <i class="fa-solid fa-download mr-1"></i> Export CSV
                        </button>
                        <button onclick="admin.refreshTransactions()" class="bg-gradient-to-r from-[#0b0e14] to-[#1e293b] border border-[#2a3042] text-white px-4 py-2 rounded-lg text-sm hover:border-[#8b5cf6] transition-all duration-300">
                            <i class="fa-solid fa-rotate mr-1"></i> Refresh
                        </button>
                    </div>
                </div>
                
                <!-- Filters -->
                <div class="admin-card p-6 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                        <input type="date" id="txDateFrom" class="admin-input">
                        <input type="date" id="txDateTo" class="admin-input">
                        <select id="txType" class="admin-input">
                            <option value="all">All Types</option>
                            <option value="win">Wins</option>
                            <option value="loss">Losses</option>
                            <option value="transfer">Transfers</option>
                            <option value="deposit">Deposits</option>
                        </select>
                        <input type="text" id="txUser" placeholder="Username" class="admin-input">
                        <button onclick="admin.filterTransactions()" class="btn-admin px-4 py-2 rounded-lg text-sm">
                            <i class="fa-solid fa-filter mr-1"></i> Filter
                        </button>
                    </div>
                </div>
                
                <!-- Transactions Table -->
                <div class="admin-card p-6">
                    <div class="overflow-x-auto">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>User</th>
                                    <th>Type</th>
                                    <th>Amount</th>
                                    <th>Game</th>
                                    <th>Details</th>
                                </tr>
                            </thead>
                            <tbody id="transactionsTableBody">
                                <tr>
                                    <td colspan="6" class="text-center py-8 text-gray-400">
                                        <div class="loading-spinner mx-auto mb-3"></div>
                                        Loading transactions...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="flex justify-between items-center mt-4">
                        <div class="text-sm text-gray-400" id="transactionsCount">Showing 0 transactions</div>
                        <div class="flex gap-2">
                            <button onclick="admin.prevTransactionsPage()" class="px-3 py-1 bg-gradient-to-r from-[#0b0e14] to-[#1e293b] border border-[#2a3042] rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                                <i class="fa-solid fa-chevron-left"></i>
                            </button>
                            <span class="px-3 py-1 text-sm text-gray-400" id="transactionsPage">Page 1</span>
                            <button onclick="admin.nextTransactionsPage()" class="px-3 py-1 bg-gradient-to-r from-[#0b0e14] to-[#1e293b] border border-[#2a3042] rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                                <i class="fa-solid fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Game Settings Tab -->
            <div id="gamesTab" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-2xl font-bold text-white">Game Settings</h1>
                </div>
                
                <!-- Game Controls -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="admin-card p-6">
                        <h2 class="text-lg font-bold text-white mb-4">House Edge Settings</h2>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <span class="text-gray-400">Mines Game</span>
                                <div class="flex items-center gap-2">
                                    <input type="number" id="minesEdge" value="0.02" step="0.01" min="0" max="1" class="admin-input w-20">
                                    <span class="text-white">%</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-400">Blackjack</span>
                                <div class="flex items-center gap-2">
                                    <input type="number" id="blackjackEdge" value="0.5" step="0.1" min="0" max="10" class="admin-input w-20">
                                    <span class="text-white">%</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-400">Chicken Road</span>
                                <div class="flex items-center gap-2">
                                    <input type="number" id="chickenEdge" value="0.15" step="0.01" min="0" max="1" class="admin-input w-20">
                                    <span class="text-white">%</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-400">Coinflip</span>
                                <div class="flex items-center gap-2">
                                    <input type="number" id="coinflipEdge" value="1.85" step="0.01" min="1" max="5" class="admin-input w-20">
                                    <span class="text-white">×</span>
                                </div>
                            </div>
                            <button onclick="admin.saveGameSettings()" class="btn-admin w-full py-2 rounded-lg mt-4">
                                Save House Edge Settings
                            </button>
                        </div>
                    </div>
                    
                    <div class="admin-card p-6">
                        <h2 class="text-lg font-bold text-white mb-4">Game Controls</h2>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <span class="text-gray-400">Disable All Games</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="disableAllGames" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600"></div>
                                </label>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-400">Disable Chat</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="disableChat" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600"></div>
                                </label>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-400">Disable Transfers</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="disableTransfers" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600"></div>
                                </label>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-400">Free Coins</span>
                                <div class="flex items-center gap-2">
                                    <input type="number" id="freeCoinsAmount" value="500" min="1" max="10000" class="admin-input w-24">
                                    <span class="text-white">coins</span>
                                </div>
                            </div>
                            <button onclick="admin.saveGameControls()" class="btn-admin w-full py-2 rounded-lg mt-4">
                                Save Game Controls
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Individual Game Settings -->
                <div class="admin-card p-6">
                    <h2 class="text-lg font-bold text-white mb-4">Individual Game Settings</h2>
                    <div class="tabs mb-6">
                        <button class="tab active" onclick="admin.switchGameTab('mines')">Mines</button>
                        <button class="tab" onclick="admin.switchGameTab('blackjack')">Blackjack</button>
                        <button class="tab" onclick="admin.switchGameTab('chicken')">Chicken Road</button>
                        <button class="tab" onclick="admin.switchGameTab('coinflip')">Coinflip</button>
                    </div>
                    
                    <div id="minesSettings" class="game-settings">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-gray-400 text-sm mb-1 block">Max Mines</label>
                                <input type="number" id="minesMax" value="24" min="1" max="24" class="admin-input">
                            </div>
                            <div>
                                <label class="text-gray-400 text-sm mb-1 block">Grid Size</label>
                                <select id="minesGridSize" class="admin-input">
                                    <option value="25">5×5</option>
                                    <option value="36">6×6</option>
                                    <option value="49">7×7</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-gray-400 text-sm mb-1 block">Min Bet</label>
                                <input type="number" id="minesMinBet" value="1" min="1" class="admin-input">
                            </div>
                            <div>
                                <label class="text-gray-400 text-sm mb-1 block">Max Bet</label>
                                <input type="number" id="minesMaxBet" value="1000000" min="1" class="admin-input">
                            </div>
                        </div>
                    </div>
                    
                    <div id="otherGameSettings" class="game-settings hidden">
                        <!-- Other game settings would go here -->
                    </div>
                    
                    <button onclick="admin.saveIndividualGameSettings()" class="btn-admin w-full py-2 rounded-lg mt-6">
                        Save Game Settings
                    </button>
                </div>
            </div>
            
            <!-- Maintenance Tab -->
            <div id="maintenanceTab" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-2xl font-bold text-white">Maintenance Control</h1>
                </div>
                
                <!-- Maintenance Controls -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="admin-card p-6">
                        <h2 class="text-lg font-bold text-white mb-4">Maintenance Mode</h2>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <span class="text-gray-400">Maintenance Status</span>
                                <span id="maintenanceStatus" class="badge badge-success">Active</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-400">Time Remaining</span>
                                <span id="maintenanceTime" class="text-white font-mono">00:00:00</span>
                            </div>
                            <div>
                                <label class="text-gray-400 text-sm mb-1 block">Duration (minutes)</label>
                                <input type="number" id="maintenanceDuration" value="30" min="1" max="1440" class="admin-input">
                            </div>
                            <div>
                                <label class="text-gray-400 text-sm mb-1 block">Message</label>
                                <textarea id="maintenanceMessage" class="admin-input" rows="3">The casino is undergoing scheduled maintenance. We'll be back soon!</textarea>
                            </div>
                            <div class="flex gap-2 mt-4">
                                <button onclick="admin.enableMaintenance()" class="btn-warning flex-1 py-2 rounded-lg">
                                    Enable Maintenance
                                </button>
                                <button onclick="admin.disableMaintenance()" class="btn-success flex-1 py-2 rounded-lg">
                                    Disable Maintenance
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="admin-card p-6">
                        <h2 class="text-lg font-bold text-white mb-4">Database Operations</h2>
                        <div class="space-y-4">
                            <button onclick="admin.backupDatabase()" class="w-full bg-gradient-to-r from-[#0b0e14] to-[#1e293b] border border-[#2a3042] text-white py-3 rounded-lg hover:border-[#10b981] transition-all duration-300 flex items-center justify-center gap-2">
                                <i class="fa-solid fa-database"></i>
                                Create Database Backup
                            </button>
                            
                            <button onclick="admin.flushChat()" class="w-full bg-gradient-to-r from-[#0b0e14] to-[#1e293b] border border-[#2a3042] text-white py-3 rounded-lg hover:border-[#ef4444] transition-all duration-300 flex items-center justify-center gap-2">
                                <i class="fa-solid fa-trash"></i>
                                Flush All Chat Messages
                            </button>
                            
                            <button onclick="admin.clearOldTransactions()" class="w-full bg-gradient-to-r from-[#0b0e14] to-[#1e293b] border border-[#2a3042] text-white py-3 rounded-lg hover:border-[#f59e0b] transition-all duration-300 flex items-center justify-center gap-2">
                                <i class="fa-solid fa-clock-rotate-left"></i>
                                Clear Old Transactions (30+ days)
                            </button>
                            
                            <div class="mt-6">
                                <label class="text-gray-400 text-sm mb-1 block">Reset Leaderboard</label>
                                <button onclick="admin.resetLeaderboard()" class="w-full btn-danger py-3 rounded-lg">
                                    Reset All Leaderboard Stats
                                </button>
                                <p class="text-xs text-gray-500 mt-2">Warning: This will reset all user stats to zero</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Broadcast Tab -->
            <div id="broadcastTab" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-2xl font-bold text-white">Broadcast Messages</h1>
                </div>
                
                <!-- Broadcast Form -->
                <div class="admin-card p-6 mb-8">
                    <h2 class="text-lg font-bold text-white mb-4">Send Broadcast</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="text-gray-400 text-sm mb-1 block">Message Type</label>
                            <div class="flex gap-2 mb-4">
                                <label class="flex items-center gap-2">
                                    <input type="radio" name="broadcastType" value="normal" checked>
                                    <span class="text-gray-400">Normal</span>
                                </label>
                                <label class="flex items-center gap-2">
                                    <input type="radio" name="broadcastType" value="warning">
                                    <span class="text-gray-400">Warning</span>
                                </label>
                                <label class="flex items-center gap-2">
                                    <input type="radio" name="broadcastType" value="announcement">
                                    <span class="text-gray-400">Announcement</span>
                                </label>
                                <label class="flex items-center gap-2">
                                    <input type="radio" name="broadcastType" value="promotion">
                                    <span class="text-gray-400">Promotion</span>
                                </label>
                            </div>
                        </div>
                        
                        <div>
                            <label class="text-gray-400 text-sm mb-1 block">Target</label>
                            <select id="broadcastTarget" class="admin-input">
                                <option value="all">All Users</option>
                                <option value="online">Online Users Only</option>
                                <option value="specific">Specific User</option>
                            </select>
                        </div>
                        
                        <div id="specificUserField" class="hidden">
                            <label class="text-gray-400 text-sm mb-1 block">Username</label>
                            <input type="text" id="broadcastUsername" class="admin-input" placeholder="Enter username">
                        </div>
                        
                        <div>
                            <label class="text-gray-400 text-sm mb-1 block">Message</label>
                            <textarea id="broadcastMessage" class="admin-input" rows="4" placeholder="Enter your broadcast message"></textarea>
                        </div>
                        
                        <div>
                            <label class="text-gray-400 text-sm mb-1 block">Duration (seconds)</label>
                            <input type="number" id="broadcastDuration" value="10" min="5" max="60" class="admin-input">
                        </div>
                        
                        <button onclick="admin.sendBroadcast()" class="btn-admin w-full py-3 rounded-lg mt-4">
                            <i class="fa-solid fa-bullhorn mr-2"></i> Send Broadcast
                        </button>
                    </div>
                </div>
                
                <!-- Recent Broadcasts -->
                <div class="admin-card p-6">
                    <h2 class="text-lg font-bold text-white mb-4">Recent Broadcasts</h2>
                    <div class="space-y-3" id="recentBroadcasts">
                        <div class="text-center py-8 text-gray-400">
                            No broadcasts sent yet
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- System Tab -->
            <div id="systemTab" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-2xl font-bold text-white">System Configuration</h1>
                </div>
                
                <!-- System Settings -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="admin-card p-6">
                        <h2 class="text-lg font-bold text-white mb-4">General Settings</h2>
                        <div class="space-y-4">
                            <div>
                                <label class="text-gray-400 text-sm mb-1 block">Site Name</label>
                                <input type="text" id="siteName" value="Moon Casino" class="admin-input">
                            </div>
                            <div>
                                <label class="text-gray-400 text-sm mb-1 block">Starting Balance</label>
                                <input type="number" id="startingBalance" value="500" min="0" class="admin-input">
                            </div>
                            <div>
                                <label class="text-gray-400 text-sm mb-1 block">Free Coins Cooldown (minutes)</label>
                                <input type="number" id="freeCoinsCooldown" value="5" min="1" class="admin-input">
                            </div>
                            <div>
                                <label class="text-gray-400 text-sm mb-1 block">Transfer Fee (%)</label>
                                <input type="number" id="transferFee" value="10" min="0" max="50" class="admin-input">
                            </div>
                            <button onclick="admin.saveGeneralSettings()" class="btn-admin w-full py-2 rounded-lg mt-4">
                                Save General Settings
                            </button>
                        </div>
                    </div>
                    
                    <div class="admin-card p-6">
                        <h2 class="text-lg font-bold text-white mb-4">Security Settings</h2>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <span class="text-gray-400">Enable 2FA for Admins</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="enable2FA" class="sr-only peer" checked>
                                    <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-400">IP Tracking</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="enableIPTracking" class="sr-only peer" checked>
                                    <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-400">Session Timeout (minutes)</span>
                                <input type="number" id="sessionTimeout" value="30" min="5" max="1440" class="admin-input w-24">
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-400">Max Login Attempts</span>
                                <input type="number" id="maxLoginAttempts" value="5" min="1" max="20" class="admin-input w-24">
                            </div>
                            <button onclick="admin.saveSecuritySettings()" class="btn-admin w-full py-2 rounded-lg mt-4">
                                Save Security Settings
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Admin Users -->
                <div class="admin-card p-6">
                    <h2 class="text-lg font-bold text-white mb-4">Admin Users</h2>
                    <div class="overflow-x-auto">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Username</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Last Active</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="adminUsersTable">
                                <tr>
                                    <td colspan="5" class="text-center py-8 text-gray-400">
                                        Loading admin users...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button onclick="admin.showAddAdminModal()" class="btn-admin px-4 py-2 rounded-lg mt-4">
                        <i class="fa-solid fa-plus mr-1"></i> Add Admin User
                    </button>
                </div>
            </div>
            
            <!-- Reports Tab -->
            <div id="reportsTab" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-2xl font-bold text-white">Reports & Analytics</h1>
                    <div class="flex gap-2">
                        <button onclick="admin.exportReport()" class="btn-success px-4 py-2 rounded-lg text-sm">
                            <i class="fa-solid fa-file-export mr-1"></i> Export Report
                        </button>
                        <button onclick="admin.refreshReports()" class="bg-gradient-to-r from-[#0b0e14] to-[#1e293b] border border-[#2a3042] text-white px-4 py-2 rounded-lg text-sm hover:border-[#8b5cf6] transition-all duration-300">
                            <i class="fa-solid fa-rotate mr-1"></i> Refresh
                        </button>
                    </div>
                </div>
                
                <!-- Date Range Selector -->
                <div class="admin-card p-6 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="text-gray-400 text-sm mb-1 block">Date Range</label>
                            <select id="reportRange" class="admin-input" onchange="admin.changeReportRange()">
                                <option value="today">Today</option>
                                <option value="yesterday">Yesterday</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                                <option value="custom">Custom Range</option>
                            </select>
                        </div>
                        <div id="customDateFrom" class="hidden">
                            <label class="text-gray-400 text-sm mb-1 block">From</label>
                            <input type="date" id="reportDateFrom" class="admin-input">
                        </div>
                        <div id="customDateTo" class="hidden">
                            <label class="text-gray-400 text-sm mb-1 block">To</label>
                            <input type="date" id="reportDateTo" class="admin-input">
                        </div>
                    </div>
                </div>
                
                <!-- Reports Overview -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                    <div class="stats-card">
                        <div class="text-gray-400 text-sm mb-1">Total Wagers</div>
                        <div class="text-white font-bold text-2xl" id="reportTotalWagers">0</div>
                        <div class="text-xs text-gray-400 mt-2">This period</div>
                    </div>
                    
                    <div class="stats-card">
                        <div class="text-gray-400 text-sm mb-1">Total Wins</div>
                        <div class="text-white font-bold text-2xl" id="reportTotalWins">0</div>
                        <div class="text-xs text-gray-400 mt-2">This period</div>
                    </div>
                    
                    <div class="stats-card">
                        <div class="text-gray-400 text-sm mb-1">House Profit</div>
                        <div class="text-white font-bold text-2xl" id="reportHouseProfit">0</div>
                        <div class="text-xs text-gray-400 mt-2">This period</div>
                    </div>
                    
                    <div class="stats-card">
                        <div class="text-gray-400 text-sm mb-1">New Users</div>
                        <div class="text-white font-bold text-2xl" id="reportNewUsers">0</div>
                        <div class="text-xs text-gray-400 mt-2">This period</div>
                    </div>
                </div>
                
                <!-- Game Performance Report -->
                <div class="admin-card p-6 mb-8">
                    <h2 class="text-lg font-bold text-white mb-4">Game Performance</h2>
                    <div class="overflow-x-auto">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Game</th>
                                    <th>Total Plays</th>
                                    <th>Total Wagers</th>
                                    <th>Total Wins</th>
                                    <th>House Edge</th>
                                    <th>Profit</th>
                                </tr>
                            </thead>
                            <tbody id="gamePerformanceTable">
                                <tr>
                                    <td colspan="6" class="text-center py-8 text-gray-400">
                                        Loading game performance data...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- User Activity Report -->
                <div class="admin-card p-6">
                    <h2 class="text-lg font-bold text-white mb-4">Top Users This Period</h2>
                    <div class="overflow-x-auto">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Wagered</th>
                                    <th>Won</th>
                                    <th>Net Profit/Loss</th>
                                    <th>Games Played</th>
                                </tr>
                            </thead>
                            <tbody id="topUsersTable">
                                <tr>
                                    <td colspan="5" class="text-center py-8 text-gray-400">
                                        Loading user data...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Audit Logs Tab -->
            <div id="logsTab" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-2xl font-bold text-white">Audit Logs</h1>
                    <div class="flex gap-2">
                        <button onclick="admin.clearOldLogs()" class="btn-danger px-4 py-2 rounded-lg text-sm">
                            <i class="fa-solid fa-trash mr-1"></i> Clear Old Logs
                        </button>
                        <button onclick="admin.refreshLogs()" class="bg-gradient-to-r from-[#0b0e14] to-[#1e293b] border border-[#2a3042] text-white px-4 py-2 rounded-lg text-sm hover:border-[#8b5cf6] transition-all duration-300">
                            <i class="fa-solid fa-rotate mr-1"></i> Refresh
                        </button>
                    </div>
                </div>
                
                <!-- Log Filters -->
                <div class="admin-card p-6 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <select id="logLevel" class="admin-input">
                            <option value="all">All Levels</option>
                            <option value="info">Info</option>
                            <option value="warning">Warning</option>
                            <option value="error">Error</option>
                            <option value="security">Security</option>
                        </select>
                        <select id="logType" class="admin-input">
                            <option value="all">All Types</option>
                            <option value="user">User Actions</option>
                            <option value="system">System Events</option>
                            <option value="admin">Admin Actions</option>
                            <option value="game">Game Events</option>
                        </select>
                        <input type="text" id="logSearch" placeholder="Search logs..." class="admin-input">
                        <button onclick="admin.filterLogs()" class="btn-admin px-4 py-2 rounded-lg text-sm">
                            <i class="fa-solid fa-filter mr-1"></i> Filter
                        </button>
                    </div>
                </div>
                
                <!-- Audit Logs -->
                <div class="admin-card p-6">
                    <div class="space-y-4 max-h-[600px] overflow-y-auto" id="auditLogs">
                        <div class="text-center py-8 text-gray-400">
                            <div class="loading-spinner mx-auto mb-3"></div>
                            Loading audit logs...
                        </div>
                    </div>
                    
                    <div class="flex justify-between items-center mt-4">
                        <div class="text-sm text-gray-400" id="logsCount">Showing 0 logs</div>
                        <div class="flex gap-2">
                            <button onclick="admin.prevLogsPage()" class="px-3 py-1 bg-gradient-to-r from-[#0b0e14] to-[#1e293b] border border-[#2a3042] rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                                <i class="fa-solid fa-chevron-left"></i>
                            </button>
                            <span class="px-3 py-1 text-sm text-gray-400" id="logsPage">Page 1</span>
                            <button onclick="admin.nextLogsPage()" class="px-3 py-1 bg-gradient-to-r from-[#0b0e14] to-[#1e293b] border border-[#2a3042] rounded text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                                <i class="fa-solid fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Toast Container -->
    <div id="toastContainer"></div>
    
    <!-- Add User Modal -->
    <div id="addUserModal" class="modal">
        <div class="modal-content p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-white">Add New User</h2>
                <button onclick="admin.closeModal('addUserModal')" class="text-gray-400 hover:text-white">
                    <i class="fa-solid fa-xmark text-lg"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="text-gray-400 text-sm mb-1 block">Username</label>
                    <input type="text" id="newUsername" class="admin-input" placeholder="Enter username">
                </div>
                <div>
                    <label class="text-gray-400 text-sm mb-1 block">Email</label>
                    <input type="email" id="newEmail" class="admin-input" placeholder="Enter email">
                </div>
                <div>
                    <label class="text-gray-400 text-sm mb-1 block">Password</label>
                    <input type="password" id="newPassword" class="admin-input" placeholder="Enter password">
                </div>
                <div>
                    <label class="text-gray-400 text-sm mb-1 block">Initial Balance</label>
                    <input type="number" id="newBalance" value="500" min="0" class="admin-input">
                </div>
                <div>
                    <label class="text-gray-400 text-sm mb-1 block">Role</label>
                    <select id="newUserRole" class="admin-input">
                        <option value="user">Regular User</option>
                        <option value="moderator">Moderator</option>
                        <option value="admin">Administrator</option>
                    </select>
                </div>
                
                <div class="flex gap-2 pt-4">
                    <button onclick="admin.addNewUser()" class="btn-admin flex-1 py-3 rounded-lg">
                        Add User
                    </button>
                    <button onclick="admin.closeModal('addUserModal')" class="bg-gradient-to-r from-[#0b0e14] to-[#1e293b] border border-[#2a3042] text-white flex-1 py-3 rounded-lg">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Admin Modal -->
    <div id="addAdminModal" class="modal">
        <div class="modal-content p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-white">Add Admin User</h2>
                <button onclick="admin.closeModal('addAdminModal')" class="text-gray-400 hover:text-white">
                    <i class="fa-solid fa-xmark text-lg"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="text-gray-400 text-sm mb-1 block">Select User</label>
                    <select id="existingUserSelect" class="admin-input">
                        <option value="">Select existing user...</option>
                    </select>
                </div>
                <div class="text-center text-gray-400 text-sm">OR</div>
                <div>
                    <label class="text-gray-400 text-sm mb-1 block">Create New Admin</label>
                    <input type="text" id="adminUsername" class="admin-input" placeholder="Username">
                </div>
                <div>
                    <label class="text-gray-400 text-sm mb-1 block">Admin Level</label>
                    <select id="adminLevel" class="admin-input">
                        <option value="moderator">Moderator</option>
                        <option value="admin">Administrator</option>
                        <option value="superadmin">Super Admin</option>
                    </select>
                </div>
                <div>
                    <label class="text-gray-400 text-sm mb-1 block">Permissions</label>
                    <div class="space-y-2">
                        <label class="flex items-center gap-2">
                            <input type="checkbox" id="permUsers" checked>
                            <span class="text-gray-400 text-sm">Manage Users</span>
                        </label>
                        <label class="flex items-center gap-2">
                            <input type="checkbox" id="permGames" checked>
                            <span class="text-gray-400 text-sm">Manage Games</span>
                        </label>
                        <label class="flex items-center gap-2">
                            <input type="checkbox" id="permSystem" checked>
                            <span class="text-gray-400 text-sm">System Settings</span>
                        </label>
                        <label class="flex items-center gap-2">
                            <input type="checkbox" id="permBroadcast" checked>
                            <span class="text-gray-400 text-sm">Send Broadcasts</span>
                        </label>
                    </div>
                </div>
                
                <div class="flex gap-2 pt-4">
                    <button onclick="admin.addAdminUser()" class="btn-admin flex-1 py-3 rounded-lg">
                        Add Admin
                    </button>
                    <button onclick="admin.closeModal('addAdminModal')" class="bg-gradient-to-r from-[#0b0e14] to-[#1e293b] border border-[#2a3042] text-white flex-1 py-3 rounded-lg">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Edit User Modal -->
    <div id="editUserModal" class="modal">
        <div class="modal-content p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-white">Edit User</h2>
                <button onclick="admin.closeModal('editUserModal')" class="text-gray-400 hover:text-white">
                    <i class="fa-solid fa-xmark text-lg"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <input type="hidden" id="editUserId">
                <div>
                    <label class="text-gray-400 text-sm mb-1 block">Username</label>
                    <input type="text" id="editUsername" class="admin-input">
                </div>
                <div>
                    <label class="text-gray-400 text-sm mb-1 block">Email</label>
                    <input type="email" id="editEmail" class="admin-input">
                </div>
                <div>
                    <label class="text-gray-400 text-sm mb-1 block">Balance</label>
                    <input type="number" id="editBalance" class="admin-input">
                </div>
                <div>
                    <label class="text-gray-400 text-sm mb-1 block">Status</label>
                    <select id="editStatus" class="admin-input">
                        <option value="active">Active</option>
                        <option value="banned">Banned</option>
                        <option value="suspended">Suspended</option>
                    </select>
                </div>
                <div>
                    <label class="text-gray-400 text-sm mb-1 block">Add/Remove Coins</label>
                    <input type="number" id="adjustCoins" class="admin-input" placeholder="Amount (negative to remove)">
                </div>
                
                <div class="flex gap-2 pt-4">
                    <button onclick="admin.saveUserChanges()" class="btn-admin flex-1 py-3 rounded-lg">
                        Save Changes
                    </button>
                    <button onclick="admin.closeModal('editUserModal')" class="bg-gradient-to-r from-[#0b0e14] to-[#1e293b] border border-[#2a3042] text-white flex-1 py-3 rounded-lg">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
          apiKey: "AIzaSyDJ5tpQ5pVY2A8L55Eg5SxB_L02dIHWcWA",
          authDomain: "cool-club-31ec4.firebaseapp.com",
          databaseURL: "https://cool-club-31ec4-default-rtdb.firebaseio.com",
          projectId: "cool-club-31ec4",
          storageBucket: "cool-club-31ec4.firebasestorage.app",
          messagingSenderId: "218577130374",
          appId: "1:218577130374:web:e345bf0d4ee0a68d029207",
          measurementId: "G-BFSY9J2PQW"
        };


        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        class AdminPanel {
            constructor() {
                this.adminUser = null;
                this.currentTab = 'dashboard';
                this.users = [];
                this.filteredUsers = [];
                this.transactions = [];
                this.filteredTransactions = [];
                this.logs = [];
                this.filteredLogs = [];
                
                // Pagination
                this.usersPage = 1;
                this.usersPerPage = 10;
                this.transactionsPage = 1;
                this.transactionsPerPage = 20;
                this.logsPage = 1;
                this.logsPerPage = 20;
                
                // Initialize
                this.init();
            }

            init() {
                this.checkAdminAuth();
                this.setupEventListeners();
                this.loadDashboardData();
                this.startAutoRefresh();
            }

            checkAdminAuth() {
                const adminData = localStorage.getItem('moonCasinoUser'); // Changed from moonCasinoAdmin to moonCasinoUser
                if (!adminData) {
                    // Redirect to main site or show login
                    window.location.href = 'index.html';
                    return;
                }

                try {
                    this.adminUser = JSON.parse(adminData);
                    document.getElementById('adminUsername').textContent = this.adminUser.username;
                    
                    // For security, validate against database
                    this.validateAdminSession();
                } catch (e) {
                    window.location.href = 'index.html';
                }
            }

            async validateAdminSession() {
                try {
                    const snapshot = await database.ref('admins/' + this.adminUser.userId).once('value');
                    if (!snapshot.exists()) {
                        this.logout();
                        return;
                    }
                } catch (error) {
                    console.error('Admin validation error:', error);
                }
            }

            logout() {
                localStorage.removeItem('moonCasinoAdmin');
                window.location.href = 'index.html';
            }

            setupEventListeners() {
                // Broadcast target change
                document.getElementById('broadcastTarget').addEventListener('change', (e) => {
                    const specificField = document.getElementById('specificUserField');
                    specificField.classList.toggle('hidden', e.target.value !== 'specific');
                });
            }

            switchTab(tabName) {
                // Hide all tabs
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                    tab.classList.add('hidden');
                });
                
                // Show selected tab
                const tab = document.getElementById(tabName + 'Tab');
                tab.classList.remove('hidden');
                tab.classList.add('active');
                
                // Update tab buttons
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('bg-gradient-to-r', 'from-[#2a3042]', 'to-[#1e293b]', 'text-white');
                });
                
                const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
                if (activeBtn) {
                    activeBtn.classList.add('bg-gradient-to-r', 'from-[#2a3042]', 'to-[#1e293b]', 'text-white');
                }
                
                this.currentTab = tabName;
                
                // Load tab-specific data
                switch(tabName) {
                    case 'dashboard':
                        this.loadDashboardData();
                        break;
                    case 'users':
                        this.loadUsers();
                        break;
                    case 'transactions':
                        this.loadTransactions();
                        break;
                    case 'reports':
                        this.loadReports();
                        break;
                    case 'logs':
                        this.loadLogs();
                        break;
                }
            }

            switchGameTab(game) {
                document.querySelectorAll('.game-settings').forEach(el => {
                    el.classList.add('hidden');
                });
                document.getElementById(game + 'Settings')?.classList.remove('hidden');
                
                document.querySelectorAll('.game-settings-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                event.target.classList.add('active');
            }

            startAutoRefresh() {
                // Refresh dashboard every 30 seconds
                setInterval(() => {
                    if (this.currentTab === 'dashboard') {
                        this.loadDashboardData();
                    }
                }, 30000);
            }

            showToast(message, type = 'success') {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.innerHTML = `
                    <div class="flex items-center gap-3">
                        <i class="fa-solid ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-exclamation-triangle'} text-lg"></i>
                        <span class="font-medium text-sm">${message}</span>
                    </div>
                `;
                
                document.getElementById('toastContainer').appendChild(toast);
                
                setTimeout(() => {
                    toast.classList.add('show');
                }, 10);
                
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }

            showModal(modalId) {
                document.getElementById(modalId).classList.add('active');
            }

            closeModal(modalId) {
                document.getElementById(modalId).classList.remove('active');
            }

            // DASHBOARD FUNCTIONS
            async loadDashboardData() {
                try {
                    // Load total users
                    const usersSnapshot = await database.ref('users').once('value');
                    const totalUsers = usersSnapshot.numChildren();
                    document.getElementById('totalUsers').textContent = totalUsers.toLocaleString();
                    
                    // Load online users
                    const onlineSnapshot = await database.ref('online').once('value');
                    const onlineUsers = onlineSnapshot.numChildren();
                    document.getElementById('activeUsers').textContent = onlineUsers.toLocaleString();
                    
                    // Load total coins
                    let totalCoins = 0;
                    usersSnapshot.forEach(child => {
                        const user = child.val();
                        totalCoins += user.balance || 0;
                    });
                    document.getElementById('totalCoins').textContent = totalCoins.toLocaleString();
                    
                    // Load today's wagers (simplified - would need proper tracking)
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);
                    const txSnapshot = await database.ref('transactions').orderByChild('timestamp').startAt(today.getTime()).once('value');
                    let todayWagers = 0;
                    txSnapshot.forEach(child => {
                        const tx = child.val();
                        if (tx.type === 'loss' || tx.type === 'win') {
                            todayWagers += tx.amount || 0;
                        }
                    });
                    document.getElementById('todayWagers').textContent = todayWagers.toLocaleString();
                    
                    // Update timestamp
                    document.getElementById('lastUpdated').textContent = 'Last updated: ' + new Date().toLocaleTimeString();
                    
                    // Load recent activity
                    this.loadRecentActivity();
                    this.loadGameStats();
                    
                } catch (error) {
                    console.error('Error loading dashboard data:', error);
                    this.showToast('Error loading dashboard data', 'error');
                }
            }

            async loadRecentActivity() {
                const container = document.getElementById('recentActivity');
                if (!container) return;
                
                try {
                    // Get recent transactions
                    const snapshot = await database.ref('transactions').orderByChild('timestamp').limitToLast(10).once('value');
                    const activities = [];
                    
                    snapshot.forEach(child => {
                        const tx = child.val();
                        activities.push({
                            time: tx.timestamp,
                            type: tx.type,
                            username: tx.username,
                            amount: tx.amount,
                            game: tx.game || 'System'
                        });
                    });
                    
                    // Sort by time (newest first)
                    activities.sort((a, b) => b.time - a.time);
                    
                    container.innerHTML = activities.map(activity => {
                        const time = new Date(activity.time).toLocaleTimeString();
                        let icon, color, text;
                        
                        switch(activity.type) {
                            case 'win':
                                icon = 'fa-trophy';
                                color = 'text-[#10b981]';
                                text = `${activity.username} won ${activity.amount.toLocaleString()} coins in ${activity.game}`;
                                break;
                            case 'loss':
                                icon = 'fa-skull';
                                color = 'text-[#ef4444]';
                                text = `${activity.username} lost ${activity.amount.toLocaleString()} coins in ${activity.game}`;
                                break;
                            case 'transfer':
                                icon = 'fa-money-bill-transfer';
                                color = 'text-[#3b82f6]';
                                text = `${activity.username} transferred ${activity.amount.toLocaleString()} coins`;
                                break;
                            default:
                                icon = 'fa-info-circle';
                                color = 'text-gray-400';
                                text = `System activity`;
                        }
                        
                        return `
                            <div class="flex items-center gap-3 p-3 bg-gradient-to-r from-[#0b0e14] to-[#1e293b] rounded-lg fade-in">
                                <i class="fa-solid ${icon} ${color}"></i>
                                <div class="flex-1">
                                    <div class="text-white text-sm">${text}</div>
                                    <div class="text-gray-500 text-xs">${time}</div>
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                } catch (error) {
                    container.innerHTML = '<div class="text-center text-gray-400">Error loading activity</div>';
                }
            }

            async loadGameStats() {
                const container = document.getElementById('gameStats');
                if (!container) return;
                
                // Simplified game stats - would need proper tracking
                const games = ['Mines', 'Blackjack', 'Chicken Road', 'Coinflip'];
                
                container.innerHTML = games.map(game => `
                    <div class="flex items-center justify-between p-3 bg-gradient-to-r from-[#0b0e14] to-[#1e293b] rounded-lg">
                        <div>
                            <div class="text-white font-medium">${game}</div>
                            <div class="text-gray-500 text-xs">Today's plays: ${Math.floor(Math.random() * 100)}</div>
                        </div>
                        <div class="text-right">
                            <div class="text-[#10b981] font-bold">${Math.floor(Math.random() * 10000).toLocaleString()} coins</div>
                            <div class="text-gray-500 text-xs">Profit</div>
                        </div>
                    </div>
                `).join('');
            }

            // USER MANAGEMENT FUNCTIONS
            async loadUsers() {
                try {
                    const snapshot = await database.ref('users').once('value');
                    this.users = [];
                    
                    snapshot.forEach(child => {
                        const user = child.val();
                        this.users.push({
                            id: child.key,
                            ...user
                        });
                    });
                    
                    this.filteredUsers = [...this.users];
                    this.renderUsersTable();
                    
                } catch (error) {
                    console.error('Error loading users:', error);
                    this.showToast('Error loading users', 'error');
                }
            }

            renderUsersTable() {
                const tbody = document.getElementById('usersTableBody');
                if (!tbody) return;
                
                // Apply pagination
                const start = (this.usersPage - 1) * this.usersPerPage;
                const end = start + this.usersPerPage;
                const pageUsers = this.filteredUsers.slice(start, end);
                
                if (pageUsers.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center py-8 text-gray-400">
                                No users found
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                tbody.innerHTML = pageUsers.map(user => {
                    const created = new Date(user.createdAt || Date.now()).toLocaleDateString();
                    const isOnline = user.lastSeen && (Date.now() - user.lastSeen < 30000);
                    
                    return `
                        <tr class="fade-in">
                            <td>
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-teal-400 flex items-center justify-center text-white font-bold text-xs">
                                        ${user.username?.charAt(0).toUpperCase() || 'U'}
                                    </div>
                                    <div>
                                        <div class="text-white font-medium">${user.username || 'Unknown'}</div>
                                        <div class="text-gray-500 text-xs">${user.email || 'No email'}</div>
                                    </div>
                                </div>
                            </td>
                            <td class="font-mono font-bold ${user.balance >= 1000 ? 'text-[#10b981]' : 'text-white'}">
                                ${(user.balance || 0).toLocaleString()}
                            </td>
                            <td>
                                <div class="flex items-center gap-2">
                                    <span class="status-indicator ${isOnline ? 'status-online' : 'status-offline'}"></span>
                                    <span class="text-sm">${isOnline ? 'Online' : 'Offline'}</span>
                                </div>
                            </td>
                            <td class="text-gray-400 text-sm">${created}</td>
                            <td>
                                <div class="text-sm">
                                    <div class="text-[#10b981]">Won: ${user.totalWins || 0}</div>
                                    <div class="text-[#ef4444]">Lost: ${user.totalLosses || 0}</div>
                                </div>
                            </td>
                            <td>
                                <div class="flex gap-2">
                                    <button onclick="admin.editUser('${user.id}')" class="text-blue-400 hover:text-blue-300 transition-colors">
                                        <i class="fa-solid fa-edit"></i>
                                    </button>
                                    <button onclick="admin.deleteUser('${user.id}', '${user.username}')" class="text-red-400 hover:text-red-300 transition-colors">
                                        <i class="fa-solid fa-trash"></i>
                                    </button>
                                    <button onclick="admin.resetUser('${user.id}', '${user.username}')" class="text-yellow-400 hover:text-yellow-300 transition-colors">
                                        <i class="fa-solid fa-rotate-left"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');
                
                // Update pagination info
                document.getElementById('usersCount').textContent = `Showing ${start + 1}-${Math.min(end, this.filteredUsers.length)} of ${this.filteredUsers.length} users`;
                document.getElementById('usersPage').textContent = `Page ${this.usersPage}`;
                
                // Disable previous button if on first page
                document.querySelector('[onclick="admin.prevUsersPage()"]').disabled = this.usersPage === 1;
                // Disable next button if on last page
                document.querySelector('[onclick="admin.nextUsersPage()"]').disabled = end >= this.filteredUsers.length;
            }

            searchUsers() {
                const searchTerm = document.getElementById('userSearch').value.toLowerCase();
                this.filteredUsers = this.users.filter(user => 
                    user.username?.toLowerCase().includes(searchTerm) ||
                    user.email?.toLowerCase().includes(searchTerm)
                );
                this.usersPage = 1;
                this.renderUsersTable();
            }

            filterUsers() {
                const filter = document.getElementById('userFilter').value;
                
                switch(filter) {
                    case 'online':
                        this.filteredUsers = this.users.filter(user => 
                            user.lastSeen && (Date.now() - user.lastSeen < 30000)
                        );
                        break;
                    case 'banned':
                        this.filteredUsers = this.users.filter(user => user.status === 'banned');
                        break;
                    case 'admin':
                        // This would need admin field in user data
                        this.filteredUsers = this.users;
                        break;
                    default:
                        this.filteredUsers = [...this.users];
                }
                
                this.usersPage = 1;
                this.renderUsersTable();
            }

            sortUsers() {
                const sort = document.getElementById('userSort').value;
                
                this.filteredUsers.sort((a, b) => {
                    switch(sort) {
                        case 'balance_desc':
                            return (b.balance || 0) - (a.balance || 0);
                        case 'balance_asc':
                            return (a.balance || 0) - (b.balance || 0);
                        case 'created_desc':
                            return (b.createdAt || 0) - (a.createdAt || 0);
                        case 'created_asc':
                            return (a.createdAt || 0) - (b.createdAt || 0);
                        default:
                            return 0;
                    }
                });
                
                this.usersPage = 1;
                this.renderUsersTable();
            }

            prevUsersPage() {
                if (this.usersPage > 1) {
                    this.usersPage--;
                    this.renderUsersTable();
                }
            }

            nextUsersPage() {
                if (this.usersPage * this.usersPerPage < this.filteredUsers.length) {
                    this.usersPage++;
                    this.renderUsersTable();
                }
            }

            showAddUserModal() {
                this.showModal('addUserModal');
            }

            async addNewUser() {
                const username = document.getElementById('newUsername').value.trim();
                const email = document.getElementById('newEmail').value.trim();
                const password = document.getElementById('newPassword').value;
                const balance = parseInt(document.getElementById('newBalance').value) || 500;
                const role = document.getElementById('newUserRole').value;

                if (!username || !email || !password) {
                    this.showToast('Please fill all required fields', 'error');
                    return;
                }

                try {
                    const userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    const userData = {
                        userId,
                        username,
                        email,
                        password: btoa(password),
                        balance,
                        role,
                        createdAt: Date.now(),
                        lastFreeCoins: 0,
                        freeCoinsCooldown: 0,
                        totalWins: 0,
                        totalLosses: 0,
                        biggestWin: 0
                    };

                    await database.ref('users/' + userId).set(userData);
                    
                    this.closeModal('addUserModal');
                    this.showToast(`User ${username} added successfully`, 'success');
                    this.loadUsers();
                    
                    // Clear form
                    document.getElementById('newUsername').value = '';
                    document.getElementById('newEmail').value = '';
                    document.getElementById('newPassword').value = '';
                    document.getElementById('newBalance').value = '500';
                    
                } catch (error) {
                    console.error('Error adding user:', error);
                    this.showToast('Error adding user', 'error');
                }
            }

            async editUser(userId) {
                const user = this.users.find(u => u.id === userId);
                if (!user) return;

                document.getElementById('editUserId').value = userId;
                document.getElementById('editUsername').value = user.username || '';
                document.getElementById('editEmail').value = user.email || '';
                document.getElementById('editBalance').value = user.balance || 0;
                document.getElementById('editStatus').value = user.status || 'active';
                document.getElementById('adjustCoins').value = '';

                this.showModal('editUserModal');
            }

            async saveUserChanges() {
                const userId = document.getElementById('editUserId').value;
                const username = document.getElementById('editUsername').value.trim();
                const email = document.getElementById('editEmail').value.trim();
                const balance = parseInt(document.getElementById('editBalance').value) || 0;
                const status = document.getElementById('editStatus').value;
                const adjustCoins = parseInt(document.getElementById('adjustCoins').value) || 0;

                try {
                    const updates = {
                        username,
                        email,
                        balance: balance + adjustCoins,
                        status
                    };

                    await database.ref('users/' + userId).update(updates);
                    
                    // Record adjustment if any
                    if (adjustCoins !== 0) {
                        await database.ref('admin_logs').push({
                            adminId: this.adminUser.userId,
                            adminName: this.adminUser.username,
                            action: adjustCoins > 0 ? 'add_coins' : 'remove_coins',
                            targetUserId: userId,
                            targetUsername: username,
                            amount: Math.abs(adjustCoins),
                            timestamp: Date.now(),
                            details: `Admin adjusted balance by ${adjustCoins} coins`
                        });
                    }

                    this.closeModal('editUserModal');
                    this.showToast('User updated successfully', 'success');
                    this.loadUsers();
                    
                } catch (error) {
                    console.error('Error updating user:', error);
                    this.showToast('Error updating user', 'error');
                }
            }

            async deleteUser(userId, username) {
                if (!confirm(`Are you sure you want to delete user "${username}"? This action cannot be undone.`)) {
                    return;
                }

                try {
                    await database.ref('users/' + userId).remove();
                    this.showToast(`User ${username} deleted`, 'success');
                    this.loadUsers();
                } catch (error) {
                    console.error('Error deleting user:', error);
                    this.showToast('Error deleting user', 'error');
                }
            }

            async resetUser(userId, username) {
                if (!confirm(`Reset all stats for user "${username}"?`)) {
                    return;
                }

                try {
                    const updates = {
                        totalWins: 0,
                        totalLosses: 0,
                        biggestWin: 0,
                        wageredToday: 0,
                        wageredWeek: 0
                    };

                    await database.ref('users/' + userId).update(updates);
                    this.showToast(`User ${username} stats reset`, 'success');
                    this.loadUsers();
                } catch (error) {
                    console.error('Error resetting user:', error);
                    this.showToast('Error resetting user', 'error');
                }
            }

            // TRANSACTION FUNCTIONS
            async loadTransactions() {
                try {
                    const snapshot = await database.ref('transactions').orderByChild('timestamp').limitToLast(1000).once('value');
                    this.transactions = [];
                    
                    snapshot.forEach(child => {
                        const tx = child.val();
                        this.transactions.push({
                            id: child.key,
                            ...tx
                        });
                    });
                    
                    // Sort by timestamp (newest first)
                    this.transactions.sort((a, b) => b.timestamp - a.timestamp);
                    this.filteredTransactions = [...this.transactions];
                    this.renderTransactionsTable();
                    
                } catch (error) {
                    console.error('Error loading transactions:', error);
                    this.showToast('Error loading transactions', 'error');
                }
            }

            renderTransactionsTable() {
                const tbody = document.getElementById('transactionsTableBody');
                if (!tbody) return;
                
                const start = (this.transactionsPage - 1) * this.transactionsPerPage;
                const end = start + this.transactionsPerPage;
                const pageTxs = this.filteredTransactions.slice(start, end);
                
                if (pageTxs.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center py-8 text-gray-400">
                                No transactions found
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                tbody.innerHTML = pageTxs.map(tx => {
                    const time = new Date(tx.timestamp).toLocaleString();
                    let typeBadge, amountColor, icon;
                    
                    switch(tx.type) {
                        case 'win':
                            typeBadge = '<span class="badge badge-success">Win</span>';
                            amountColor = 'text-[#10b981]';
                            icon = 'fa-trophy';
                            break;
                        case 'loss':
                            typeBadge = '<span class="badge badge-danger">Loss</span>';
                            amountColor = 'text-[#ef4444]';
                            icon = 'fa-skull';
                            break;
                        case 'transfer':
                            typeBadge = '<span class="badge badge-info">Transfer</span>';
                            amountColor = 'text-[#3b82f6]';
                            icon = 'fa-money-bill-transfer';
                            break;
                        default:
                            typeBadge = '<span class="badge badge-warning">Other</span>';
                            amountColor = 'text-gray-400';
                            icon = 'fa-info-circle';
                    }
                    
                    return `
                        <tr class="fade-in">
                            <td class="text-gray-400 text-sm">${time}</td>
                            <td>
                                <div class="text-white font-medium">${tx.username || 'Unknown'}</div>
                                ${tx.userId ? `<div class="text-gray-500 text-xs">${tx.userId.substring(0, 8)}...</div>` : ''}
                            </td>
                            <td>${typeBadge}</td>
                            <td class="${amountColor} font-bold font-mono">
                                <i class="fa-solid ${icon} mr-1"></i>
                                ${tx.amount?.toLocaleString() || 0}
                            </td>
                            <td class="text-gray-400">${tx.game || 'N/A'}</td>
                            <td>
                                <button onclick="admin.viewTransactionDetails('${tx.id}')" class="text-blue-400 hover:text-blue-300 text-sm">
                                    View
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');
                
                // Update pagination
                document.getElementById('transactionsCount').textContent = 
                    `Showing ${start + 1}-${Math.min(end, this.filteredTransactions.length)} of ${this.filteredTransactions.length} transactions`;
                document.getElementById('transactionsPage').textContent = `Page ${this.transactionsPage}`;
            }

            filterTransactions() {
                const dateFrom = document.getElementById('txDateFrom').value;
                const dateTo = document.getElementById('txDateTo').value;
                const type = document.getElementById('txType').value;
                const user = document.getElementById('txUser').value.toLowerCase();
                
                this.filteredTransactions = this.transactions.filter(tx => {
                    // Filter by date
                    if (dateFrom) {
                        const txDate = new Date(tx.timestamp);
                        const filterDate = new Date(dateFrom);
                        filterDate.setHours(0, 0, 0, 0);
                        if (txDate < filterDate) return false;
                    }
                    
                    if (dateTo) {
                        const txDate = new Date(tx.timestamp);
                        const filterDate = new Date(dateTo);
                        filterDate.setHours(23, 59, 59, 999);
                        if (txDate > filterDate) return false;
                    }
                    
                    // Filter by type
                    if (type !== 'all' && tx.type !== type) return false;
                    
                    // Filter by user
                    if (user && !tx.username?.toLowerCase().includes(user)) return false;
                    
                    return true;
                });
                
                this.transactionsPage = 1;
                this.renderTransactionsTable();
            }

            prevTransactionsPage() {
                if (this.transactionsPage > 1) {
                    this.transactionsPage--;
                    this.renderTransactionsTable();
                }
            }

            nextTransactionsPage() {
                if (this.transactionsPage * this.transactionsPerPage < this.filteredTransactions.length) {
                    this.transactionsPage++;
                    this.renderTransactionsTable();
                }
            }

            viewTransactionDetails(txId) {
                const tx = this.transactions.find(t => t.id === txId);
                if (!tx) return;
                
                alert(`Transaction Details:\n\n` +
                      `User: ${tx.username}\n` +
                      `Type: ${tx.type}\n` +
                      `Amount: ${tx.amount}\n` +
                      `Game: ${tx.game || 'N/A'}\n` +
                      `Time: ${new Date(tx.timestamp).toLocaleString()}\n` +
                      `ID: ${tx.id}`);
            }

            // MAINTENANCE FUNCTIONS
            async enableMaintenance() {
                const duration = parseInt(document.getElementById('maintenanceDuration').value) || 30;
                const message = document.getElementById('maintenanceMessage').value || 'The casino is undergoing scheduled maintenance.';
                
                const endTime = Date.now() + (duration * 60 * 1000);
                
                try {
                    await database.ref('maintenance').set({
                        enabled: true,
                        endTime: endTime,
                        message: message,
                        startedBy: this.adminUser.username,
                        startedAt: Date.now()
                    });
                    
                    this.showToast(`Maintenance enabled for ${duration} minutes`, 'success');
                    this.startMaintenanceTimer();
                    
                } catch (error) {
                    console.error('Error enabling maintenance:', error);
                    this.showToast('Error enabling maintenance', 'error');
                }
            }

            async disableMaintenance() {
                try {
                    await database.ref('maintenance').remove();
                    this.showToast('Maintenance disabled', 'success');
                    document.getElementById('maintenanceStatus').textContent = 'Inactive';
                    document.getElementById('maintenanceStatus').className = 'badge badge-success';
                    document.getElementById('maintenanceTime').textContent = '00:00:00';
                    
                } catch (error) {
                    console.error('Error disabling maintenance:', error);
                    this.showToast('Error disabling maintenance', 'error');
                }
            }

            startMaintenanceTimer() {
                // This would listen to real-time updates for maintenance status
                database.ref('maintenance').on('value', (snapshot) => {
                    if (snapshot.exists()) {
                        const data = snapshot.val();
                        const now = Date.now();
                        const endTime = data.endTime;
                        
                        if (now < endTime) {
                            const remaining = endTime - now;
                            const hours = Math.floor(remaining / (1000 * 60 * 60));
                            const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                            const seconds = Math.floor((remaining % (1000 * 60)) / 1000);
                            
                            document.getElementById('maintenanceStatus').textContent = 'Active';
                            document.getElementById('maintenanceStatus').className = 'badge badge-warning';
                            document.getElementById('maintenanceTime').textContent = 
                                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                        } else {
                            // Maintenance should have ended
                            this.disableMaintenance();
                        }
                    } else {
                        document.getElementById('maintenanceStatus').textContent = 'Inactive';
                        document.getElementById('maintenanceStatus').className = 'badge badge-success';
                        document.getElementById('maintenanceTime').textContent = '00:00:00';
                    }
                });
            }

            async flushChat() {
                if (!confirm('Are you sure you want to delete ALL chat messages? This cannot be undone.')) {
                    return;
                }

                try {
                    await database.ref('chat').remove();
                    this.showToast('All chat messages flushed', 'success');
                    
                } catch (error) {
                    console.error('Error flushing chat:', error);
                    this.showToast('Error flushing chat', 'error');
                }
            }

            async backupDatabase() {
                try {
                    // Create a backup entry
                    const backupId = 'backup_' + Date.now();
                    await database.ref('backups/' + backupId).set({
                        timestamp: Date.now(),
                        createdBy: this.adminUser.username,
                        size: 'N/A' // In a real app, you'd calculate this
                    });
                    
                    this.showToast('Database backup created', 'success');
                    
                } catch (error) {
                    console.error('Error creating backup:', error);
                    this.showToast('Error creating backup', 'error');
                }
            }

            async clearOldTransactions() {
                if (!confirm('Clear transactions older than 30 days?')) {
                    return;
                }

                try {
                    const thirtyDaysAgo = Date.now() - (30 * 24 * 60 * 60 * 1000);
                    const snapshot = await database.ref('transactions').orderByChild('timestamp').endAt(thirtyDaysAgo).once('value');
                    
                    const updates = {};
                    snapshot.forEach(child => {
                        updates[child.key] = null;
                    });
                    
                    await database.ref('transactions').update(updates);
                    this.showToast(`Cleared ${snapshot.numChildren()} old transactions`, 'success');
                    this.loadTransactions();
                    
                } catch (error) {
                    console.error('Error clearing old transactions:', error);
                    this.showToast('Error clearing transactions', 'error');
                }
            }

            async resetLeaderboard() {
                if (!confirm('Reset ALL leaderboard stats? This will set all user stats to zero.')) {
                    return;
                }

                try {
                    const snapshot = await database.ref('users').once('value');
                    const updates = {};
                    
                    snapshot.forEach(child => {
                        updates[child.key + '/totalWins'] = 0;
                        updates[child.key + '/totalLosses'] = 0;
                        updates[child.key + '/biggestWin'] = 0;
                        updates[child.key + '/wageredToday'] = 0;
                        updates[child.key + '/wageredWeek'] = 0;
                        updates[child.key + '/wonToday'] = 0;
                    });
                    
                    await database.ref('users').update(updates);
                    this.showToast('Leaderboard reset successfully', 'success');
                    
                } catch (error) {
                    console.error('Error resetting leaderboard:', error);
                    this.showToast('Error resetting leaderboard', 'error');
                }
            }

            // BROADCAST FUNCTIONS
            async sendBroadcast() {
                const type = document.querySelector('input[name="broadcastType"]:checked').value;
                const target = document.getElementById('broadcastTarget').value;
                const message = document.getElementById('broadcastMessage').value.trim();
                const duration = parseInt(document.getElementById('broadcastDuration').value) || 10;
                const username = document.getElementById('broadcastUsername').value.trim();

                if (!message) {
                    this.showToast('Please enter a message', 'error');
                    return;
                }

                try {
                    const broadcast = {
                        type,
                        target,
                        message,
                        duration,
                        sentBy: this.adminUser.username,
                        timestamp: Date.now(),
                        status: 'sent'
                    };

                    if (target === 'specific' && username) {
                        broadcast.specificUser = username;
                    }

                    await database.ref('broadcasts').push(broadcast);
                    
                    // Also add to recent broadcasts display
                    this.addBroadcastToDisplay(broadcast);
                    
                    // Clear form
                    document.getElementById('broadcastMessage').value = '';
                    document.getElementById('broadcastUsername').value = '';
                    
                    this.showToast('Broadcast sent successfully', 'success');
                    
                } catch (error) {
                    console.error('Error sending broadcast:', error);
                    this.showToast('Error sending broadcast', 'error');
                }
            }

            addBroadcastToDisplay(broadcast) {
                const container = document.getElementById('recentBroadcasts');
                if (!container) return;
                
                const time = new Date(broadcast.timestamp).toLocaleTimeString();
                let typeClass = 'badge-info';
                
                switch(broadcast.type) {
                    case 'warning': typeClass = 'badge-warning'; break;
                    case 'announcement': typeClass = 'badge-success'; break;
                    case 'promotion': typeClass = 'badge-danger'; break;
                }
                
                const broadcastElement = document.createElement('div');
                broadcastElement.className = 'p-3 bg-gradient-to-r from-[#0b0e14] to-[#1e293b] rounded-lg fade-in';
                broadcastElement.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <span class="${typeClass}">${broadcast.type.toUpperCase()}</span>
                            <span class="text-gray-400 text-sm ml-2">to ${broadcast.target}</span>
                        </div>
                        <div class="text-gray-500 text-sm">${time}</div>
                    </div>
                    <div class="text-white">${broadcast.message}</div>
                    <div class="text-gray-500 text-xs mt-2">Sent by ${broadcast.sentBy}</div>
                `;
                
                container.insertBefore(broadcastElement, container.firstChild);
                
                // Limit to 10 broadcasts
                if (container.children.length > 10) {
                    container.removeChild(container.lastChild);
                }
            }

            // SYSTEM FUNCTIONS
            async saveGeneralSettings() {
                const siteName = document.getElementById('siteName').value;
                const startingBalance = parseInt(document.getElementById('startingBalance').value) || 500;
                const freeCoinsCooldown = parseInt(document.getElementById('freeCoinsCooldown').value) || 5;
                const transferFee = parseInt(document.getElementById('transferFee').value) || 10;

                try {
                    await database.ref('settings/general').set({
                        siteName,
                        startingBalance,
                        freeCoinsCooldown,
                        transferFee,
                        updatedBy: this.adminUser.username,
                        updatedAt: Date.now()
                    });
                    
                    this.showToast('General settings saved', 'success');
                    
                } catch (error) {
                    console.error('Error saving settings:', error);
                    this.showToast('Error saving settings', 'error');
                }
            }

            async saveSecuritySettings() {
                const enable2FA = document.getElementById('enable2FA').checked;
                const enableIPTracking = document.getElementById('enableIPTracking').checked;
                const sessionTimeout = parseInt(document.getElementById('sessionTimeout').value) || 30;
                const maxLoginAttempts = parseInt(document.getElementById('maxLoginAttempts').value) || 5;

                try {
                    await database.ref('settings/security').set({
                        enable2FA,
                        enableIPTracking,
                        sessionTimeout,
                        maxLoginAttempts,
                        updatedBy: this.adminUser.username,
                        updatedAt: Date.now()
                    });
                    
                    this.showToast('Security settings saved', 'success');
                    
                } catch (error) {
                    console.error('Error saving security settings:', error);
                    this.showToast('Error saving security settings', 'error');
                }
            }

            async saveGameSettings() {
                const minesEdge = parseFloat(document.getElementById('minesEdge').value) || 0.02;
                const blackjackEdge = parseFloat(document.getElementById('blackjackEdge').value) || 0.5;
                const chickenEdge = parseFloat(document.getElementById('chickenEdge').value) || 0.15;
                const coinflipEdge = parseFloat(document.getElementById('coinflipEdge').value) || 1.85;

                try {
                    await database.ref('settings/houseEdge').set({
                        mines: minesEdge,
                        blackjack: blackjackEdge,
                        chickenRoad: chickenEdge,
                        coinflip: coinflipEdge,
                        updatedBy: this.adminUser.username,
                        updatedAt: Date.now()
                    });
                    
                    this.showToast('House edge settings saved', 'success');
                    
                } catch (error) {
                    console.error('Error saving house edge settings:', error);
                    this.showToast('Error saving settings', 'error');
                }
            }

            async saveGameControls() {
                const disableAllGames = document.getElementById('disableAllGames').checked;
                const disableChat = document.getElementById('disableChat').checked;
                const disableTransfers = document.getElementById('disableTransfers').checked;
                const freeCoinsAmount = parseInt(document.getElementById('freeCoinsAmount').value) || 500;

                try {
                    await database.ref('settings/gameControls').set({
                        disableAllGames,
                        disableChat,
                        disableTransfers,
                        freeCoinsAmount,
                        updatedBy: this.adminUser.username,
                        updatedAt: Date.now()
                    });
                    
                    this.showToast('Game controls saved', 'success');
                    
                } catch (error) {
                    console.error('Error saving game controls:', error);
                    this.showToast('Error saving game controls', 'error');
                }
            }

            // REPORTS FUNCTIONS
            async loadReports() {
                // Load report data based on selected range
                this.changeReportRange();
            }

            changeReportRange() {
                const range = document.getElementById('reportRange').value;
                const fromField = document.getElementById('customDateFrom');
                const toField = document.getElementById('customDateTo');
                
                if (range === 'custom') {
                    fromField.classList.remove('hidden');
                    toField.classList.remove('hidden');
                } else {
                    fromField.classList.add('hidden');
                    toField.classList.add('hidden');
                    this.generateReport(range);
                }
            }

            async generateReport(range) {
                let startDate, endDate;
                const now = new Date();
                
                switch(range) {
                    case 'today':
                        startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                        endDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59, 999);
                        break;
                    case 'yesterday':
                        const yesterday = new Date(now);
                        yesterday.setDate(yesterday.getDate() - 1);
                        startDate = new Date(yesterday.getFullYear(), yesterday.getMonth(), yesterday.getDate());
                        endDate = new Date(yesterday.getFullYear(), yesterday.getMonth(), yesterday.getDate(), 23, 59, 59, 999);
                        break;
                    case 'week':
                        startDate = new Date(now);
                        startDate.setDate(now.getDate() - 7);
                        endDate = now;
                        break;
                    case 'month':
                        startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                        endDate = now;
                        break;
                    default:
                        return;
                }
                
                try {
                    // Load transactions for the period
                    const snapshot = await database.ref('transactions')
                        .orderByChild('timestamp')
                        .startAt(startDate.getTime())
                        .endAt(endDate.getTime())
                        .once('value');
                    
                    let totalWagers = 0;
                    let totalWins = 0;
                    let houseProfit = 0;
                    const gameStats = {};
                    const userStats = {};
                    
                    snapshot.forEach(child => {
                        const tx = child.val();
                        
                        if (tx.type === 'loss') {
                            totalWagers += tx.amount || 0;
                            houseProfit += tx.amount || 0;
                            
                            // Track by game
                            const game = tx.game || 'unknown';
                            gameStats[game] = gameStats[game] || { wagers: 0, wins: 0 };
                            gameStats[game].wagers += tx.amount || 0;
                            
                            // Track by user
                            if (tx.userId) {
                                userStats[tx.userId] = userStats[tx.userId] || { username: tx.username, wagers: 0, wins: 0 };
                                userStats[tx.userId].wagers += tx.amount || 0;
                            }
                            
                        } else if (tx.type === 'win') {
                            totalWins += tx.amount || 0;
                            houseProfit -= tx.amount || 0;
                            
                            // Track by game
                            const game = tx.game || 'unknown';
                            gameStats[game] = gameStats[game] || { wagers: 0, wins: 0 };
                            gameStats[game].wins += tx.amount || 0;
                            
                            // Track by user
                            if (tx.userId) {
                                userStats[tx.userId] = userStats[tx.userId] || { username: tx.username, wagers: 0, wins: 0 };
                                userStats[tx.userId].wins += tx.amount || 0;
                            }
                        }
                    });
                    
                    // Update display
                    document.getElementById('reportTotalWagers').textContent = totalWagers.toLocaleString();
                    document.getElementById('reportTotalWins').textContent = totalWins.toLocaleString();
                    document.getElementById('reportHouseProfit').textContent = houseProfit.toLocaleString();
                    
                    // Update game performance table
                    const gameTable = document.getElementById('gamePerformanceTable');
                    gameTable.innerHTML = Object.entries(gameStats).map(([game, stats]) => `
                        <tr>
                            <td class="text-white">${game}</td>
                            <td class="text-gray-400">${Object.keys(gameStats).length}</td>
                            <td class="text-[#f59e0b] font-mono">${stats.wagers.toLocaleString()}</td>
                            <td class="text-[#10b981] font-mono">${stats.wins.toLocaleString()}</td>
                            <td class="text-gray-400">${stats.wagers > 0 ? ((stats.wagers - stats.wins) / stats.wagers * 100).toFixed(2) : 0}%</td>
                            <td class="${stats.wagers - stats.wins >= 0 ? 'text-[#10b981]' : 'text-[#ef4444]'} font-mono font-bold">
                                ${(stats.wagers - stats.wins).toLocaleString()}
                            </td>
                        </tr>
                    `).join('');
                    
                    // Update top users table
                    const userArray = Object.values(userStats)
                        .map(user => ({
                            ...user,
                            net: user.wins - user.wagers
                        }))
                        .sort((a, b) => b.wagers - a.wagers)
                        .slice(0, 10);
                    
                    const usersTable = document.getElementById('topUsersTable');
                    usersTable.innerHTML = userArray.map(user => `
                        <tr>
                            <td class="text-white">${user.username || 'Unknown'}</td>
                            <td class="text-[#f59e0b] font-mono">${user.wagers.toLocaleString()}</td>
                            <td class="text-[#10b981] font-mono">${user.wins.toLocaleString()}</td>
                            <td class="${user.net >= 0 ? 'text-[#10b981]' : 'text-[#ef4444]'} font-mono font-bold">
                                ${user.net.toLocaleString()}
                            </td>
                            <td class="text-gray-400">${Math.ceil((user.wagers + user.wins) / 100)}</td>
                        </tr>
                    `).join('');
                    
                    // Load new users for the period
                    const usersSnapshot = await database.ref('users')
                        .orderByChild('createdAt')
                        .startAt(startDate.getTime())
                        .endAt(endDate.getTime())
                        .once('value');
                    
                    document.getElementById('reportNewUsers').textContent = usersSnapshot.numChildren().toLocaleString();
                    
                } catch (error) {
                    console.error('Error generating report:', error);
                    this.showToast('Error generating report', 'error');
                }
            }

            // AUDIT LOGS FUNCTIONS
            async loadLogs() {
                try {
                    const snapshot = await database.ref('admin_logs').orderByChild('timestamp').limitToLast(1000).once('value');
                    this.logs = [];
                    
                    snapshot.forEach(child => {
                        const log = child.val();
                        this.logs.push({
                            id: child.key,
                            ...log
                        });
                    });
                    
                    // Sort by timestamp (newest first)
                    this.logs.sort((a, b) => b.timestamp - a.timestamp);
                    this.filteredLogs = [...this.logs];
                    this.renderLogs();
                    
                } catch (error) {
                    console.error('Error loading logs:', error);
                    this.showToast('Error loading logs', 'error');
                }
            }

            renderLogs() {
                const container = document.getElementById('auditLogs');
                if (!container) return;
                
                const start = (this.logsPage - 1) * this.logsPerPage;
                const end = start + this.logsPerPage;
                const pageLogs = this.filteredLogs.slice(start, end);
                
                if (pageLogs.length === 0) {
                    container.innerHTML = '<div class="text-center py-8 text-gray-400">No logs found</div>';
                    return;
                }
                
                container.innerHTML = pageLogs.map(log => {
                    const time = new Date(log.timestamp).toLocaleString();
                    let levelClass, icon;
                    
                    switch(log.level || 'info') {
                        case 'error':
                            levelClass = 'badge-danger';
                            icon = 'fa-exclamation-circle';
                            break;
                        case 'warning':
                            levelClass = 'badge-warning';
                            icon = 'fa-exclamation-triangle';
                            break;
                        case 'security':
                            levelClass = 'badge-info';
                            icon = 'fa-shield';
                            break;
                        default:
                            levelClass = 'badge-success';
                            icon = 'fa-info-circle';
                    }
                    
                    return `
                        <div class="p-4 bg-gradient-to-r from-[#0b0e14] to-[#1e293b] rounded-lg fade-in">
                            <div class="flex justify-between items-start mb-2">
                                <div class="flex items-center gap-2">
                                    <span class="${levelClass}">${(log.level || 'info').toUpperCase()}</span>
                                    <span class="text-gray-400 text-sm">${log.action || 'Unknown action'}</span>
                                </div>
                                <div class="text-gray-500 text-sm">${time}</div>
                            </div>
                            <div class="text-white mb-2">${log.details || 'No details'}</div>
                            <div class="text-gray-500 text-xs">
                                <i class="fa-solid ${icon} mr-1"></i>
                                Admin: ${log.adminName || 'Unknown'} | Target: ${log.targetUsername || 'System'}
                                ${log.amount ? `| Amount: ${log.amount}` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
                
                // Update pagination
                document.getElementById('logsCount').textContent = 
                    `Showing ${start + 1}-${Math.min(end, this.filteredLogs.length)} of ${this.filteredLogs.length} logs`;
                document.getElementById('logsPage').textContent = `Page ${this.logsPage}`;
            }

            filterLogs() {
                const level = document.getElementById('logLevel').value;
                const type = document.getElementById('logType').value;
                const search = document.getElementById('logSearch').value.toLowerCase();
                
                this.filteredLogs = this.logs.filter(log => {
                    // Filter by level
                    if (level !== 'all' && (log.level || 'info') !== level) return false;
                    
                    // Filter by type (simplified - would need type field in logs)
                    if (type !== 'all') {
                        const logType = this.getLogType(log);
                        if (logType !== type) return false;
                    }
                    
                    // Filter by search
                    if (search && !JSON.stringify(log).toLowerCase().includes(search)) return false;
                    
                    return true;
                });
                
                this.logsPage = 1;
                this.renderLogs();
            }

            getLogType(log) {
                if (log.action?.includes('admin')) return 'admin';
                if (log.action?.includes('user')) return 'user';
                if (log.action?.includes('game')) return 'game';
                return 'system';
            }

            prevLogsPage() {
                if (this.logsPage > 1) {
                    this.logsPage--;
                    this.renderLogs();
                }
            }

            nextLogsPage() {
                if (this.logsPage * this.logsPerPage < this.filteredLogs.length) {
                    this.logsPage++;
                    this.renderLogs();
                }
            }

            async clearOldLogs() {
                if (!confirm('Clear logs older than 7 days?')) {
                    return;
                }

                try {
                    const sevenDaysAgo = Date.now() - (7 * 24 * 60 * 60 * 1000);
                    const snapshot = await database.ref('admin_logs').orderByChild('timestamp').endAt(sevenDaysAgo).once('value');
                    
                    const updates = {};
                    snapshot.forEach(child => {
                        updates[child.key] = null;
                    });
                    
                    await database.ref('admin_logs').update(updates);
                    this.showToast(`Cleared ${snapshot.numChildren()} old logs`, 'success');
                    this.loadLogs();
                    
                } catch (error) {
                    console.error('Error clearing old logs:', error);
                    this.showToast('Error clearing logs', 'error');
                }
            }

            // QUICK ACTIONS
            quickAction(action) {
                switch(action) {
                    case 'flushChat':
                        this.flushChat();
                        break;
                    case 'resetLeaderboard':
                        this.resetLeaderboard();
                        break;
                    case 'backupData':
                        this.backupDatabase();
                        break;
                }
            }

            // UTILITY FUNCTIONS
            refreshUsers() {
                this.loadUsers();
                this.showToast('Users refreshed', 'success');
            }

            refreshTransactions() {
                this.loadTransactions();
                this.showToast('Transactions refreshed', 'success');
            }

            refreshReports() {
                this.loadReports();
                this.showToast('Reports refreshed', 'success');
            }

            refreshLogs() {
                this.loadLogs();
                this.showToast('Logs refreshed', 'success');
            }

            exportUsers() {
                const data = JSON.stringify(this.filteredUsers, null, 2);
                this.downloadFile('mooncasino_users.json', data);
                this.showToast('Users exported successfully', 'success');
            }

            exportTransactions() {
                const csv = this.convertToCSV(this.filteredTransactions);
                this.downloadFile('transactions.csv', csv);
                this.showToast('Transactions exported successfully', 'success');
            }

            exportReport() {
                const report = {
                    generated: new Date().toISOString(),
                    totalWagers: document.getElementById('reportTotalWagers').textContent,
                    totalWins: document.getElementById('reportTotalWins').textContent,
                    houseProfit: document.getElementById('reportHouseProfit').textContent,
                    newUsers: document.getElementById('reportNewUsers').textContent
                };
                
                const data = JSON.stringify(report, null, 2);
                this.downloadFile('casino_report.json', data);
                this.showToast('Report exported successfully', 'success');
            }

            convertToCSV(data) {
                if (data.length === 0) return '';
                
                const headers = Object.keys(data[0]);
                const csvRows = [
                    headers.join(','),
                    ...data.map(row => headers.map(header => JSON.stringify(row[header] || '')).join(','))
                ];
                
                return csvRows.join('\n');
            }

            downloadFile(filename, content) {
                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        }

        // Initialize admin panel
        const admin = new AdminPanel();
        
        // Make admin object available globally for button clicks
        window.admin = admin;
    </script>
</body>
</html>
