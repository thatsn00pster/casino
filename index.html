
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Moon Casino - Premium Fun Casino</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <!-- Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap');
        
        :root {
            --primary: #8b5cf6;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg-dark: #0b0e14;
            --bg-panel: #161b26;
            --border: #2a3042;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            -webkit-text-size-adjust: 100%;
            touch-action: manipulation;
        }
        
        body {
            font-family: 'Space Grotesk', sans-serif;
            background-color: #000;
            color: #b1bad3;
            background-image:
                radial-gradient(2px 2px at 20px 30px, #eee, transparent),
                radial-gradient(2px 2px at 40px 70px, #fff, transparent),
                radial-gradient(1px 1px at 90px 40px, #fff, transparent),
                radial-gradient(1px 1px at 130px 80px, #eee, transparent),
                radial-gradient(2px 2px at 160px 30px, #fff, transparent),
                radial-gradient(circle at 50% 50%, rgba(139,92,246,0.08) 0%, transparent 50%),
                linear-gradient(135deg, #0f0720 0%, #000 100%);
            background-repeat: repeat, repeat, repeat, repeat, repeat, no-repeat, no-repeat;
            background-size: 200px 200px, 300px 300px, 400px 400px, 350px 350px, 250px 250px, 100% 100%, 100% 100%;
            animation: stars 120s linear infinite;
            position: relative;
            overflow-x: hidden;
            overscroll-behavior: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        @keyframes stars {
            from { background-position: 0 0, 0 0, 0 0, 0 0, 0 0, 0 0, 0 0; }
            to { background-position: 200px 200px, 300px 300px, 400px 400px, 350px 350px, 250px 250px, 0 0, 0 0; }
        }
        
        body::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 30% 70%, rgba(139,92,246,0.15), transparent 40%),
                        radial-gradient(circle at 80% 20%, rgba(34,211,238,0.12), transparent 50%);
            pointer-events: none;
            animation: nebula 25s ease-in-out infinite alternate;
        }
        
        @keyframes nebula {
            0% { opacity: 0.4; transform: scale(1) rotate(0deg); }
            100% { opacity: 0.7; transform: scale(1.1) rotate(5deg); }
        }
        
        /* Enhanced Animations */
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(2deg); }
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.3); }
            50% { box-shadow: 0 0 40px rgba(139, 92, 246, 0.6); }
        }
        
        @keyframes slide-in-right {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slide-in-left {
            from { transform: translateX(-100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes scale-in {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        @keyframes card-deal {
            0% { transform: translateY(-100px) rotate(-10deg) scale(0.5); opacity: 0; }
            60% { transform: translateY(10px) rotate(2deg) scale(1.05); opacity: 1; }
            100% { transform: translateY(0) rotate(0) scale(1); opacity: 1; }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        
        @keyframes shimmer {
            0% { background-position: -200px 0; }
            100% { background-position: calc(200px + 100%) 0; }
        }
        
        @keyframes fade-in-up {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* Chicken Road Game Specific Animations */
        @keyframes hop {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3); }
        }
        .chicken-hop { animation: hop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

        @keyframes shake {
            0%, 100% { transform: translate(0, 0); }
            10%, 30%, 50%, 70%, 90% { transform: translate(-5px, 2px); }
            20%, 40%, 60%, 80% { transform: translate(5px, -2px); }
        }
        .shake-screen { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }

        @keyframes crashDriveVertical {
            0% { transform: translate(-50%, -200px); opacity: 1; }
            50% { transform: translate(-50%, 0%); }
            100% { transform: translate(-50%, 100vh); opacity: 1; }
        }
        .crash-car-anim {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 50;
            animation: crashDriveVertical 0.6s cubic-bezier(0.5, 0, 0.5, 1) forwards;
        }

        @keyframes trafficFlow {
            0% { transform: translate(-50%, -150px); }
            100% { transform: translate(-50%, 120vh); }
        }
        .traffic-car {
            position: absolute;
            left: 50%;
            top: 0;
            transform: translate(-50%, -150px);
            animation: trafficFlow linear infinite;
            z-index: 5;
            will-change: transform;
        }

        /* Chicken Road Car Models */
        .car-model {
            width: 44px;
            height: 80px;
            border-radius: 12px;
            position: relative;
            box-shadow: 4px 8px 12px rgba(0,0,0,0.5);
            overflow: hidden;
        }
        .car-model::before {
            content: '';
            position: absolute;
            bottom: 4px;
            left: 4px;
            width: 8px;
            height: 4px;
            background: #fff;
            box-shadow: 0 0 5px #fff;
            border-radius: 2px;
            z-index: 2;
        }
        .car-model::after {
            content: '';
            position: absolute;
            bottom: 4px;
            right: 4px;
            width: 8px;
            height: 4px;
            background: #fff;
            box-shadow: 0 0 5px #fff;
            border-radius: 2px;
            z-index: 2;
        }
        
        .car-roof {
            position: absolute;
            top: 18px;
            left: 6px;
            right: 6px;
            bottom: 20px;
            background: rgba(0,0,0,0.25);
            border-radius: 6px;
            border: 1px solid rgba(0,0,0,0.1);
        }
        .car-windshield {
            position: absolute;
            bottom: 18px;
            left: 8px;
            right: 8px;
            height: 14px;
            background: linear-gradient(to bottom, #aed6f1, #3498db);
            border-radius: 2px 2px 8px 8px;
            opacity: 0.9;
        }
        .car-rear-window {
            position: absolute;
            top: 18px;
            left: 8px;
            right: 8px;
            height: 10px;
            background: #2c3e50;
            border-radius: 6px 6px 2px 2px;
        }

        .car-red { background: linear-gradient(to bottom, #c0392b, #e74c3c); }
        .car-blue { background: linear-gradient(to bottom, #2980b9, #3498db); }
        .car-yellow { background: linear-gradient(to bottom, #f39c12, #f1c40f); }
        .car-white { background: linear-gradient(to bottom, #bdc3c7, #ecf0f1); }
        .car-black { background: linear-gradient(to bottom, #2c3e50, #34495e); }
        .car-green { background: linear-gradient(to bottom, #27ae60, #2ecc71); }

        /* Chicken Road Lane Styles */
        .lane-card {
            transition: transform 0.2s, filter 0.2s;
            box-shadow: inset 10px 0 20px -10px rgba(0,0,0,0.5), inset -10px 0 20px -10px rgba(0,0,0,0.5);
        }
        .lane-card:hover:not(.disabled) {
            filter: brightness(1.1) contrast(1.1);
            z-index: 10;
        }
        
        .sidewalk-texture {
            background-color: #95a5a6;
            background-image: 
                linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px),
                linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px);
            background-size: 40px 40px;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.3);
        }

        .grass-texture {
            background-color: #4caf50;
            background-image: 
                radial-gradient(#66bb6a 15%, transparent 16%),
                radial-gradient(#81c784 15%, transparent 16%);
            background-size: 60px 60px;
            background-position: 0 0, 30px 30px;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.2);
        }

        .pond {
            background: linear-gradient(135deg, #4fc3f7, #29b6f6);
            border-radius: 50% 70% 50% 40%;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.2), 0 4px 0 rgba(0,0,0,0.1);
            position: absolute;
            z-index: 1;
            overflow: hidden;
        }
        .pond::before {
            content: '';
            position: absolute;
            top: 20%;
            left: 20%;
            width: 20%;
            height: 10%;
            background: rgba(255,255,255,0.4);
            border-radius: 50%;
            transform: rotate(-45deg);
        }

        .road-texture {
            background-color: #2d3436;
            background-image: 
                url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.6' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
            box-shadow: inset 0 10px 20px rgba(0,0,0,0.5), inset 0 -10px 20px rgba(0,0,0,0.5);
            position: relative;
        }
        
        .road-border-top {
            position: absolute;
            top: 0; left: 0; right: 0; height: 6px;
            background: #ecf0f1;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
            z-index: 5;
        }
        .road-border-bottom {
            position: absolute;
            bottom: 0; left: 0; right: 0; height: 6px;
            background: #ecf0f1;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
            z-index: 5;
        }

        .lane-separator {
            position: absolute;
            right: 0;
            top: 10%;
            bottom: 10%;
            width: 4px;
            background: repeating-linear-gradient(
                to bottom,
                #ecf0f1,
                #ecf0f1 40px,
                transparent 40px,
                transparent 80px
            );
            z-index: 5;
            opacity: 0.5;
        }

        /* Coinflip Game Specific Styles */
        .coin-container {
            perspective: 1000px;
        }

        .coin {
            width: 200px;
            height: 200px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .coin-side {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: absolute;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }

        .coin-side-heads {
            background: radial-gradient(circle at 30% 30%, #f59e0b, #d97706);
            color: #78350f;
            transform: rotateY(0deg);
            border: 8px solid #f59e0b;
        }
        
        .coin-side-heads::after {
            content: '';
            position: absolute;
            inset: 10px;
            border: 2px dashed #b45309;
            border-radius: 50%;
            opacity: 0.6;
        }

        .coin-side-tails {
            background: radial-gradient(circle at 30% 30%, #e5e7eb, #9ca3af);
            color: #1f2937;
            transform: rotateY(180deg);
            border: 8px solid #6b7280;
        }
        
        .coin-side-tails::after {
            content: '';
            position: absolute;
            inset: 10px;
            border: 2px dashed #4b5563;
            border-radius: 50%;
            opacity: 0.6;
        }

        .coin-icon {
            width: 80px;
            height: 80px;
            color: currentColor;
        }

        /* Coinflip Game Controls */
        .coinflip-controls {
            background: linear-gradient(135deg, #1e293b, #0f172a);
            border-radius: 12px;
            border: 1px solid #334155;
            padding: 16px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .coinflip-history-item {
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .coinflip-side-btn {
            transition: all 0.2s;
        }
        
        .coinflip-side-btn:active {
            transform: scale(0.96);
        }

        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .coinflip-roadmap-dot {
            transition: all 0.3s ease;
        }

        .coinflip-roadmap-dot.active {
            background: #10b981;
            box-shadow: 0 0 10px #10b981;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(11, 14, 20, 0.5);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #8b5cf6, #10b981);
            border-radius: 4px;
            transition: all 0.3s;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #7c3aed, #059669);
        }
        
        /* Button Styles */
        .btn-primary {
            background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
            color: white;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
            border: none;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 20px 40px rgba(139,92,246,0.4);
        }
        
        .btn-primary::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.7s;
        }
        
        .btn-primary:hover::after {
            left: 100%;
        }
        
        /* Game Card */
        .game-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(145deg, #161b26, #11141c);
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }
        
        .game-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #8b5cf6, #10b981, #8b5cf6);
            background-size: 200% 100%;
            animation: shimmer 2s linear infinite;
        }
        
        .game-card:hover {
            transform: translateY(-10px) scale(1.03);
            border-color: #8b5cf6;
            box-shadow: 0 25px 50px -12px rgba(110,86,207,0.4);
        }
        
        /* Mines Grid */
        .mines-grid-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            user-select: none;
        }
        
        .mine-tile-modern {
            aspect-ratio: 1;
            background: linear-gradient(145deg, #1f2937, #111827);
            border-radius: 12px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 6px 0 #0f172a;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid transparent;
            touch-action: none;
        }
        
        .mine-tile-modern:hover:not(.revealed),
        .mine-tile-modern.hover-effect:not(.revealed) {
            transform: translateY(-3px);
            border-color: rgba(139, 92, 246, 0.3);
            box-shadow: 0 10px 20px rgba(139, 92, 246, 0.2);
        }
        
        .mine-tile-modern.revealed {
            transform: translateY(6px);
            box-shadow: 0 2px 0 #0f172a;
            cursor: default;
        }
        
        .mine-tile-modern.gem {
            background: linear-gradient(145deg, #065f46, #064e3b);
            border: 2px solid #10b981;
            animation: pulse-glow 2s infinite;
        }
        
        .mine-tile-modern.mine {
            background: linear-gradient(145deg, #7f1d1d, #450a0a);
            border: 2px solid #ef4444;
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        /* Blackjack Cards */
        .card-container {
            width: 100px;
            height: 146px;
            perspective: 1200px;
            margin: 0 8px;
        }
        
        .game-card-item {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-radius: 16px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.8), 0 0 40px rgba(0,0,0,0.5), inset 0 2px 0 rgba(255,255,255,0.2);
        }
        
        .game-card-item.flipped {
            transform: rotateY(180deg);
        }
        
        .card-face, .card-back {
            position: absolute;
            inset: 0;
            backface-visibility: hidden;
            border-radius: 16px;
            overflow: hidden;
            background: #fdfdfd;
            border: 3px solid #1e293b;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 10px 8px;
            font-weight: 900;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        }
        
        .card-back {
            background: linear-gradient(135deg, #1e40af, #1e3a8a);
            transform: rotateY(180deg);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .card-back::before {
            content: 'â—†';
            font-size: 80px;
            color: rgba(255,255,255,0.3);
            text-shadow: 0 0 20px rgba(255,255,255,0.5);
            animation: float 3s ease-in-out infinite;
        }
        
        .card-face .text-red-500 {
            color: #ef4444 !important;
        }
        
        .card-face > div:first-child,
        .card-face > div:last-child {
            font-size: 16px;
            line-height: 1;
            letter-spacing: -1px;
        }
        
        .card-face .card-value {
            font-size: 56px;
            align-self: center;
            margin-top: -15px;
            text-shadow: 0 3px 6px rgba(0,0,0,0.2);
        }
        
        .card-face::before {
            content: '';
            position: absolute;
            inset: 5px;
            border-radius: 12px;
            background: linear-gradient(135deg, rgba(255,255,255,0.5), transparent 60%);
            pointer-events: none;
        }
        
        /* Sound Toggle */
        .sound-toggle {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #1e293b;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 22px;
            cursor: pointer;
            z-index: 1000;
            border: 2px solid #334155;
            box-shadow: 0 10px 25px rgba(0,0,0,0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: bounce 2s infinite;
        }
        
        .sound-toggle:hover {
            transform: scale(1.1) rotate(15deg);
            box-shadow: 0 15px 35px rgba(56, 189, 248, 0.5);
            background: linear-gradient(135deg, #1e293b, #0f172a);
        }
        
        .sound-toggle.muted {
            background: #ef4444;
            animation: none;
        }
        
        /* Modal */
        .modal {
            position: fixed;
            inset: 0;
            z-index: 50;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            animation: fadeIn 0.3s ease-out;
            padding: 16px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: #161b26;
            border-radius: 16px;
            border: 1px solid #2a3042;
            box-shadow: 0 20px 40px -12px rgba(0, 0, 0, 0.8);
            max-width: 100%;
            width: 420px;
            animation: scale-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-origin: center;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; backdrop-filter: blur(0); }
            to { opacity: 1; backdrop-filter: blur(10px); }
        }
        
        /* Maintenance Modal */
        .maintenance-modal {
            position: fixed;
            inset: 0;
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            animation: fadeIn 0.5s ease-out;
        }
        
        .maintenance-modal.active {
            display: flex;
        }
        
        .maintenance-content {
            background: linear-gradient(135deg, #161b26, #11141c);
            border-radius: 20px;
            border: 2px solid #8b5cf6;
            box-shadow: 0 25px 50px -12px rgba(139, 92, 246, 0.4), 
                        0 0 100px rgba(139, 92, 246, 0.2);
            max-width: 500px;
            width: 90%;
            padding: 40px;
            text-align: center;
            animation: scale-in 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-origin: center;
        }
        
        .maintenance-icon {
            font-size: 4rem;
            color: #8b5cf6;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }
        
        .maintenance-title {
            font-size: 2rem;
            font-weight: 800;
            color: white;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
            background: linear-gradient(135deg, #8b5cf6, #10b981);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .maintenance-message {
            color: #b1bad3;
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 30px;
        }
        
        .maintenance-timer {
            background: rgba(139, 92, 246, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 30px;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }
        
        .maintenance-timer-label {
            color: #8b5cf6;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }
        
        .maintenance-timer-value {
            color: white;
            font-size: 1.5rem;
            font-weight: 700;
            font-family: monospace;
        }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 16px 20px;
            background: #1e293b;
            border-radius: 12px;
            border: 1px solid #334155;
            color: white;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            z-index: 1001;
            transform: translateX(100px) scale(0.8);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-width: calc(100vw - 40px);
        }
        
        .toast.show {
            transform: translateX(0) scale(1);
            opacity: 1;
        }
        
        .toast.success {
            border-color: #10b981;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), #1e293b);
        }
        
        .toast.error {
            border-color: #ef4444;
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), #1e293b);
        }
        
        .toast.warning {
            border-color: #f59e0b;
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), #1e293b);
        }
        
        /* Win/Loss Notification */
        .big-win-notification {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(217, 119, 6, 0.1));
            border: 2px solid #f59e0b;
            border-radius: 12px;
            padding: 16px;
            margin: 12px 0;
            text-align: center;
            animation: pulse-glow 1.5s infinite, scale-in 0.3s ease-out;
        }
        
        .big-win-notification .username {
            color: #fbbf24;
            font-weight: bold;
            font-size: 18px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .big-win-notification .amount {
            color: #10b981;
            font-weight: bold;
            font-size: 24px;
            text-shadow: 0 0 15px rgba(16, 185, 129, 0.5);
            margin: 8px 0;
        }
        
        /* Stats Cards */
        .stats-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.8));
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 16px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
            border-color: #8b5cf6;
            box-shadow: 0 10px 20px rgba(139, 92, 246, 0.2);
        }
        
        .stats-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #8b5cf6, #10b981);
        }
        
        /* Leaderboard Item */
        .leaderboard-item {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.8));
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 10px;
            transition: all 0.3s;
            animation: fade-in-up 0.3s ease-out;
        }
        
        .leaderboard-item:hover {
            transform: translateX(5px);
            border-color: #8b5cf6;
            background: linear-gradient(135deg, rgba(44, 58, 83, 0.8), rgba(25, 35, 58, 0.8));
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .mines-grid-container {
                gap: 8px;
                max-width: 320px;
            }
            
            .card-container {
                width: 70px;
                height: 102px;
                margin: 0 4px;
            }
            
            .sound-toggle {
                width: 45px;
                height: 45px;
                font-size: 20px;
                bottom: 15px;
                left: 15px;
            }
            
            .modal-content {
                width: 100%;
                padding: 20px;
                margin: 0 16px;
            }
            
            .blackjack-table {
                padding: 12px;
            }
            
            .hand-container {
                min-height: 120px;
            }
            
            .card-container {
                width: 60px;
                height: 87px;
                margin: 0 2px;
            }
            
            .game-controls {
                padding: 12px;
            }
            
            .btn-primary, button {
                font-size: 14px !important;
                padding: 12px 16px !important;
            }
            
            /* Maintenance modal responsive */
            .maintenance-content {
                padding: 30px 20px;
                width: 95%;
            }
            
            .maintenance-icon {
                font-size: 3rem;
            }
            
            .maintenance-title {
                font-size: 1.5rem;
            }
            
            .maintenance-message {
                font-size: 1rem;
            }
            
            /* Coinflip responsive */
            .coin {
                width: 150px;
                height: 150px;
            }
            
            .coin-icon {
                width: 60px;
                height: 60px;
            }
            
            .coinflip-side-btn {
                width: 100px;
                height: 100px;
            }
        }
        
        @media (max-width: 480px) {
            .mines-grid-container {
                gap: 6px;
                max-width: 280px;
            }
            
            .card-container {
                width: 50px;
                height: 73px;
                margin: 0 1px;
            }
            
            .card-face > div:first-child,
            .card-face > div:last-child {
                font-size: 12px;
            }
            
            .card-face .card-value {
                font-size: 36px;
            }
            
            .modal-content {
                padding: 16px;
            }
        }
        
        /* Loading Animation */
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(139, 92, 246, 0.3);
            border-radius: 50%;
            border-top-color: #8b5cf6;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Blackjack Table - FIXED */
        .blackjack-table {
            background: linear-gradient(135deg, #064e3b, #022c22);
            border-radius: 16px;
            border: 4px solid #3f2c22;
            box-shadow: 0 15px 30px -8px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
            padding: 16px;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .blackjack-table::before {
            content: '';
            position: absolute;
            inset: 0;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(255,255,255,0.05) 1px, transparent 1px),
                radial-gradient(circle at 80% 20%, rgba(255,255,255,0.05) 1px, transparent 1px);
            background-size: 40px 40px;
            opacity: 0.3;
        }
        
        /* Game Controls */
        .game-controls {
            background: linear-gradient(135deg, #1e293b, #0f172a);
            border-radius: 12px;
            border: 1px solid #334155;
            padding: 16px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        
        /* Live Wins Panel */
        .live-wins-panel {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.9));
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 12px;
            margin-top: 16px;
            max-height: 250px;
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }
        
        .live-win-item {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(139, 92, 246, 0.05));
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            animation: slide-in-right 0.3s ease-out;
            font-size: 14px;
        }
        
        /* Chat adjustments */
        #chatSidebar {
            flex-shrink: 0;
            width: 280px;
            height: calc(100vh - 64px);
            position: sticky;
            top: 64px;
        }
        
        #chatMessages {
            height: calc(100vh - 180px);
            overflow-y: auto;
        }
        
        /* Mines drag selection */
        .mine-selection-line {
            position: absolute;
            background: rgba(139, 92, 246, 0.3);
            border-radius: 4px;
            pointer-events: none;
            z-index: 10;
        }
        
        /* Blackjack fit adjustment */
        .blackjack-fit-container {
            max-height: calc(100vh - 180px);
            overflow-y: auto;
        }
        
        /* Game Hand Containers */
        .hand-container {
            min-height: 140px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
            padding: 8px;
        }
        
        /* Status Text */
        .status-text {
            font-size: 1.25rem;
            font-weight: bold;
            text-align: center;
            padding: 8px;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Game Container */
        .game-container {
            padding: 1rem;
            min-height: calc(100vh - 180px);
        }
        
        /* Wallet Modal Compact */
        .wallet-section {
            padding: 12px !important;
            margin-bottom: 12px !important;
        }
        
        .wallet-section h3 {
            font-size: 18px !important;
            margin-bottom: 12px !important;
        }
        
        /* Input sizes */
        input, button, select, textarea {
            font-size: 16px !important; /* Prevents iOS zoom on focus */
        }
        
        /* Prevent text overflow */
        .truncate {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        /* Touch-friendly button sizes */
        .touch-button {
            min-height: 44px;
            min-width: 44px;
        }
        
        /* Hide sidebar on mobile when not active */
        @media (max-width: 768px) {
            #sidebar:not(.mobile-open) {
                transform: translateX(-100%);
            }
            
            #sidebar.mobile-open {
                transform: translateX(0);
            }
            
            .modal {
                align-items: flex-start;
                padding-top: 40px;
            }
            
            .modal-content {
                margin-top: 0;
                max-height: 85vh;
            }
        }
        
        /* Chicken Road Styles - FIXED CAMERA POSITION */
        .chicken-road-main {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 64px);
            background: #0b0e14;
            font-family: 'Space Grotesk', sans-serif;
            overflow: hidden;
        }
        
        /* Main Game Area */
        .chicken-game-area {
            flex: 1;
            position: relative;
            overflow: hidden;
            display: flex;
        }
        
        /* Controls Sidebar */
        .chicken-controls-sidebar {
            width: 320px;
            background: #161b26;
            border-right: 1px solid #2a3042;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            overflow-y: auto;
            z-index: 20;
            flex-shrink: 0;
        }
        
        .chicken-controls-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }
        
        .chicken-controls-header .emoji {
            font-size: 2rem;
        }
        
        .chicken-controls-header h2 {
            color: white;
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'Space Grotesk', sans-serif;
        }
        
        .chicken-control-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .chicken-control-label {
            font-size: 0.875rem;
            font-weight: 700;
            color: #8b5cf6;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .chicken-input-group {
            display: flex;
            background: linear-gradient(135deg, #0b0e14, #1e293b);
            border-radius: 12px;
            border: 1px solid #2a3042;
            overflow: hidden;
            transition: border-color 0.2s;
        }
        
        .chicken-input-group:focus-within {
            border-color: #8b5cf6;
        }
        
        .chicken-input-group input {
            flex: 1;
            background: transparent;
            border: none;
            padding: 0.75rem 1rem;
            color: white;
            font-size: 1rem;
            font-weight: 700;
            font-family: 'Space Grotesk', sans-serif;
            outline: none;
        }
        
        .chicken-input-group .icon {
            padding: 0 1rem;
            display: flex;
            align-items: center;
            background: rgba(11, 14, 20, 0.3);
            color: #f59e0b;
        }
        
        .chicken-quick-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
            margin-top: 0.25rem;
        }
        
        .chicken-quick-button {
            background: #2a3042;
            border: 1px solid #2a3042;
            border-radius: 8px;
            padding: 0.5rem;
            color: #b1bad3;
            font-size: 0.875rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Space Grotesk', sans-serif;
        }
        
        .chicken-quick-button:hover {
            background: #3a4052;
            color: white;
            border-color: #8b5cf6;
        }
        
        .chicken-select {
            width: 100%;
            background: linear-gradient(135deg, #0b0e14, #1e293b);
            border: 1px solid #2a3042;
            border-radius: 12px;
            padding: 0.75rem 1rem;
            color: white;
            font-size: 1rem;
            font-weight: 700;
            font-family: 'Space Grotesk', sans-serif;
            outline: none;
            cursor: pointer;
            transition: border-color 0.2s;
        }
        
        .chicken-select:focus {
            border-color: #8b5cf6;
        }
        
        .chicken-stats-box {
            background: linear-gradient(135deg, #161b26, #11141c);
            border-radius: 12px;
            border: 1px solid #2a3042;
            padding: 1rem;
        }
        
        .chicken-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }
        
        .chicken-stat-label {
            font-size: 0.75rem;
            color: #6b7280;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .chicken-stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            margin-top: 0.25rem;
        }
        
        .chicken-main-action {
            margin-top: auto;
        }
        
        .chicken-action-button {
            width: 100%;
            background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 1rem;
            font-size: 1.125rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Space Grotesk', sans-serif;
            box-shadow: 0 4px 0 #5b21b6;
        }
        
        .chicken-action-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #5b21b6;
        }
        
        .chicken-action-button:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #5b21b6;
        }
        
        .chicken-action-button:disabled {
            background: #2a3042;
            color: #6b7280;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }
        
        .chicken-game-info {
            font-size: 0.75rem;
            color: #6b7280;
            text-align: center;
            margin-top: 1rem;
        }
        
        /* Road Container - FIXED POSITIONING */
        .chicken-road-container {
            flex: 1;
            position: relative;
            background: #0b0e14;
            overflow: hidden;
        }
        
        /* FIXED: Camera should always show the chicken */
        .chicken-road-camera-container {
            position: absolute;
            inset: 0;
            overflow: hidden;
        }
        
        #chickenRoadCamera {
            position: absolute;
            inset-y: 0;
            left: 0;
            height: 100%;
            display: flex;
            align-items: center;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            will-change: transform;
        }
        
        /* World Container */
        #chickenWorldContainer {
            position: relative;
            display: flex;
            flex-direction: column;
            height: 100%;
            width: max-content;
            min-width: 100%;
        }
        
        /* TOP GRASS ENVIRONMENT */
        .chicken-env-top {
            height: 6rem;
            min-height: 6rem;
            background: linear-gradient(to bottom, #064e3b, #022c22);
            position: relative;
            display: flex;
            align-items: flex-end;
            overflow: hidden;
            border-bottom: 4px solid #10b981;
            flex-shrink: 0;
        }
        
        /* BOTTOM GRASS ENVIRONMENT */
        .chicken-env-bottom {
            height: 6rem;
            min-height: 6rem;
            background: linear-gradient(to top, #064e3b, #022c22);
            position: relative;
            display: flex;
            align-items: flex-start;
            overflow: hidden;
            border-top: 4px solid #10b981;
            flex-shrink: 0;
        }
        
        /* ROAD AREA - FIXED LAYOUT */
        .chicken-road-area {
            flex: 1;
            position: relative;
            display: flex;
            align-items: stretch;
            background: #2d3436;
            background-image: 
                url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.6' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
            box-shadow: inset 0 10px 20px rgba(0,0,0,0.5), inset 0 -10px 20px rgba(0,0,0,0.5);
            z-index: 10;
        }
        
        .road-border-top {
            position: absolute;
            top: 0; left: 0; right: 0; height: 6px;
            background: #ecf0f1;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
            z-index: 15;
        }
        
        .road-border-bottom {
            position: absolute;
            bottom: 0; left: 0; right: 0; height: 6px;
            background: #ecf0f1;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
            z-index: 15;
        }
        
        /* Start Sidewalk */
        .chicken-sidewalk-start {
            width: 120px;
            background: linear-gradient(to bottom, #374151, #1f2937);
            border-right: 4px solid #4b5563;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            z-index: 20;
            box-shadow: 10px 0 20px rgba(0,0,0,0.5);
            flex-shrink: 0;
        }
        
        /* End Sidewalk */
        .chicken-sidewalk-end {
            width: 120px;
            background: linear-gradient(to bottom, #374151, #1f2937);
            border-left: 4px solid #4b5563;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            z-index: 20;
            box-shadow: -10px 0 20px rgba(0,0,0,0.5);
            flex-shrink: 0;
        }
        
        /* Lanes Container - FIXED WIDTH */
        #chickenRoadContainer {
            position: relative;
            display: flex;
            height: 100%;
            min-width: 4800px; /* 30 lanes * 160px each */
            z-index: 10;
        }
        
        /* Individual Lane - FIXED SIZE */
        .chicken-lane {
            width: 160px;
            height: 100%;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: inset 10px 0 20px -10px rgba(0,0,0,0.5), inset -10px 0 20px -10px rgba(0,0,0,0.5);
            flex-shrink: 0;
            overflow: hidden;
        }
        
        .lane-separator {
            position: absolute;
            right: 0;
            top: 10%;
            bottom: 10%;
            width: 4px;
            background: repeating-linear-gradient(
                to bottom,
                #ecf0f1,
                #ecf0f1 40px,
                transparent 40px,
                transparent 80px
            );
            z-index: 5;
            opacity: 0.5;
        }
        
        @media (max-width: 1024px) {
            .chicken-game-area {
                flex-direction: column;
            }
            
            .chicken-controls-sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #2a3042;
                max-height: 300px;
                overflow-y: auto;
            }
            
            .chicken-road-container {
                min-height: 400px;
            }
            
            #chickenRoadContainer {
                min-width: 4800px;
            }
            
            .chicken-lane {
                width: 120px;
            }
        }
        
        @media (max-width: 640px) {
            .chicken-controls-sidebar {
                padding: 1rem;
            }
            
            .chicken-controls-header h2 {
                font-size: 1.25rem;
            }
            
            .chicken-action-button {
                padding: 0.75rem;
                font-size: 1rem;
            }
            
            .chicken-sidewalk-start,
            .chicken-sidewalk-end {
                width: 80px;
            }
            
            #chickenRoadContainer {
                min-width: 3600px; /* 30 lanes * 120px each */
            }
            
            .chicken-lane {
                width: 120px;
            }
        }

        /* Global Alert Bar */
        .global-alert-bar {
            position: fixed;
            top: 64px;
            left: 0;
            right: 0;
            z-index: 10000;
            padding: 12px;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
            animation: slideDown 0.5s ease-out;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }
        
        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .global-alert-bar.purple {
            background: linear-gradient(135deg, #8b5cf6, #6d28d9);
            color: white;
            border-bottom: 3px solid #a78bfa;
        }
        
        /* Money Transfer Chat Messages */
        .chat-transfer-message {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(139, 92, 246, 0.1));
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 8px;
            padding: 8px 12px;
            margin: 4px 0;
            font-size: 14px;
        }
        
        .chat-transfer-message.gold {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(217, 119, 6, 0.15));
            border: 1px solid rgba(245, 158, 11, 0.4);
        }
        
        .chat-transfer-message.purple {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(124, 58, 237, 0.15));
            border: 1px solid rgba(139, 92, 246, 0.4);
        }

        /* Special Win Notification Styles */
        .big-win-notification.purple {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.25), rgba(124, 58, 237, 0.15));
            border: 2px solid #8b5cf6;
        }
        
        .big-win-notification.purple .amount {
            color: #a78bfa;
            text-shadow: 0 0 20px rgba(139, 92, 246, 0.7);
        }
        
        /* Ban Modal */
        .ban-modal {
            position: fixed;
            inset: 0;
            z-index: 99999;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.98);
            backdrop-filter: blur(20px);
            animation: fadeIn 0.5s ease-out;
        }
        
        .ban-modal.active {
            display: flex;
        }
        
        .ban-content {
            background: linear-gradient(135deg, #161b26, #11141c);
            border-radius: 20px;
            border: 2px solid #ef4444;
            box-shadow: 0 25px 50px -12px rgba(239, 68, 68, 0.4), 
                        0 0 100px rgba(239, 68, 68, 0.2);
            max-width: 500px;
            width: 90%;
            padding: 40px;
            text-align: center;
            animation: scale-in 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-origin: center;
        }
        
        .ban-icon {
            font-size: 4rem;
            color: #ef4444;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }
        
        .ban-title {
            font-size: 2rem;
            font-weight: 800;
            color: white;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .ban-reason {
            color: #fca5a5;
            font-size: 1.2rem;
            line-height: 1.6;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(239, 68, 68, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .ban-duration {
            background: rgba(239, 68, 68, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 30px;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .ban-duration-label {
            color: #ef4444;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }
        
        .ban-duration-value {
            color: white;
            font-size: 1.5rem;
            font-weight: 700;
            font-family: monospace;
        }
        
        .ban-appeal {
            color: #b1bad3;
            font-size: 0.9rem;
            line-height: 1.6;
            margin-top: 20px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <!-- Global Alert Bar (for 200k+ wins) -->
    <div id="globalAlertBar" class="global-alert-bar hidden"></div>
    
    <!-- Ban Modal -->
    <div id="banModal" class="ban-modal">
        <div class="ban-content">
            <div class="ban-icon">
                <i class="fa-solid fa-ban"></i>
            </div>
            <h1 class="ban-title">Account Banned</h1>
            <div class="ban-reason" id="banReason">
                Violation of community rules
            </div>
            <div class="ban-duration">
                <div class="ban-duration-label">Ban Duration</div>
                <div id="banDuration" class="ban-duration-value">Permanent</div>
            </div>
            <div class="text-gray-500 text-sm">
                <i class="fa-solid fa-info-circle mr-1"></i>
                This account has been suspended due to rule violations.
            </div>
            <div class="ban-appeal">
                If you believe this is a mistake, please contact support.
            </div>
        </div>
    </div>
    
    <!-- Maintenance Modal -->
    <div id="maintenanceModal" class="maintenance-modal">
        <div class="maintenance-content">
            <div class="maintenance-icon">
                <i class="fa-solid fa-tools"></i>
            </div>
            <h1 class="maintenance-title">Under Maintenance</h1>
            <div class="maintenance-message">
                Moon Casino is currently undergoing scheduled maintenance to bring you an even better gaming experience.
                We'll be back online shortly!
            </div>
            <div class="maintenance-timer">
                <div class="maintenance-timer-label">Estimated Time Remaining</div>
                <div id="maintenanceTimer" class="maintenance-timer-value">00:30:00</div>
            </div>
            <div class="text-gray-500 text-sm">
                <i class="fa-solid fa-info-circle mr-1"></i>
                All games, deposits, and withdrawals are temporarily disabled.
            </div>
        </div>
    </div>

    <!-- Sound Toggle -->
    <div class="sound-toggle" id="soundToggle" onclick="app.toggleSound()">
        <i class="fa-solid fa-volume-high"></i>
    </div>

    <!-- Navbar -->
    <nav class="h-16 bg-[#161b26]/95 backdrop-blur-xl flex items-center justify-between px-4 md:px-6 shadow-2xl border-b border-[#2a3042] sticky top-0 z-40">
        <div class="flex items-center gap-3">
            <button class="text-gray-400 hover:text-white md:hidden transition-all duration-300 hover:scale-110 touch-button" onclick="app.toggleSidebar()">
                <i class="fa-solid fa-bars text-lg"></i>
            </button>
            <div class="flex items-center gap-2 cursor-pointer group" onclick="app.loadGame('home')">
                <!-- Logo without animation -->
                <div class="w-8 h-8 md:w-10 md:h-10 rounded-full bg-gradient-to-br from-[#8b5cf6] to-[#4c1d95] flex items-center justify-center shadow-lg relative overflow-hidden">
                    <i class="fa-solid fa-moon text-white text-sm md:text-lg relative z-10"></i>
                    <div class="absolute inset-0 bg-white/10"></div>
                </div>
                <div class="text-xl md:text-2xl font-bold text-white tracking-tight truncate max-w-[150px] md:max-w-none">
                    Moon<span class="text-[#8b5cf6]">Casino</span>
                </div>
            </div>
        </div>
        <div class="flex items-center gap-3">
            <!-- Live Wins Indicator -->
            <div class="hidden md:flex items-center gap-2 bg-gradient-to-r from-[#0b0e14] to-[#1e2533] rounded-full px-2 py-1 border border-[#2a3042]">
                <div class="w-2 h-2 bg-[#10b981] rounded-full animate-pulse"></div>
                <span class="text-[#10b981] text-xs font-bold tracking-wider">LIVE WINS</span>
            </div>
            
            <div class="hidden md:flex bg-gradient-to-r from-[#0b0e14] to-[#1e2533] rounded-full px-1 py-1 items-center gap-2 border border-[#2a3042] shadow-lg">
                <div class="bg-gradient-to-r from-[#1e293b] to-[#0f172a] rounded-full px-3 py-2 flex items-center gap-2 min-w-[140px] justify-between cursor-pointer hover:from-[#2a3042] hover:to-[#1e293b] transition-all duration-300 group" onclick="app.openDepositModal()">
                    <span class="text-[#8b5cf6] text-xs font-bold tracking-wider">COINS</span>
                    <span class="text-white font-mono font-bold text-base tracking-wider truncate max-w-[80px]" id="balanceDisplay">500</span>
                    <i class="fa-solid fa-coins text-yellow-400 opacity-0 group-hover:opacity-100 transition-all duration-300 text-sm"></i>
                </div>
                <button onclick="app.openDepositModal()" class="bg-gradient-to-r from-[#8b5cf6] to-[#7c3aed] hover:from-[#7c3aed] hover:to-[#6d28d9] text-white px-4 py-2 rounded-full text-xs font-bold shadow-lg shadow-purple-900/30 transition-all duration-300 hover:scale-105">
                    <i class="fa-solid fa-wallet mr-1"></i> Wallet
                </button>
            </div>
            <button class="md:hidden text-white bg-gradient-to-r from-[#1e293b] to-[#0f172a] p-2 rounded-lg border border-[#2a3042] shadow-lg hover:scale-110 transition-all duration-300 touch-button" onclick="app.openDepositModal()">
                <i class="fa-solid fa-wallet text-[#8b5cf6] text-base"></i>
            </button>
            <button class="text-gray-400 hover:text-white ml-1 transition-all duration-300 hover:scale-110 touch-button" onclick="app.toggleChat()">
                <i class="fa-solid fa-message text-lg"></i>
            </button>
            <div class="w-8 h-8 md:w-9 md:h-9 rounded-full bg-gradient-to-r from-blue-500 to-teal-400 flex items-center justify-center text-white font-bold text-sm border-2 border-[#161b26] shadow-lg hover:scale-110 transition-all duration-300 cursor-pointer touch-button" id="userAvatar">
                U
            </div>
            <button onclick="app.logout()" class="text-gray-400 hover:text-white ml-1 transition-all duration-300 hover:scale-110 touch-button">
                <i class="fa-solid fa-right-from-bracket text-sm md:text-base"></i>
            </button>
        </div>
    </nav>
    
    <!-- Layout -->
    <div class="flex flex-1 overflow-hidden">
        <!-- Sidebar -->
        <aside id="sidebar" class="absolute md:relative inset-y-0 left-0 z-30 w-64 bg-[#161b26]/95 backdrop-blur-xl border-r border-[#2a3042] transform -translate-x-full md:translate-x-0 flex flex-col transition-transform duration-500 ease-out shadow-2xl md:shadow-none">
            <div class="flex-1 overflow-y-auto py-6 px-4 space-y-1">
                <div class="text-xs font-bold text-[#8b5cf6] mb-4 px-3 tracking-wider uppercase">Premium Games</div>
                <button onclick="app.loadGame('home')" id="nav-home" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gradient-to-r hover:from-[#2a3042] hover:to-[#1e293b] text-[#b1bad3] hover:text-white font-medium transition-all duration-300 group touch-button">
                    <i class="fa-solid fa-house w-4 text-center group-hover:text-[#8b5cf6] transition-all duration-300"></i> 
                    <span class="text-sm">Home</span>
                    <i class="fa-solid fa-chevron-right text-xs opacity-0 group-hover:opacity-100 transition-all duration-300 ml-auto"></i>
                </button>
                <div class="h-px bg-gradient-to-r from-transparent via-[#2a3042] to-transparent my-2 mx-3"></div>
                <button onclick="app.loadGame('mines')" id="nav-mines" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gradient-to-r hover:from-[#2a3042] hover:to-[#1e293b] text-[#b1bad3] hover:text-white font-medium transition-all duration-300 group touch-button">
                    <i class="fa-solid fa-bomb text-[#f59e0b] w-4 text-center group-hover:scale-110 transition-all duration-300"></i> 
                    <span class="text-sm">Mines</span>
                    <i class="fa-solid fa-chevron-right text-xs opacity-0 group-hover:opacity-100 transition-all duration-300 ml-auto"></i>
                </button>
                <button onclick="app.loadGame('blackjack')" id="nav-blackjack" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gradient-to-r hover:from-[#2a3042] hover:to-[#1e293b] text-[#b1bad3] hover:text-white font-medium transition-all duration-300 group touch-button">
                    <i class="fa-solid fa-diamond text-[#10b981] w-4 text-center group-hover:scale-110 transition-all duration-300"></i> 
                    <span class="text-sm">Blackjack</span>
                    <i class="fa-solid fa-chevron-right text-xs opacity-0 group-hover:opacity-100 transition-all duration-300 ml-auto"></i>
                </button>
                <button onclick="app.loadGame('chicken')" id="nav-chicken" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gradient-to-r hover:from-[#2a3042] hover:to-[#1e293b] text-[#b1bad3] hover:text-white font-medium transition-all duration-300 group touch-button">
                    <i class="fa-solid fa-egg text-[#f59e0b] w-4 text-center group-hover:scale-110 transition-all duration-300"></i> 
                    <span class="text-sm">Chicken Road</span>
                    <i class="fa-solid fa-chevron-right text-xs opacity-0 group-hover:opacity-100 transition-all duration-300 ml-auto"></i>
                </button>
                <!-- Added Coinflip Game -->
                <button onclick="app.loadGame('coinflip')" id="nav-coinflip" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gradient-to-r hover:from-[#2a3042] hover:to-[#1e293b] text-[#b1bad3] hover:text-white font-medium transition-all duration-300 group touch-button">
                    <i class="fa-solid fa-coins text-[#f59e0b] w-4 text-center group-hover:scale-110 transition-all duration-300"></i> 
                    <span class="text-sm">Coinflip</span>
                    <i class="fa-solid fa-chevron-right text-xs opacity-0 group-hover:opacity-100 transition-all duration-300 ml-auto"></i>
                </button>
                <button onclick="app.loadGame('leaderboard')" id="nav-leaderboard" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-gradient-to-r hover:from-[#2a3042] hover:to-[#1e293b] text-[#b1bad3] hover:text-white font-medium transition-all duration-300 group touch-button">
                    <i class="fa-solid fa-trophy text-[#f59e0b] w-4 text-center group-hover:scale-110 transition-all duration-300"></i> 
                    <span class="text-sm">Leaderboard</span>
                    <i class="fa-solid fa-chevron-right text-xs opacity-0 group-hover:opacity-100 transition-all duration-300 ml-auto"></i>
                </button>
            </div>
            <div class="p-4 bg-gradient-to-t from-[#11141c] to-transparent border-t border-[#2a3042]">
                <div class="flex justify-between text-xs text-[#6b7280] mb-2">
                    <span>Logged in as</span>
                    <span id="loggedUsername" class="text-[#10b981] font-bold truncate max-w-[120px]">Guest</span>
                </div>
                <div class="text-[10px] text-center text-[#555d70] font-mono bg-gradient-to-r from-[#0b0e14] to-[#1e293b] p-2 rounded border border-[#2a3042] truncate shadow-inner">
                    <span id="userIdDisplay">Not logged in</span>
                </div>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main id="mainContent" class="flex-1 overflow-y-auto p-3 md:p-4"></main>
        
        <!-- Chat -->
        <aside id="chatSidebar" class="hidden md:flex flex-col w-72 bg-[#161b26]/95 backdrop-blur-xl border-l border-[#2a3042] shadow-2xl">
            <div class="p-4 border-b border-[#2a3042] flex justify-between items-center bg-gradient-to-r from-[#11141c] to-transparent">
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 bg-[#10b981] rounded-full animate-pulse"></div>
                    <span class="text-white font-bold text-sm tracking-wider">Global Chat</span>
                </div>
                <div class="text-xs text-[#6b7280] bg-[#0b0e14] px-2 py-1 rounded-full border border-[#2a3042]" id="onlineCount">0 Online</div>
            </div>
            <div id="chatMessages" class="flex-1 overflow-y-auto p-4 space-y-3 text-sm bg-gradient-to-b from-[#0b0e14]/50 to-transparent"></div>
            <div class="p-3 bg-gradient-to-t from-[#161b26] to-transparent border-t border-[#2a3042]">
                <form onsubmit="app.sendChatMessage(event)" class="relative">
                    <input type="text" id="chatInput" placeholder="Type a message..." class="w-full bg-gradient-to-r from-[#0b0e14] to-[#1e293b] text-white pl-4 pr-10 py-3 rounded-xl border border-[#2a3042] text-sm focus:outline-none focus:border-[#8b5cf6] transition-all duration-300">
                    <button type="submit" class="absolute right-2 top-1/2 -translate-y-1/2 text-[#8b5cf6] hover:text-white p-1.5 transition-all duration-300 hover:scale-110 touch-button">
                        <i class="fa-solid fa-paper-plane text-sm"></i>
                    </button>
                </form>
            </div>
        </aside>
    </div>
    
    <!-- Auth Modal -->
    <div id="authModal" class="modal active">
        <div class="modal-content p-6">
            <div class="text-center mb-6">
                <!-- Logo without animation -->
                <div class="w-16 h-16 rounded-full bg-gradient-to-br from-[#8b5cf6] to-[#4c1d95] flex items-center justify-center mx-auto mb-4 relative overflow-hidden">
                    <i class="fa-solid fa-moon text-white text-2xl relative z-10"></i>
                    <div class="absolute inset-0 bg-white/20"></div>
                </div>
                <h2 class="text-2xl font-bold text-white mb-2">Moon Casino</h2>
                <p class="text-[#6b7280] text-sm">Please login or sign up to play</p>
            </div>
            
            <div id="loginForm" class="space-y-4">
                <div>
                    <label class="text-xs text-[#6b7280] font-bold mb-1 block tracking-wider">Email</label>
                    <input type="email" id="loginEmail" class="w-full bg-gradient-to-r from-[#0b0e14] to-[#1e293b] border border-[#2a3042] rounded-xl px-4 py-3 text-white focus:outline-none focus:border-[#8b5cf6] transition-all duration-300 text-sm" placeholder="Enter your email">
                </div>
                <div>
                    <label class="text-xs text-[#6b7280] font-bold mb-1 block tracking-wider">Password</label>
                    <input type="password" id="loginPassword" class="w-full bg-gradient-to-r from-[#0b0e14] to-[#1e293b] border border-[#2a3042] rounded-xl px-4 py-3 text-white focus:outline-none focus:border-[#8b5cf6] transition-all duration-300 text-sm" placeholder="Enter your password">
                </div>
                <button onclick="app.login()" class="w-full btn-primary py-3 rounded-xl font-bold text-base tracking-wider touch-button">Login</button>
                <p class="text-center text-[#6b7280] text-xs">
                    Don't have an account? 
                    <button onclick="app.showSignup()" class="text-[#8b5cf6] hover:text-[#7c3aed] transition-all duration-300 font-bold">Sign up</button>
                </p>
            </div>
            
            <div id="signupForm" class="space-y-4 hidden">
                <div>
                    <label class="text-xs text-[#6b7280] font-bold mb-1 block tracking-wider">Username</label>
                    <input type="text" id="signupUsername" class="w-full bg-gradient-to-r from-[#0b0e14] to-[#1e293b] border border-[#2a3042] rounded-xl px-4 py-3 text-white focus:outline-none focus:border-[#8b5cf6] transition-all duration-300 text-sm" placeholder="Choose a username">
                </div>
                <div>
                    <label class="text-xs text-[#6b7280] font-bold mb-1 block tracking-wider">Email</label>
                    <input type="email" id="signupEmail" class="w-full bg-gradient-to-r from-[#0b0e14] to-[#1e293b] border border-[#2a3042] rounded-xl px-4 py-3 text-white focus:outline-none focus:border-[#8b5cf6] transition-all duration-300 text-sm" placeholder="Enter your email">
                </div>
                <div>
                    <label class="text-xs text-[#6b7280] font-bold mb-1 block tracking-wider">Password</label>
                    <input type="password" id="signupPassword" class="w-full bg-gradient-to-r from-[#0b0e14] to-[#1e293b] border border-[#2a3042] rounded-xl px-4 py-3 text-white focus:outline-none focus:border-[#8b5cf6] transition-all duration-300 text-sm" placeholder="Create a password">
                </div>
                <button onclick="app.signup()" class="w-full btn-primary py-3 rounded-xl font-bold text-base tracking-wider touch-button">Sign Up</button>
                <p class="text-center text-[#6b7280] text-xs">
                    Already have an account? 
                    <button onclick="app.showLogin()" class="text-[#8b5cf6] hover:text-[#7c3aed] transition-all duration-300 font-bold">Login</button>
                </p>
            </div>
        </div>
    </div>
    
    <!-- Wallet Modal - Compact -->
    <div id="depositModal" class="modal">
        <div class="modal-content p-5">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-white">Wallet</h2>
                <button onclick="app.closeDepositModal()" class="text-[#6b7280] hover:text-white transition-all duration-300 hover:scale-110 touch-button">
                    <i class="fa-solid fa-xmark text-lg"></i>
                </button>
            </div>
            
            <div class="space-y-5">
                <!-- Balance Display -->
                <div class="bg-gradient-to-r from-[#1e293b] to-[#0f172a] rounded-xl p-4 border border-[#2a3042] relative overflow-hidden wallet-section">
                    <div class="absolute top-0 right-0 w-24 h-24 bg-[#8b5cf6] rounded-full -mr-12 -mt-12 opacity-10"></div>
                    <div class="relative z-10">
                        <div class="text-center">
                            <div class="text-gray-400 text-xs mb-1 tracking-wider">Your Balance</div>
                            <div class="text-white font-bold text-2xl mb-3" id="modalBalance">500</div>
                            <div class="text-gray-500 text-xs">Play games to earn more coins!</div>
                        </div>
                    </div>
                </div>
                
                <!-- Free Coins Section -->
                <div class="text-center wallet-section">
                    <i class="fa-solid fa-gift text-[#8b5cf6] text-3xl mb-2"></i>
                    <h3 class="text-white font-bold text-base mb-1">Free Coins</h3>
                    <p class="text-[#6b7280] text-xs mb-4">Claim 500 free coins whenever your balance is under 100</p>
                    <div class="bg-gradient-to-r from-[#11141c] to-[#0b0e14] rounded-xl p-4 border border-[#2a3042]">
                        <div class="text-white font-bold text-xl mb-3" id="freeCoinsTimer">Ready to Claim</div>
                        <button id="claimCoinsBtn" onclick="app.claimFreeCoins()" class="w-full btn-primary py-3 rounded-xl font-bold text-sm disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 touch-button">
                            Claim 500 Coins
                        </button>
                        <div class="text-xs text-gray-500 mt-2">
                            <i class="fa-solid fa-clock mr-1"></i>
                            <span id="freeCoinsCooldown">No cooldown</span>
                        </div>
                    </div>
                </div>
                
                <!-- Send Money Section -->
                <div class="border-t border-[#2a3042] pt-5 wallet-section">
                    <h3 class="text-white font-bold text-base mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-money-bill-transfer text-[#10b981] text-sm"></i>
                        Send Money
                    </h3>
                    <div class="space-y-3">
                        <div>
                            <label class="text-xs text-[#6b7280] font-bold mb-1 block tracking-wider">Recipient Username</label>
                            <input type="text" id="sendToUsername" placeholder="Enter username" class="w-full bg-gradient-to-r from-[#0b0e14] to-[#1e293b] border border-[#2a3042] rounded-xl px-3 py-2.5 text-white focus:outline-none focus:border-[#10b981] transition-all duration-300 text-sm">
                        </div>
                        <div>
                            <label class="text-xs text-[#6b7280] font-bold mb-1 block tracking-wider">Amount to Send</label>
                            <input type="number" id="sendAmount" placeholder="0" class="w-full bg-gradient-to-r from-[#0b0e14] to-[#1e293b] border border-[#2a3042] rounded-xl px-3 py-2.5 text-white focus:outline-none focus:border-[#10b981] transition-all duration-300 text-sm">
                        </div>
                        <div class="bg-gradient-to-r from-[#0f172a] to-[#1e293b] p-3 rounded-lg border border-[#2a3042]">
                            <div class="flex justify-between text-xs mb-1">
                                <span class="text-gray-400">Recipient receives:</span>
                                <span id="recipientReceives" class="text-[#10b981] font-bold">0 coins</span>
                            </div>
                            <div class="flex justify-between text-xs">
                                <span class="text-gray-400">10% transfer fee:</span>
                                <span id="transferFee" class="text-[#f59e0b] font-bold">0 coins</span>
                            </div>
                        </div>
                        <button onclick="app.sendMoney()" class="w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white py-3 rounded-xl font-bold text-sm tracking-wider transition-all duration-300 hover:scale-[1.02] touch-button">
                            <i class="fa-solid fa-paper-plane mr-1 text-xs"></i> Send Money
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div id="toastContainer"></div>

    <script>
        // Sound Effects - Using .wav files from your sounds folder
        const sounds = {
            card: new Audio('sounds/card.wav'),
            win: new Audio('sounds/win.wav'),
            lose: new Audio('sounds/lose.wav'),
            mine: new Audio('sounds/explosion.wav'),
            gem: new Audio('sounds/win.wav'),
            click: new Audio('sounds/click.wav'),
            hop: new Audio('sounds/click.wav'),
            coinflip: new Audio('sounds/click.wav')
        };

        // Set volume for all sounds
        Object.values(sounds).forEach(sound => {
            sound.volume = 0.5;
            sound.preload = 'auto';
        });

        // BANNED WORDS LIST - Updated as requested
        const BANNED_WORDS = [
            'fuck', 'shit', 'bitch', 'asshole', 'cunt', 'nigger', 'nigga', 
            'faggot', 'retard', 'whore', 'slut', 'bastard', 'pussy', 'dick',
            'cock', 'porn', 'hack', 'cheat', 'scam', 'gay', 'i like guys',
            'ilikeguys', 'g4y', 'f4g', 'fag', 'queer', 'homosexual'
        ];

        // Firebase Configuration
        const firebaseConfig = {
          apiKey: "AIzaSyDJ5tpQ5pVY2A8L55Eg5SxB_L02dIHWcWA",
          authDomain: "cool-club-31ec4.firebaseapp.com",
          databaseURL: "https://cool-club-31ec4-default-rtdb.firebaseio.com",
          projectId: "cool-club-31ec4",
          storageBucket: "cool-club-31ec4.firebasestorage.app",
          messagingSenderId: "218577130374",
          appId: "1:218577130374:web:e345bf0d4ee0a68d029207",
          measurementId: "G-BFSY9J2PQW"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Chicken Road Game Configuration - UPDATED WITH LOWER WIN CHANCES
        const CHICKEN_MULTIPLIERS = {
            easy: [],
            medium: [],
            hard: [],
            expert: []
        };

        // Populate multipliers for Chicken Road
        for(let i=0; i<30; i++) CHICKEN_MULTIPLIERS.easy.push(1.02 * Math.pow(1.06, i+1));
        for(let i=0; i<30; i++) CHICKEN_MULTIPLIERS.medium.push(1.10 * Math.pow(1.17, i+1));
        for(let i=0; i<30; i++) CHICKEN_MULTIPLIERS.hard.push(1.20 * Math.pow(1.30, i+1));
        for(let i=0; i<30; i++) {
            let val = Math.pow(30000, (i+1)/30);
            if (val < 1.5 && i===0) val = 1.98;
            CHICKEN_MULTIPLIERS.expert.push(val);
        }

        // INCREASED HOUSE EDGE FOR LOWER WIN CHANCES
        const CHICKEN_HOUSE_EDGE = 0.15; // Increased from 0.02 to 0.15 (15% house edge)

        class GameApp {
            constructor() {
                this.user = null;
                this.balance = 500; // Default, will be loaded from database
                this.username = '';
                this.userId = '';
                this.activeGame = null;
                this.mainContent = document.getElementById('mainContent');
                this.balanceDisplay = document.getElementById('balanceDisplay');
                this.sidebar = document.getElementById('sidebar');
                this.sidebarOpen = false;
                this.chatSidebar = document.getElementById('chatSidebar');
                this.soundEnabled = true;
                this.minesActive = false;
                this.bjInProgress = false;
                this.lastFreeCoinsClaim = 0;
                this.freeCoinsCooldown = 0; // 5-minute cooldown after claiming free coins
                this.bigWinThreshold = 1000;
                this.chatLoadedAt = null;
                this.liveWinsInterval = null;
                this.minesDragging = false;
                this.minesDragStartTile = null;
                this.minesSelectedTiles = new Set();
                
                // Maintenance state
                this.maintenanceMode = false;
                this.maintenanceEndTime = null;
                this.maintenanceTimerInterval = null;
                
                // Chicken Road state
                this.chickenState = {
                    isPlaying: false,
                    currentStep: -1,
                    difficulty: 'easy',
                    bet: 10,
                    currentMultiplier: 1.00,
                    gameActive: false,
                    // Real-time balance update
                    balanceUpdateListener: null
                };
                
                // Coinflip state - UPDATED WITH LOWER WIN CHANCES
                this.coinflipState = {
                    isGameActive: false,
                    isFlipping: false,
                    currentBet: 0,
                    accumulatedValue: 0,
                    streak: 0,
                    history: [],
                    coinRotation: 0,
                    // LOWER HOUSE EDGE FOR COINFLIP
                    HOUSE_EDGE: 1.85 // Lowered from 1.95 to 1.85
                };
                
                // Online users tracking
                this.onlineUsers = new Map();
                this.activityPingInterval = null;
                this.lastActivityTime = Date.now();
                
                // Ban system
                this.bannedUsers = new Map();
                this.userValidationInterval = null;
                this.chatBannedUsers = new Map();
                
                // Initialize app
                this.init();
            }

            init() {
                this.checkAuth();
                this.checkMaintenanceStatus();
                this.initChat();
                this.updateFreeCoinsButton();
                this.listenForBigWins();
                this.startActivityPing();
                this.startUserValidation();
                
                // Set default home page
                this.loadGame('home');
                
                // Close sidebar when clicking outside on mobile
                document.addEventListener('click', (e) => {
                    if (window.innerWidth < 768 && this.sidebarOpen && 
                        !this.sidebar.contains(e.target) && 
                        !e.target.closest('[onclick*="toggleSidebar"]')) {
                        this.toggleSidebar();
                    }
                });
                
                // Track user activity
                document.addEventListener('mousemove', () => this.updateUserActivity());
                document.addEventListener('click', () => this.updateUserActivity());
                document.addEventListener('keypress', () => this.updateUserActivity());
                document.addEventListener('touchstart', () => this.updateUserActivity());
                
                // Prevent zoom on iOS
                document.addEventListener('touchstart', (e) => {
                    if (e.touches.length > 1) {
                        e.preventDefault();
                    }
                }, { passive: false });
                
                // Handle window resize
                window.addEventListener('resize', this.handleResize.bind(this));
                this.handleResize();
                
                // Update transfer fee display
                document.getElementById('sendAmount')?.addEventListener('input', () => this.updateTransferFeeDisplay());
            }
            
            handleResize() {
                // Ensure proper scaling on mobile
                const viewport = document.querySelector('meta[name="viewport"]');
                if (window.innerWidth <= 768) {
                    viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no');
                } else {
                    viewport.setAttribute('content', 'width=device-width, initial-scale=1.0');
                }
            }
            
            updateTransferFeeDisplay() {
                const amountInput = document.getElementById('sendAmount');
                const recipientReceives = document.getElementById('recipientReceives');
                const transferFee = document.getElementById('transferFee');
                
                if (!amountInput || !recipientReceives || !transferFee) return;
                
                const amount = parseFloat(amountInput.value) || 0;
                const fee = Math.floor(amount * 0.10); // 10% fee
                const recipientGets = amount - fee;
                
                recipientReceives.textContent = `${recipientGets} coins`;
                transferFee.textContent = `${fee} coins`;
            }

            updateUserActivity() {
                this.lastActivityTime = Date.now();
            }

            startActivityPing() {
                // Clear any existing interval
                if (this.activityPingInterval) {
                    clearInterval(this.activityPingInterval);
                }
                
                // Ping every 5 seconds to show user is active
                this.activityPingInterval = setInterval(() => {
                    if (this.userId && this.username && !this.maintenanceMode) {
                        // Check if user has been active in last 10 seconds
                        const isActive = (Date.now() - this.lastActivityTime) < 10000;
                        
                        if (isActive) {
                            // Update online status
                            database.ref('online/' + this.userId).set({
                                username: this.username,
                                lastSeen: Date.now(),
                                isActive: true
                            });
                        } else {
                            // User is inactive, remove from online list
                            database.ref('online/' + this.userId).remove();
                        }
                    }
                }, 5000);
            }

            // USER VALIDATION SYSTEM (every 10 seconds)
            startUserValidation() {
                // Clear any existing interval
                if (this.userValidationInterval) {
                    clearInterval(this.userValidationInterval);
                }
                
                // Check user account every 10 seconds
                this.userValidationInterval = setInterval(async () => {
                    await this.validateUserAccount();
                }, 10000); // 10 seconds
            }

            async validateUserAccount() {
                if (!this.userId || !this.username) return;
                
                try {
                    // Check if user still exists in database
                    const userSnapshot = await database.ref('users/' + this.userId).once('value');
                    
                    if (!userSnapshot.exists()) {
                        // User account deleted - force logout
                        this.showToast('Your account no longer exists', 'error');
                        setTimeout(() => {
                            this.logout();
                            this.showBanModal('Account deleted', 'Your account has been removed from the system.');
                        }, 1000);
                        return;
                    }
                    
                    // Check if user is banned
                    const isBanned = await this.checkIfBanned(this.userId);
                    if (isBanned) {
                        this.showBanModal(isBanned.reason, isBanned.duration ? 'Temporary ban' : 'Permanent ban');
                        return;
                    }
                    
                    // Check if user is chat banned
                    const isChatBanned = await this.checkIfChatBanned(this.userId);
                    if (isChatBanned) {
                        // Disable chat input
                        const chatInput = document.getElementById('chatInput');
                        if (chatInput) {
                            chatInput.disabled = true;
                            chatInput.placeholder = 'You are chat banned';
                        }
                    }
                    
                } catch (error) {
                    console.error('Error validating user account:', error);
                }
            }

            // CHAT FILTER SYSTEM
            checkChatMessage(message) {
                const lowerMsg = message.toLowerCase();
                const normalizedMsg = lowerMsg.replace(/[^a-z0-9]/g, '');
                
                // Check for banned words (case-insensitive with pattern matching)
                for (const word of BANNED_WORDS) {
                    // Check direct match
                    if (lowerMsg.includes(word)) {
                        return { 
                            banned: true, 
                            reason: `Used banned word: ${word}`,
                            banDuration: 30 * 60 * 1000, // 30 minutes
                            type: 'account'
                        };
                    }
                    
                    // Check for leetspeak variations
                    const leetPattern = word
                        .replace(/a/gi, '[a4@]')
                        .replace(/e/gi, '[e3]')
                        .replace(/i/gi, '[i1!]')
                        .replace(/o/gi, '[o0]')
                        .replace(/s/gi, '[s5$]')
                        .replace(/t/gi, '[t7]');
                    
                    const regex = new RegExp(leetPattern, 'gi');
                    if (regex.test(message)) {
                        return { 
                            banned: true, 
                            reason: `Used banned word variation: ${word}`,
                            banDuration: 30 * 60 * 1000, // 30 minutes
                            type: 'account'
                        };
                    }
                }
                
                // Check for "i like guys" variations
                const guysPatterns = [
                    /i.*like.*guys/i,
                    /i.*love.*guys/i,
                    /guys.*are.*hot/i,
                    /men.*are.*sexy/i
                ];
                
                for (const pattern of guysPatterns) {
                    if (pattern.test(message)) {
                        return { 
                            banned: true, 
                            reason: 'Inappropriate content',
                            banDuration: 30 * 60 * 1000, // 30 minutes
                            type: 'account'
                        };
                    }
                }
                
                // Check for spam patterns
                if (/(.)\1{5,}/.test(message)) {
                    return { 
                        banned: true, 
                        reason: 'Spam detected',
                        banDuration: 1 * 60 * 60 * 1000, // 2 hours chat ban
                        type: 'chat'
                    };
                }
                
                // Check for excessive caps
                const capsCount = (message.match(/[A-Z]/g) || []).length;
                if (capsCount > message.length * 12 && message.length > 10) {
                    return { 
                        banned: true, 
                        reason: 'Excessive capitalization',
                        banDuration: 2 * 60 * 60 * 1000, // 2 hours chat ban
                        type: 'chat'
                    };
                }
                
                // Check for repeated messages
                if (this.checkRepeatedMessages(message)) {
                    return { 
                        banned: true, 
                        reason: 'Repeated messages',
                        banDuration: 1 * 60 * 60 * 1000, // 2 hours chat ban
                        type: 'chat'
                    };
                }
                
                return { banned: false };
            }

            checkRepeatedMessages(message) {
                // Store last 5 messages in localStorage
                const lastMessages = JSON.parse(localStorage.getItem('lastChatMessages') || '[]');
                
                // Check if message is similar to previous ones
                const similarCount = lastMessages.filter(msg => 
                    msg.toLowerCase() === message.toLowerCase() || 
                    msg.includes(message) || 
                    message.includes(msg)
                ).length;
                
                // Update stored messages
                lastMessages.push(message);
                if (lastMessages.length > 5) {
                    lastMessages.shift();
                }
                localStorage.setItem('lastChatMessages', JSON.stringify(lastMessages));
                
                return similarCount >= 3; // 3 similar messages trigger ban
            }

            // BAN SYSTEM
            async banUser(userId, reason = 'Violation of chat rules', duration = null, type = 'account') {
                try {
                    const banData = {
                        userId: userId,
                        username: this.username,
                        reason: reason,
                        bannedAt: Date.now(),
                        bannedBy: 'SYSTEM',
                        duration: duration,
                        expiresAt: duration ? Date.now() + duration : null,
                        type: type // 'account' or 'chat'
                    };
                    
                    // Save ban to database
                    if (type === 'account') {
                        await database.ref('bans/' + userId).set(banData);
                        this.bannedUsers.set(userId, banData);
                    } else {
                        await database.ref('chatBans/' + userId).set(banData);
                        this.chatBannedUsers.set(userId, banData);
                    }
                    
                    // Force logout if it's the current user and it's an account ban
                    if (userId === this.userId && type === 'account') {
                        this.showToast(`You have been banned: ${reason}`, 'error');
                        setTimeout(() => {
                            this.showBanModal(reason, duration ? 'Temporary ban' : 'Permanent ban');
                            this.logout();
                        }, 2000);
                    }
                    
                    // Remove from online users for account bans
                    if (type === 'account') {
                        database.ref('online/' + userId).remove();
                    }
                    
                    // Add ban notification to chat
                    const banType = type === 'account' ? 'banned' : 'chat banned';
                    const durationText = duration ? 
                        `for ${duration / (60 * 1000)} minutes` : 
                        'permanently';
                    
                    this.addChatMessage('SYSTEM', 
                        `User ${this.username} has been ${banType} ${durationText}. Reason: ${reason}`, 
                        'text-red-400', true);
                    
                    console.log(`User ${userId} ${banType}: ${reason}`);
                    
                } catch (error) {
                    console.error('Error banning user:', error);
                }
            }

            async checkIfBanned(userId) {
                try {
                    // Check local cache first
                    if (this.bannedUsers.has(userId)) {
                        const ban = this.bannedUsers.get(userId);
                        // Check if ban has expired
                        if (ban.expiresAt && Date.now() > ban.expiresAt) {
                            this.bannedUsers.delete(userId);
                            await database.ref('bans/' + userId).remove();
                            return false;
                        }
                        return ban;
                    }
                    
                    // Check database
                    const banSnapshot = await database.ref('bans/' + userId).once('value');
                    if (banSnapshot.exists()) {
                        const ban = banSnapshot.val();
                        // Check if ban has expired
                        if (ban.expiresAt && Date.now() > ban.expiresAt) {
                            await database.ref('bans/' + userId).remove();
                            return false;
                        }
                        this.bannedUsers.set(userId, ban);
                        return ban;
                    }
                    
                    return false;
                } catch (error) {
                    console.error('Error checking ban status:', error);
                    return false;
                }
            }

            async checkIfChatBanned(userId) {
                try {
                    // Check local cache first
                    if (this.chatBannedUsers.has(userId)) {
                        const ban = this.chatBannedUsers.get(userId);
                        // Check if ban has expired
                        if (ban.expiresAt && Date.now() > ban.expiresAt) {
                            this.chatBannedUsers.delete(userId);
                            await database.ref('chatBans/' + userId).remove();
                            return false;
                        }
                        return ban;
                    }
                    
                    // Check database
                    const banSnapshot = await database.ref('chatBans/' + userId).once('value');
                    if (banSnapshot.exists()) {
                        const ban = banSnapshot.val();
                        // Check if ban has expired
                        if (ban.expiresAt && Date.now() > ban.expiresAt) {
                            await database.ref('chatBans/' + userId).remove();
                            return false;
                        }
                        this.chatBannedUsers.set(userId, ban);
                        return ban;
                    }
                    
                    return false;
                } catch (error) {
                    console.error('Error checking chat ban status:', error);
                    return false;
                }
            }

            showBanModal(reason, duration = 'Permanent') {
                const banModal = document.getElementById('banModal');
                const banReason = document.getElementById('banReason');
                const banDuration = document.getElementById('banDuration');
                
                if (banModal && banReason && banDuration) {
                    banReason.textContent = reason;
                    banDuration.textContent = duration;
                    banModal.classList.add('active');
                    
                    // Force logout after showing modal
                    setTimeout(() => {
                        this.logout();
                    }, 5000);
                }
            }

            // MAINTENANCE FUNCTIONS
            async checkMaintenanceStatus() {
                try {
                    const maintenanceRef = database.ref('maintenance');
                    const snapshot = await maintenanceRef.once('value');
                    
                    if (snapshot.exists()) {
                        const maintenanceData = snapshot.val();
                        this.maintenanceMode = maintenanceData.enabled || false;
                        this.maintenanceEndTime = maintenanceData.endTime || null;
                        
                        if (this.maintenanceMode) {
                            this.showMaintenanceModal();
                            this.startMaintenanceTimer();
                        } else {
                            this.hideMaintenanceModal();
                        }
                    }
                    
                    // Listen for maintenance status changes
                    maintenanceRef.on('value', (snap) => {
                        if (snap.exists()) {
                            const maintenanceData = snap.val();
                            const newMaintenanceMode = maintenanceData.enabled || false;
                            
                            if (newMaintenanceMode !== this.maintenanceMode) {
                                this.maintenanceMode = newMaintenanceMode;
                                this.maintenanceEndTime = maintenanceData.endTime || null;
                                
                                if (this.maintenanceMode) {
                                    this.showMaintenanceModal();
                                    this.startMaintenanceTimer();
                                } else {
                                    this.hideMaintenanceModal();
                                }
                            }
                        }
                    });
                    
                } catch (error) {
                    console.error('Error checking maintenance status:', error);
                }
            }

            showMaintenanceModal() {
                const maintenanceModal = document.getElementById('maintenanceModal');
                if (maintenanceModal) {
                    maintenanceModal.classList.add('active');
                }
                
                // Disable all game-related buttons
                this.disableAllGames();
            }

            hideMaintenanceModal() {
                const maintenanceModal = document.getElementById('maintenanceModal');
                if (maintenanceModal) {
                    maintenanceModal.classList.remove('active');
                }
                
                // Re-enable games
                this.enableAllGames();
            }

            disableAllGames() {
                // Disable game buttons
                const gameButtons = document.querySelectorAll('button[id^="nav-"], .game-card, .btn-primary');
                gameButtons.forEach(button => {
                    button.disabled = true;
                    button.style.opacity = '0.5';
                    button.style.cursor = 'not-allowed';
                });
                
                // Disable bet inputs
                const betInputs = document.querySelectorAll('input[type="number"]');
                betInputs.forEach(input => {
                    input.disabled = true;
                });
                
                // Disable chat
                const chatInput = document.getElementById('chatInput');
                if (chatInput) {
                    chatInput.disabled = true;
                    chatInput.placeholder = 'Chat disabled during maintenance';
                }
                
                // Stop any active games
                if (this.minesActive) {
                    this.endMines(false, -1);
                }
                if (this.bjInProgress) {
                    this.resetBlackjackUI();
                }
                if (this.chickenState.isPlaying) {
                    this.chickenState.isPlaying = false;
                    this.updateChickenUI();
                }
                if (this.coinflipState.isGameActive) {
                    this.coinflipEndGame();
                }
            }

            enableAllGames() {
                // Re-enable game buttons
                const gameButtons = document.querySelectorAll('button[id^="nav-"], .game-card, .btn-primary');
                gameButtons.forEach(button => {
                    button.disabled = false;
                    button.style.opacity = '1';
                    button.style.cursor = 'pointer';
                });
                
                // Re-enable bet inputs
                const betInputs = document.querySelectorAll('input[type="number"]');
                betInputs.forEach(input => {
                    input.disabled = false;
                });
                
                // Re-enable chat
                const chatInput = document.getElementById('chatInput');
                if (chatInput) {
                    chatInput.disabled = false;
                    chatInput.placeholder = 'Type a message...';
                }
            }

            startMaintenanceTimer() {
                if (!this.maintenanceEndTime) {
                    document.getElementById('maintenanceTimer').textContent = '00:30:00';
                    return;
                }
                
                // Clear any existing timer
                if (this.maintenanceTimerInterval) {
                    clearInterval(this.maintenanceTimerInterval);
                }
                
                const updateTimer = () => {
                    const now = Date.now();
                    const endTime = this.maintenanceEndTime;
                    
                    if (now >= endTime) {
                        // Maintenance should be over
                        document.getElementById('maintenanceTimer').textContent = '00:00:00';
                        clearInterval(this.maintenanceTimerInterval);
                        return;
                    }
                    
                    const remaining = endTime - now;
                    const hours = Math.floor(remaining / (1000 * 60 * 60));
                    const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((remaining % (1000 * 60)) / 1000);
                    
                    const timerElement = document.getElementById('maintenanceTimer');
                    if (timerElement) {
                        timerElement.textContent = 
                            `${hours.toString().padStart(2, '0')}:` +
                            `${minutes.toString().padStart(2, '0')}:` +
                            `${seconds.toString().padStart(2, '0')}`;
                    }
                };
                
                // Update immediately and every second
                updateTimer();
                this.maintenanceTimerInterval = setInterval(updateTimer, 1000);
            }

            // ADMIN FUNCTIONS - To be called from browser console or admin panel
            async enableMaintenance(minutes = 30) {
                if (!this.userId) {
                    this.showToast('You must be logged in to enable maintenance', 'error');
                    return;
                }
                
                // Only allow admin users (you can add admin check here)
                const endTime = Date.now() + (minutes * 60 * 1000);
                
                const maintenanceData = {
                    enabled: true,
                    endTime: endTime,
                    startedBy: this.username,
                    startedAt: Date.now(),
                    message: `Maintenance mode enabled for ${minutes} minutes`
                };
                
                try {
                    await database.ref('maintenance').set(maintenanceData);
                    this.showToast(`Maintenance mode enabled for ${minutes} minutes`, 'warning');
                    this.maintenanceMode = true;
                    this.maintenanceEndTime = endTime;
                    this.showMaintenanceModal();
                    this.startMaintenanceTimer();
                    
                    // Add maintenance message to chat
                    const maintenanceMessage = `ðŸš§ MAINTENANCE ALERT: The casino is undergoing maintenance for approximately ${minutes} minutes. All games are temporarily disabled.`;
                    this.addChatMessage('System', maintenanceMessage, 'text-yellow-400', true);
                    
                } catch (error) {
                    console.error('Error enabling maintenance:', error);
                    this.showToast('Failed to enable maintenance mode', 'error');
                }
            }

            async disableMaintenance() {
                if (!this.userId) {
                    this.showToast('You must be logged in to disable maintenance', 'error');
                    return;
                }
                
                try {
                    await database.ref('maintenance').remove();
                    this.showToast('Maintenance mode disabled', 'success');
                    this.maintenanceMode = false;
                    this.maintenanceEndTime = null;
                    this.hideMaintenanceModal();
                    
                    // Clear maintenance timer
                    if (this.maintenanceTimerInterval) {
                        clearInterval(this.maintenanceTimerInterval);
                    }
                    
                    // Add maintenance complete message to chat
                    const completionMessage = 'âœ… MAINTENANCE COMPLETE: All games are now available!';
                    this.addChatMessage('System', completionMessage, 'text-green-400', true);
                    
                } catch (error) {
                    console.error('Error disabling maintenance:', error);
                    this.showToast('Failed to disable maintenance mode', 'error');
                }
            }

            // Check maintenance before allowing game actions
            checkMaintenance() {
                if (this.maintenanceMode) {
                    this.showToast('Casino is under maintenance. Please try again later.', 'error');
                    return false;
                }
                return true;
            }

            toggleSound() {
                if (!this.checkMaintenance()) return;
                
                this.soundEnabled = !this.soundEnabled;
                const toggleBtn = document.getElementById('soundToggle');
                const icon = toggleBtn.querySelector('i');
                
                if (this.soundEnabled) {
                    toggleBtn.classList.remove('muted');
                    icon.className = 'fa-solid fa-volume-high';
                    this.showToast('Sound enabled', 'success');
                } else {
                    toggleBtn.classList.add('muted');
                    icon.className = 'fa-solid fa-volume-xmark';
                    this.showToast('Sound muted', 'warning');
                }
            }

            playSound(soundName) {
                if (!this.soundEnabled || !sounds[soundName] || this.maintenanceMode) return;
                
                try {
                    const soundClone = sounds[soundName].cloneNode();
                    soundClone.volume = sounds[soundName].volume;
                    soundClone.play().catch(e => console.log('Audio play failed:', e));
                } catch (e) {
                    console.log('Sound error:', e);
                }
            }

            toggleSidebar() {
                if (this.maintenanceMode) return;
                this.sidebarOpen = !this.sidebarOpen;
                if (window.innerWidth < 768) {
                    if (this.sidebarOpen) {
                        this.sidebar.classList.remove('-translate-x-full');
                        this.sidebar.classList.add('mobile-open');
                    } else {
                        this.sidebar.classList.add('-translate-x-full');
                        this.sidebar.classList.remove('mobile-open');
                    }
                }
            }

            toggleChat() {
                if (this.maintenanceMode) {
                    this.showToast('Chat disabled during maintenance', 'warning');
                    return;
                }
                this.chatSidebar.classList.toggle('hidden');
                this.playSound('click');
            }

            showToast(message, type = 'success') {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.innerHTML = `
                    <div class="flex items-center gap-3">
                        <i class="fa-solid ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-exclamation-triangle'} text-lg"></i>
                        <span class="font-medium text-sm">${message}</span>
                    </div>
                `;
                
                document.getElementById('toastContainer').appendChild(toast);
                
                setTimeout(() => {
                    toast.classList.add('show');
                }, 10);
                
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }

            async updateBalance() {
                if (this.maintenanceMode) return;
                
                // SECURITY CHECK: Verify current user session
                if (!this.validateCurrentUser()) {
                    this.showToast('Security error: Unauthorized action', 'error');
                    return;
                }
                
                if (this.balanceDisplay) {
                    this.balanceDisplay.textContent = this.balance.toLocaleString();
                    
                    // Update modal balance display
                    const modalBalance = document.getElementById('modalBalance');
                    if (modalBalance) {
                        modalBalance.textContent = this.balance.toLocaleString();
                    }
                    
                    // Animation effect
                    this.balanceDisplay.classList.add('text-[#10b981]', 'scale-110');
                    setTimeout(() => {
                        this.balanceDisplay.classList.remove('text-[#10b981]', 'scale-110');
                    }, 500);
                }
                
                // Save to database immediately with proper error handling
                if (this.userId && this.username) {
                    try {
                        await database.ref('users/' + this.userId + '/balance').set(this.balance);
                    } catch (error) {
                        console.error('Error saving balance:', error);
                        this.showToast('Error saving balance', 'error');
                    }
                }
                
                // Update free coins button
                this.updateFreeCoinsButton();
            }

            // SECURITY: Validate current user session
            validateCurrentUser() {
                const savedUser = localStorage.getItem('moonCasinoUser');
                if (!savedUser) return false;
                
                try {
                    const user = JSON.parse(savedUser);
                    return user.userId === this.userId;
                } catch (e) {
                    return false;
                }
            }

            // Setup real-time balance updates
            setupRealTimeBalance() {
                if (this.chickenState.balanceUpdateListener) {
                    // Remove existing listener
                    this.chickenState.balanceUpdateListener();
                }
                
                if (this.userId) {
                    // Listen for balance changes in real-time
                    const balanceRef = database.ref('users/' + this.userId + '/balance');
                    this.chickenState.balanceUpdateListener = balanceRef.on('value', (snapshot) => {
                        const newBalance = snapshot.val();
                        if (newBalance !== null && newBalance !== this.balance) {
                            // SECURITY CHECK: Only update if session is valid
                            if (this.validateCurrentUser()) {
                                this.balance = parseInt(newBalance);
                                this.updateBalance();
                                
                                // Update chicken UI if game is active
                                if (this.activeGame === 'chicken') {
                                    this.updateChickenUI();
                                }
                                // Update coinflip UI if game is active
                                if (this.activeGame === 'coinflip') {
                                    this.updateCoinflipUI();
                                }
                            }
                        }
                    });
                }
            }

            // Auth Functions - FIXED WITH SESSION MANAGEMENT
            async checkAuth() {
                const savedUser = localStorage.getItem('moonCasinoUser');
                if (savedUser) {
                    try {
                        const user = JSON.parse(savedUser);
                        
                        // SECURITY: Check if user is banned
                        const isBanned = await this.checkIfBanned(user.userId);
                        if (isBanned) {
                            this.showBanModal(isBanned.reason, isBanned.duration ? 'Temporary ban' : 'Permanent ban');
                            return;
                        }
                        
                        // Check session is still valid
                        if (!this.validateSession(user.userId)) {
                            this.logout();
                            this.showToast('Session expired. Please login again.', 'warning');
                            return;
                        }
                        
                        // Check if user still exists in database
                        const userSnapshot = await database.ref('users/' + user.userId).once('value');
                        if (!userSnapshot.exists()) {
                            this.logout();
                            this.showToast('Account no longer exists', 'error');
                            return;
                        }
                        
                        const userData = userSnapshot.val();
                        this.userId = user.userId;
                        this.username = userData.username;
                        this.balance = parseInt(userData.balance) || 500;
                        this.lastFreeCoinsClaim = userData.lastFreeCoins || 0;
                        this.freeCoinsCooldown = userData.freeCoinsCooldown || 0;
                        
                        this.updateUI();
                        this.hideAuthModal();
                        this.updateOnlineStatus();
                        this.setupRealTimeBalance();
                        
                    } catch (e) {
                        console.error('Auth error:', e);
                        this.showAuthModal();
                    }
                } else {
                    this.showAuthModal();
                }
            }

            // SECURITY: Session validation function
            async validateSession(userId) {
                try {
                    const sessionRef = database.ref('sessions/' + userId);
                    const snapshot = await sessionRef.once('value');
                    const sessionData = snapshot.val();
                    
                    if (!sessionData) return false;
                    
                    // Check if session is expired (24 hours)
                    const now = Date.now();
                    if (now - sessionData.createdAt > 24 * 60 * 60 * 1000) {
                        await sessionRef.remove();
                        return false;
                    }
                    
                    return true;
                } catch (error) {
                    console.error('Session validation error:', error);
                    return false;
                }
            }

            showAuthModal() {
                document.getElementById('authModal').classList.add('active');
            }

            hideAuthModal() {
                document.getElementById('authModal').classList.remove('active');
            }

            showSignup() {
                if (this.maintenanceMode) return;
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('signupForm').classList.remove('hidden');
                this.playSound('click');
            }

            showLogin() {
                if (this.maintenanceMode) return;
                document.getElementById('signupForm').classList.add('hidden');
                document.getElementById('loginForm').classList.remove('hidden');
                this.playSound('click');
            }

            async signup() {
                if (this.maintenanceMode) {
                    this.showToast('Signup disabled during maintenance', 'error');
                    return;
                }

                const username = document.getElementById('signupUsername').value.trim();
                const email = document.getElementById('signupEmail').value.trim();
                const password = document.getElementById('signupPassword').value;

                if (!username || !email || !password) {
                    this.showToast('Please fill all fields', 'error');
                    return;
                }

                if (username.length < 3) {
                    this.showToast('Username must be at least 3 characters', 'error');
                    return;
                }

                // Check for "Emerson" in username (case-insensitive)
                const lowerUsername = username.toLowerCase();
                if (lowerUsername.includes('emerson')) {
                    // Check if email is the allowed one
                    if (email !== '2031ews@stu.pcr3schools.org') {
                        this.showToast('Username contains restricted content', 'error');
                        // Auto-ban if someone tries to use Emerson name
                        const userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                        await this.banUser(userId, 'Attempted to use restricted name: Emerson', null, 'account');
                        return;
                    }
                }

                // Check if username already exists
                const usernameSnapshot = await database.ref('users').orderByChild('username').equalTo(username).once('value');
                if (usernameSnapshot.exists()) {
                    this.showToast('Username already taken', 'error');
                    return;
                }

                // Check if email already exists
                const emailSnapshot = await database.ref('users').orderByChild('email').equalTo(email).once('value');
                if (emailSnapshot.exists()) {
                    this.showToast('Email already registered', 'error');
                    return;
                }

                // Create user
                const userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                const userData = {
                    userId,
                    username,
                    email,
                    password: btoa(password),
                    balance: 500,
                    createdAt: Date.now(),
                    lastFreeCoins: 0,
                    freeCoinsCooldown: 0,
                    totalWins: 0,
                    totalLosses: 0,
                    biggestWin: 0,
                    wageredToday: 0,
                    wageredWeek: 0,
                    wageredLifetime: 0,
                    wonToday: 0,
                    lastWagered: Date.now()
                };

                await database.ref('users/' + userId).set(userData);

                // Create session
                await database.ref('sessions/' + userId).set({
                    userId: userId,
                    createdAt: Date.now(),
                    lastActivity: Date.now()
                });

                // Save locally (only for auto-login, balance comes from database)
                localStorage.setItem('moonCasinoUser', JSON.stringify({ userId, username }));

                this.userId = userId;
                this.username = username;
                this.balance = 500;
                this.lastFreeCoinsClaim = 0;
                this.freeCoinsCooldown = 0;

                this.updateUI();
                this.hideAuthModal();
                this.showToast('Welcome to Moon Casino! You received 500 starting coins!', 'success');
                this.playSound('win');
                this.updateOnlineStatus();
                this.setupRealTimeBalance();
                
                // Confetti for new user
                confetti({
                    particleCount: 150,
                    spread: 70,
                    origin: { y: 0.6 }
                });
            }

            async login() {
                if (this.maintenanceMode) {
                    this.showToast('Login disabled during maintenance', 'error');
                    return;
                }

                const email = document.getElementById('loginEmail').value.trim();
                const password = document.getElementById('loginPassword').value;

                // Find user by email
                const snapshot = await database.ref('users').orderByChild('email').equalTo(email).once('value');

                if (!snapshot.exists()) {
                    this.showToast('User not found', 'error');
                    return;
                }

                let userFound = null;
                snapshot.forEach(child => {
                    const user = child.val();
                    if (atob(user.password) === password) {
                        userFound = user;
                    }
                });

                if (!userFound) {
                    this.showToast('Invalid password', 'error');
                    return;
                }

                // Check if user is banned
                const isBanned = await this.checkIfBanned(userFound.userId);
                if (isBanned) {
                    this.showBanModal(isBanned.reason, isBanned.duration ? 'Temporary ban' : 'Permanent ban');
                    return;
                }

                // Update session
                await database.ref('sessions/' + userFound.userId).set({
                    userId: userFound.userId,
                    createdAt: Date.now(),
                    lastActivity: Date.now()
                });

                // Save locally (only for auto-login, balance comes from database)
                localStorage.setItem('moonCasinoUser', JSON.stringify({
                    userId: userFound.userId,
                    username: userFound.username
                }));

                this.userId = userFound.userId;
                this.username = userFound.username;
                this.balance = userFound.balance || 500;
                this.lastFreeCoinsClaim = userFound.lastFreeCoins || 0;
                this.freeCoinsCooldown = userFound.freeCoinsCooldown || 0;

                this.updateUI();
                this.hideAuthModal();
                this.showToast(`Welcome back ${this.username}!`, 'success');
                this.playSound('win');
                this.updateOnlineStatus();
                this.setupRealTimeBalance();
            }

            logout() {
                localStorage.removeItem('moonCasinoUser');
                localStorage.removeItem('lastChatMessages');
                
                // Remove from online users
                if (this.userId) {
                    database.ref('online/' + this.userId).remove();
                }
                
                // Remove session
                if (this.userId) {
                    database.ref('sessions/' + this.userId).remove();
                }
                
                // Clear activity ping
                if (this.activityPingInterval) {
                    clearInterval(this.activityPingInterval);
                    this.activityPingInterval = null;
                }
                
                // Clear user validation
                if (this.userValidationInterval) {
                    clearInterval(this.userValidationInterval);
                    this.userValidationInterval = null;
                }
                
                // Remove balance listener
                if (this.chickenState.balanceUpdateListener) {
                    this.chickenState.balanceUpdateListener();
                    this.chickenState.balanceUpdateListener = null;
                }
                
                this.userId = '';
                this.username = '';
                this.balance = 500;
                this.showAuthModal();
                this.updateUI();
                
                this.showToast('Logged out successfully', 'warning');
            }

            updateUI() {
                document.getElementById('loggedUsername').textContent = this.username || 'Guest';
                document.getElementById('userIdDisplay').textContent = this.userId || 'Not logged in';
                document.getElementById('userAvatar').textContent = this.username ? this.username.charAt(0).toUpperCase() : 'U';
                this.updateBalance();
            }

            async updateOnlineStatus() {
                if (!this.userId || this.maintenanceMode) return;

                // Set user as online with active status
                await database.ref('online/' + this.userId).set({
                    username: this.username,
                    lastSeen: Date.now(),
                    isActive: true
                });

                // Listen for online users with proper tracking
                database.ref('online').on('value', (snapshot) => {
                    const now = Date.now();
                    const activeUsers = [];
                    
                    snapshot.forEach(child => {
                        const user = child.val();
                        // Check if user was active in last 15 seconds
                        if (now - user.lastSeen < 15000 && user.isActive) {
                            activeUsers.push(user);
                        }
                    });
                    
                    this.onlineUsers = activeUsers;
                    
                    // Update display
                    const onlineCount = document.getElementById('onlineCount');
                    if (onlineCount) {
                        onlineCount.textContent = activeUsers.length + ' Online';
                    }
                });
            }

            // Wallet Functions
            openDepositModal() {
                if (!this.checkMaintenance()) return;
                
                if (!this.userId) {
                    this.showToast('Please login first', 'error');
                    return;
                }
                document.getElementById('depositModal').classList.add('active');
                this.updateFreeCoinsButton();
                
                // Update modal balance display
                document.getElementById('modalBalance').textContent = this.balance.toLocaleString();
                this.playSound('click');
            }

            closeDepositModal() {
                document.getElementById('depositModal').classList.remove('active');
                this.playSound('click');
            }

            updateFreeCoinsButton() {
                const claimButton = document.getElementById('claimCoinsBtn');
                const timerElement = document.getElementById('freeCoinsTimer');
                const cooldownElement = document.getElementById('freeCoinsCooldown');

                if (claimButton && timerElement && cooldownElement) {
                    const canClaim = this.balance < 100;
                    const now = Date.now();
                    const cooldownRemaining = this.freeCoinsCooldown - now;
                    
                    if (canClaim && cooldownRemaining <= 0 && !this.maintenanceMode) {
                        timerElement.textContent = 'Ready to Claim';
                        claimButton.disabled = false;
                        claimButton.textContent = 'Claim 500 Coins';
                        claimButton.className = 'w-full btn-primary py-3 rounded-xl font-bold text-sm transition-all duration-300 hover:scale-[1.02] touch-button';
                        cooldownElement.textContent = 'No cooldown';
                        cooldownElement.className = 'text-xs text-gray-500';
                    } else {
                        if (cooldownRemaining > 0) {
                            // Show cooldown timer
                            const minutes = Math.floor(cooldownRemaining / 60000);
                            const seconds = Math.floor((cooldownRemaining % 60000) / 1000);
                            timerElement.textContent = 'Cooldown Active';
                            claimButton.disabled = true;
                            claimButton.textContent = 'Wait ' + minutes + 'm ' + seconds + 's';
                            claimButton.className = 'w-full bg-gray-700 text-gray-400 py-3 rounded-xl font-bold text-sm cursor-not-allowed touch-button';
                            cooldownElement.textContent = `${minutes}m ${seconds}s remaining`;
                            cooldownElement.className = 'text-xs text-yellow-400';
                        } else if (this.maintenanceMode) {
                            timerElement.textContent = 'Disabled (Maintenance)';
                            claimButton.disabled = true;
                            claimButton.textContent = 'Maintenance Mode';
                            claimButton.className = 'w-full bg-gray-700 text-gray-400 py-3 rounded-xl font-bold text-sm cursor-not-allowed touch-button';
                            cooldownElement.textContent = 'Maintenance active';
                            cooldownElement.className = 'text-xs text-red-400';
                        } else {
                            timerElement.textContent = 'Balance too high';
                            claimButton.disabled = true;
                            claimButton.textContent = 'Balance must be under 100';
                            claimButton.className = 'w-full bg-gray-700 text-gray-400 py-3 rounded-xl font-bold text-sm cursor-not-allowed touch-button';
                            cooldownElement.textContent = 'Balance > 100 coins';
                            cooldownElement.className = 'text-xs text-gray-500';
                        }
                    }
                }
            }

            async claimFreeCoins() {
                if (!this.checkMaintenance()) return;
                
                if (!this.userId) return;

                // SECURITY CHECK
                if (!this.validateCurrentUser()) {
                    this.showToast('Security error: Invalid session', 'error');
                    return;
                }

                // Check if balance is under 100
                if (this.balance >= 100) {
                    this.showToast('You must have less than 100 coins to claim', 'error');
                    return;
                }

                // Check cooldown
                const now = Date.now();
                if (this.freeCoinsCooldown > now) {
                    const remaining = this.freeCoinsCooldown - now;
                    const minutes = Math.floor(remaining / 60000);
                    const seconds = Math.floor((remaining % 60000) / 1000);
                    this.showToast(`Please wait ${minutes}m ${seconds}s before claiming again`, 'warning');
                    return;
                }

                this.balance += 500;
                this.lastFreeCoinsClaim = Date.now();
                this.freeCoinsCooldown = Date.now() + (5 * 60 * 1000); // 5 minute cooldown

                // Update in database with transaction
                await database.ref('users/' + this.userId).transaction((currentUser) => {
                    if (currentUser && currentUser.userId === this.userId) {
                        currentUser.balance = this.balance;
                        currentUser.lastFreeCoins = this.lastFreeCoinsClaim;
                        currentUser.freeCoinsCooldown = this.freeCoinsCooldown;
                        return currentUser;
                    }
                    return;
                });

                this.updateBalance();
                this.updateFreeCoinsButton();
                this.showToast('500 free coins claimed! 5-minute cooldown started.', 'success');
                this.playSound('win');

                // Confetti effect
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 }
                });
            }

            // FIXED: Secure money transfer with database transaction and 10% tax
            async sendMoney() {
                if (!this.checkMaintenance()) return;
                
                if (!this.userId) return;
                
                // SECURITY VALIDATION
                if (!this.validateCurrentUser()) {
                    this.showToast('Security alert: Invalid session', 'error');
                    return;
                }
                
                // Check if user is in cooldown after claiming free coins
                const now = Date.now();
                if (this.freeCoinsCooldown > now) {
                    const remaining = this.freeCoinsCooldown - now;
                    const minutes = Math.floor(remaining / 60000);
                    const seconds = Math.floor((remaining % 60000) / 1000);
                    this.showToast(`Cannot send money for ${minutes}m ${seconds}s after claiming free coins`, 'error');
                    return;
                }
                
                const recipientUsername = document.getElementById('sendToUsername').value.trim();
                const amount = parseFloat(document.getElementById('sendAmount').value);

                if (!recipientUsername || !amount) {
                    this.showToast('Please fill all fields', 'error');
                    return;
                }

                if (amount <= 0) {
                    this.showToast('Amount must be positive', 'error');
                    return;
                }

                if (amount > this.balance) {
                    this.showToast('Insufficient funds', 'error');
                    return;
                }

                if (recipientUsername === this.username) {
                    this.showToast('Cannot send money to yourself', 'error');
                    return;
                }

                // Calculate 10% tax
                const tax = Math.floor(amount * 0.10);
                const recipientAmount = amount - tax;

                try {
                    // First, find the recipient user
                    const usersSnapshot = await database.ref('users').orderByChild('username').equalTo(recipientUsername).once('value');
                    
                    if (!usersSnapshot.exists()) {
                        this.showToast('Recipient not found', 'error');
                        return;
                    }
                    
                    let recipientId = null;
                    usersSnapshot.forEach(child => {
                        recipientId = child.key;
                    });
                    
                    if (!recipientId) {
                        this.showToast('Recipient not found', 'error');
                        return;
                    }

                    // Use database transaction to prevent race conditions
                    const updates = {};
                    
                    // Deduct from sender (full amount)
                    const senderNewBalance = this.balance - amount;
                    updates['users/' + this.userId + '/balance'] = senderNewBalance;
                    
                    // Add to recipient (amount minus 10% tax)
                    const recipientSnapshot = await database.ref('users/' + recipientId + '/balance').once('value');
                    const recipientCurrentBalance = recipientSnapshot.val() || 0;
                    updates['users/' + recipientId + '/balance'] = recipientCurrentBalance + recipientAmount;
                    
                    // Perform all updates at once
                    await database.ref().update(updates);
                    
                    // Update local balance
                    this.balance = senderNewBalance;
                    this.updateBalance();
                    
                    // Clear form
                    document.getElementById('sendToUsername').value = '';
                    document.getElementById('sendAmount').value = '';
                    
                    // Add transaction record
                    const transaction = {
                        from: this.username,
                        fromId: this.userId,
                        to: recipientUsername,
                        toId: recipientId,
                        amount: amount,
                        recipientAmount: recipientAmount,
                        tax: tax,
                        timestamp: Date.now(),
                        type: 'transfer'
                    };

                    await database.ref('transactions').push(transaction);
                    
                    // Show success message with tax info
                    this.showToast(`Sent ${amount.toLocaleString()} coins to ${recipientUsername} (${recipientAmount.toLocaleString()} after 10% tax)`, 'success');
                    this.playSound('win');
                    
                    // Add chat message with appropriate styling
                    let messageClass = 'chat-transfer-message';
                    let messageColor = '';
                    
                    if (amount >= 100000) {
                        // Purple alert for 100k+ transfers
                        messageClass += ' purple';
                        messageColor = 'purple';
                        this.showGlobalAlert(`${this.username} sent ${amount.toLocaleString()} coins to ${recipientUsername}!`, 'purple');
                    } else if (amount >= 10000) {
                        // Gold alert for 10k+ transfers
                        messageClass += ' gold';
                        messageColor = 'gold';
                    }
                    
                    // Add chat message with tax info
                    this.addChatMessage('ðŸ’° Money Transfer', 
                        `${this.username} sent ${amount.toLocaleString()} coins to ${recipientUsername}! (${recipientAmount.toLocaleString()} after 10% tax)`, 
                        'text-[#10b981]', true);
                    
                    // Play confetti for large transfers
                    if (amount >= 10000) {
                        confetti({
                            particleCount: Math.min(amount / 100, 500),
                            spread: 70,
                            origin: { y: 0.6 }
                        });
                    }
                    
                } catch (error) {
                    console.error('Money transfer error:', error);
                    this.showToast('Transaction error occurred', 'error');
                }
            }

            // Show global alert bar for 200k+ wins
            showGlobalAlert(message, type = 'purple') {
                if (this.maintenanceMode) return;
                
                const alertBar = document.getElementById('globalAlertBar');
                if (!alertBar) return;
                
                alertBar.className = `global-alert-bar ${type}`;
                alertBar.innerHTML = `
                    <div class="flex items-center justify-center gap-3">
                        <i class="fa-solid ${type === 'purple' ? 'fa-crown' : 'fa-trophy'}"></i>
                        <span>${message}</span>
                        <i class="fa-solid ${type === 'purple' ? 'fa-crown' : 'fa-trophy'}"></i>
                    </div>
                `;
                alertBar.classList.remove('hidden');
                
                // Hide after 5 seconds
                setTimeout(() => {
                    alertBar.classList.add('hidden');
                }, 5000);
            }

            // Chat Functions - Fixed to only load new messages
            initChat() {
                this.chatLoadedAt = Date.now();
                
                // Only listen for NEW messages from now on
                database.ref('chat').orderByChild('timestamp').startAt(this.chatLoadedAt).on('child_added', (snapshot) => {
                    const msg = snapshot.val();
                    if (msg.userId !== this.userId) { // Don't show own messages again
                        this.addChatMessage(msg.username, msg.message, 'text-white', false);
                    }
                });
                
                // Clear existing messages on init
                const messages = document.getElementById('chatMessages');
                if (messages) {
                    messages.innerHTML = '';
                }
            }

            addChatMessage(user, msg, color = 'text-white', saveToDB = true) {
                if (this.maintenanceMode && saveToDB) {
                    // Don't save new chat messages during maintenance
                    saveToDB = false;
                }
                
                const messages = document.getElementById('chatMessages');
                const div = document.createElement('div');
                div.className = `flex gap-2 ${color} text-sm`;
                div.innerHTML = `
                    <span class="font-bold min-w-[70px] truncate">${user}:</span> 
                    <span class="flex-1">${msg}</span>
                `;
                messages.appendChild(div);
                messages.scrollTop = messages.scrollHeight;

                if (saveToDB && this.userId) {
                    database.ref('chat').push({
                        username: user,
                        message: msg,
                        userId: this.userId,
                        timestamp: Date.now()
                    });
                }
            }

            // UPDATED sendChatMessage with chat filter
            sendChatMessage(e) {
                e.preventDefault();
                
                if (this.maintenanceMode) {
                    this.showToast('Chat disabled during maintenance', 'warning');
                    return;
                }
                
                if (!this.userId) {
                    this.showToast('Please login to chat', 'error');
                    return;
                }

                // Check if user is chat banned
                if (this.chatBannedUsers.has(this.userId)) {
                    const ban = this.chatBannedUsers.get(this.userId);
                    const remaining = ban.expiresAt - Date.now();
                    const minutes = Math.floor(remaining / 60000);
                    const seconds = Math.floor((remaining % 60000) / 1000);
                    this.showToast(`You are chat banned for ${minutes}m ${seconds}s`, 'error');
                    return;
                }

                const input = document.getElementById('chatInput');
                if (input && input.value.trim()) {
                    const msg = input.value.trim();
                    
                    // Check message against filter
                    const filterResult = this.checkChatMessage(msg);
                    
                    if (filterResult.banned) {
                        // Apply ban based on type
                        if (filterResult.type === 'account') {
                            this.banUser(this.userId, filterResult.reason, filterResult.banDuration, 'account');
                            this.showToast(`You have been banned: ${filterResult.reason}`, 'error');
                        } else {
                            this.banUser(this.userId, filterResult.reason, filterResult.banDuration, 'chat');
                            this.showToast(`You have been chat banned: ${filterResult.reason}`, 'error');
                            
                            // Disable chat input
                            input.disabled = true;
                            input.placeholder = 'You are chat banned';
                        }
                        
                        // Clear input
                        input.value = '';
                        return;
                    }
                    
                    this.addChatMessage(this.username, msg, 'text-[#8b5cf6]');
                    input.value = '';
                    this.playSound('click');
                }
            }

            addBigWinNotification(username, amount, game) {
                if (this.maintenanceMode) return;
                
                const messages = document.getElementById('chatMessages');
                const div = document.createElement('div');
                
                // Determine notification style based on amount
                let notificationClass = 'big-win-notification';
                if (amount >= 100000) {
                    notificationClass += ' purple';
                }
                
                div.className = notificationClass;
                div.innerHTML = `
                    <div class="flex items-center justify-center gap-2 mb-2">
                        <i class="fa-solid fa-trophy ${amount >= 100000 ? 'text-purple-400' : 'text-yellow-400'} text-sm"></i>
                        <div class="username">${username}</div>
                        <i class="fa-solid fa-trophy ${amount >= 100000 ? 'text-purple-400' : 'text-yellow-400'} text-sm"></i>
                    </div>
                    <div class="amount">${amount.toLocaleString()} coins</div>
                    <div class="text-gray-300 text-xs mt-1">won in ${game}!</div>
                `;
                messages.appendChild(div);
                messages.scrollTop = messages.scrollHeight;
                
                // Show global alert for 200k+ wins
                if (amount >= 200000) {
                    this.showGlobalAlert(`${username} won ${amount.toLocaleString()} coins playing ${game}!`, 'purple');
                }
            }

            // Record Wager for Leaderboard
            async recordWager(amount) {
                if (!this.userId || amount <= 0 || this.maintenanceMode) return;

                const now = Date.now();
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const weekAgo = now - (7 * 24 * 60 * 60 * 1000);

                const userRef = database.ref('users/' + this.userId);
                const snapshot = await userRef.once('value');
                const user = snapshot.val();

                let wageredToday = user.wageredToday || 0;
                let wageredWeek = user.wageredWeek || 0;
                
                // Reset today's wager if it's a new day
                if (user.lastWagered && user.lastWagered < today.getTime()) {
                    wageredToday = 0;
                }

                const updates = {
                    wageredToday: wageredToday + amount,
                    wageredWeek: wageredWeek + amount,
                    wageredLifetime: (user.wageredLifetime || 0) + amount,
                    lastWagered: now
                };

                await userRef.update(updates);
            }

            // Record Win/Loss - UPDATED for special effects
            async recordWin(amount, game) {
                if (!this.userId || amount <= 0 || this.maintenanceMode) return;

                // SECURITY CHECK
                if (!this.validateCurrentUser()) return;

                // Update user stats
                const userRef = database.ref('users/' + this.userId);
                const snapshot = await userRef.once('value');
                const user = snapshot.val();

                const today = new Date();
                today.setHours(0, 0, 0, 0);
                let wonToday = user.wonToday || 0;
                
                // Reset today's win if it's a new day
                if (user.lastWin && user.lastWin < today.getTime()) {
                    wonToday = 0;
                }

                const updates = {
                    totalWins: (user.totalWins || 0) + 1,
                    biggestWin: Math.max(user.biggestWin || 0, amount),
                    wonToday: wonToday + amount,
                    lastWin: Date.now()
                };

                await userRef.update(updates);

                // Record transaction
                const transaction = {
                    userId: this.userId,
                    username: this.username,
                    amount: amount,
                    type: 'win',
                    game: game,
                    timestamp: Date.now()
                };

                await database.ref('transactions').push(transaction);

                // Announce big win in chat with appropriate styling
                if (amount >= this.bigWinThreshold) {
                    this.addBigWinNotification(this.username, amount, game);
                    
                    // Also save as system message
                    const winMessage = `ðŸŽ‰ ${this.username} just won ${amount.toLocaleString()} coins in ${game}! ðŸŽ‰`;
                    const messageColor = amount >= 100000 ? 'text-purple-400' : 'text-yellow-400';
                    this.addChatMessage('System', winMessage, messageColor, true);
                    
                    // Special effects for huge wins
                    if (amount >= 100000) {
                        // Purple confetti for 100k+ wins
                        confetti({
                            particleCount: 300,
                            spread: 100,
                            origin: { y: 0.6 },
                            colors: ['#8b5cf6', '#7c3aed', '#6d28d9', '#5b21b6']
                        });
                        
                        // Show global alert for 200k+ wins
                        if (amount >= 200000) {
                            this.showGlobalAlert(`${this.username} won ${amount.toLocaleString()} coins playing ${game}!`, 'purple');
                        }
                    } else if (amount >= 10000) {
                        // Gold confetti for 10k+ wins
                        confetti({
                            particleCount: 200,
                            spread: 90,
                            origin: { y: 0.6 },
                            colors: ['#f59e0b', '#d97706', '#b45309']
                        });
                    }
                }
            }

            async recordLoss(amount, game) {
                if (!this.userId || amount <= 0 || this.maintenanceMode) return;

                // SECURITY CHECK
                if (!this.validateCurrentUser()) return;

                // Update user stats
                const userRef = database.ref('users/' + this.userId);
                const snapshot = await userRef.once('value');
                const user = snapshot.val();

                const updates = {
                    totalLosses: (user.totalLosses || 0) + 1
                };

                await userRef.update(updates);

                // Record transaction
                const transaction = {
                    userId: this.userId,
                    username: this.username,
                    amount: amount,
                    type: 'loss',
                    game: game,
                    timestamp: Date.now()
                };

                await database.ref('transactions').push(transaction);
            }

            listenForBigWins() {
                // Listen for big wins from other users
                database.ref('transactions').orderByChild('timestamp').startAt(Date.now()).on('child_added', (snapshot) => {
                    const transaction = snapshot.val();
                    
                    // Check if it's a big win from another user
                    if (transaction.type === 'win' && 
                        transaction.amount >= this.bigWinThreshold && 
                        transaction.userId !== this.userId) {
                        
                        // Add to chat with slight delay
                        setTimeout(() => {
                            this.addBigWinNotification(transaction.username, transaction.amount, transaction.game);
                            
                            // Show global alert for 200k+ wins from other users
                            if (transaction.amount >= 200000) {
                                this.showGlobalAlert(`${transaction.username} won ${transaction.amount.toLocaleString()} coins playing ${transaction.game}!`, 'purple');
                            }
                        }, 1000);
                    }
                });
            }

            // Game Loading
            loadGame(gameName) {
                if (!this.checkMaintenance()) return;
                
                if (window.innerWidth < 768 && this.sidebarOpen) {
                    this.toggleSidebar();
                }

                // Update active nav
                document.querySelectorAll('#sidebar button').forEach(b => {
                    b.classList.remove('bg-gradient-to-r', 'from-[#2a3042]', 'to-[#1e293b]', 'text-white');
                });
                const navBtn = document.getElementById(`nav-${gameName}`);
                if (navBtn) {
                    navBtn.classList.add('bg-gradient-to-r', 'from-[#2a3042]', 'to-[#1e293b]', 'text-white');
                }

                this.activeGame = gameName;
                this.mainContent.innerHTML = '';
                this.mainContent.scrollTop = 0;

                switch (gameName) {
                    case 'home':
                        this.renderHome();
                        break;
                    case 'mines':
                        this.renderMines();
                        break;
                    case 'blackjack':
                        this.renderBlackjack();
                        break;
                    case 'chicken':
                        this.renderChickenRoad();
                        break;
                    case 'coinflip':
                        this.renderCoinflip();
                        break;
                    case 'leaderboard':
                        this.renderLeaderboard();
                        break;
                    default:
                        this.renderHome();
                }
                
                this.playSound('click');
            }

            renderHome() {
                this.mainContent.innerHTML = `
                    <div class="max-w-6xl mx-auto space-y-4">
                        <div class="rounded-2xl bg-gradient-to-r from-[#4c1d95] to-[#2e1065] p-4 md:p-6 relative overflow-hidden border border-[#8b5cf6]/30 shadow-xl">
                            <div class="absolute top-0 right-0 w-64 h-64 md:w-96 md:h-96 bg-[#8b5cf6] rounded-full mix-blend-overlay filter blur-[80px] opacity-30"></div>
                            <div class="relative z-10">
                                <div class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/10 border border-white/20 backdrop-blur-md text-xs font-bold text-white mb-3 tracking-wider">
                                    <span class="w-2 h-2 bg-[#10b981] rounded-full animate-pulse"></span> PREMIUM CASINO
                                </div>
                                <h1 class="text-xl md:text-3xl font-bold text-white mb-3 leading-tight">Welcome, <span class="text-[#a78bfa]">${this.username || 'Guest'}</span>!</h1>
                                <p class="text-[#d8b4fe] text-sm md:text-base max-w-2xl mb-4">Experience the ultimate fun casino with fair games, stunning animations, and real-time multiplayer features.</p>
                                <div class="flex flex-wrap gap-3">
                                    <button onclick="app.loadGame('blackjack')" class="btn-primary px-4 md:px-6 py-2.5 md:py-3 rounded-xl font-bold text-base md:text-lg shadow-xl hover:scale-105 transition-all duration-300 touch-button">
                                        <i class="fa-solid fa-diamond mr-2"></i> Play Blackjack
                                    </button>
                                    <button onclick="app.openDepositModal()" class="bg-gradient-to-r from-[#1f2937] to-[#374151] hover:from-[#374151] hover:to-[#4b5563] text-white px-4 md:px-6 py-2.5 md:py-3 rounded-xl font-bold text-base md:text-lg border border-[#374151] transition-all duration-300 hover:scale-105 touch-button">
                                        <i class="fa-solid fa-gift mr-2"></i> Free Coins
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Live Wins Panel -->
                        <div class="live-wins-panel">
                            <div class="flex items-center gap-2 mb-3">
                                <div class="w-2 h-2 bg-[#10b981] rounded-full animate-pulse"></div>
                                <h3 class="text-white font-bold text-base">Live Wins</h3>
                            </div>
                            <div id="liveWinsContainer">
                                <div class="text-center text-gray-500 py-6 text-sm">Loading live wins...</div>
                            </div>
                        </div>
                        
                        <h2 class="text-xl md:text-2xl font-bold text-white flex items-center gap-2">
                            <i class="fa-solid fa-gamepad text-[#8b5cf6]"></i> Featured Games
                        </h2>
                        
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                            ${this.getGameCard('mines', 'Mines', 'fa-bomb', 'from-[#451a03] to-[#2a1205]', 'Reveal gems, avoid bombs', '#f59e0b')}
                            ${this.getGameCard('blackjack', 'Blackjack', 'fa-diamond', 'from-[#064e3b] to-[#022c22]', 'Classic 21 vs Dealer', '#10b981')}
                            ${this.getGameCard('chicken', 'Chicken Road', 'fa-egg', 'from-[#78350f] to-[#451a03]', 'Cross the road to win!', '#f59e0b')}
                            ${this.getGameCard('coinflip', 'Coinflip', 'fa-coins', 'from-[#78350f] to-[#451a03]', 'Heads or Tails!', '#f59e0b')}
                        </div>
                    </div>
                `;
                
                // Start live wins updates
                this.startLiveWinsUpdates();
            }

            startLiveWinsUpdates() {
                // Clear existing interval
                if (this.liveWinsInterval) {
                    clearInterval(this.liveWinsInterval);
                }
                
                // Load initial wins
                this.loadLiveWins();
                
                // Update every 10 seconds
                this.liveWinsInterval = setInterval(() => {
                    this.loadLiveWins();
                }, 10000);
            }

            async loadLiveWins() {
                try {
                    // Get recent wins from transactions
                    const snapshot = await database.ref('transactions')
                        .orderByChild('timestamp')
                        .limitToLast(10)
                        .once('value');
                    
                    const wins = [];
                    snapshot.forEach(child => {
                        const tx = child.val();
                        if (tx.type === 'win' && tx.amount >= 100) { // Show wins over 100 coins
                            wins.push(tx);
                        }
                    });
                    
                    // Reverse to show newest first
                    wins.reverse();
                    
                    const container = document.getElementById('liveWinsContainer');
                    if (!container) return;
                    
                    if (wins.length === 0) {
                        container.innerHTML = '<div class="text-center text-gray-500 py-6 text-sm">No recent wins yet</div>';
                        return;
                    }
                    
                    container.innerHTML = wins.map(win => `
                        <div class="live-win-item">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center gap-2">
                                    <div class="w-6 h-6 rounded-full bg-gradient-to-r from-blue-500 to-teal-400 flex items-center justify-center text-white font-bold text-xs">
                                        ${win.username ? win.username.charAt(0).toUpperCase() : 'U'}
                                    </div>
                                    <div>
                                        <div class="text-white font-bold text-sm">${win.username}</div>
                                        <div class="text-gray-400 text-xs">${this.timeAgo(win.timestamp)}</div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-[#10b981] font-bold text-base">+${win.amount.toLocaleString()}</div>
                                    <div class="text-gray-400 text-xs">${win.game}</div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } catch (error) {
                    console.error('Error loading live wins:', error);
                }
            }

            timeAgo(timestamp) {
                const seconds = Math.floor((Date.now() - timestamp) / 1000);
                
                if (seconds < 60) return 'just now';
                if (seconds < 3600) return Math.floor(seconds / 60) + 'm ago';
                if (seconds < 86400) return Math.floor(seconds / 3600) + 'h ago';
                return Math.floor(seconds / 86400) + 'd ago';
            }

            getGameCard(id, name, icon, gradient, desc, color) {
                return `
                    <div onclick="app.loadGame('${id}')" class="game-card cursor-pointer rounded-xl overflow-hidden group relative h-40 md:h-48">
                        <div class="absolute inset-0 bg-gradient-to-br ${gradient} opacity-90 transition-all duration-500 group-hover:opacity-100"></div>
                        <div class="absolute inset-0 p-4 md:p-6 flex flex-col justify-between z-10">
                            <div class="flex justify-between items-start">
                                <div class="bg-black/30 p-2 md:p-3 rounded-xl backdrop-blur-sm">
                                    <i class="fa-solid ${icon} text-lg md:text-xl text-white"></i>
                                </div>
                                <i class="fa-solid fa-arrow-right text-white/50 -translate-x-2 opacity-0 group-hover:opacity-100 group-hover:translate-x-0 transition-all duration-500 text-sm"></i>
                            </div>
                            <div>
                                <h3 class="text-lg md:text-xl font-bold text-white mb-1">${name}</h3>
                                <p class="text-white/70 text-xs md:text-sm">${desc}</p>
                                <div class="mt-2">
                                    <span class="inline-block px-2 py-1 rounded-full text-xs font-bold" style="background: ${color}20; color: ${color}">PLAY NOW</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // MINES GAME with drag selection
            renderMines() {
                this.mainContent.innerHTML = `
                    <div class="max-w-5xl mx-auto flex flex-col md:flex-row gap-4 md:gap-6 min-h-[500px] items-start game-container">
                        <div class="w-full md:w-64 bg-gradient-to-b from-[#161b26] to-[#11141c] p-4 md:p-6 rounded-xl md:rounded-2xl border border-[#2a3042] shadow-xl sticky top-4 md:top-8">
                            <div class="mb-4 md:mb-6">
                                <label class="text-xs md:text-sm text-[#8b5cf6] font-bold mb-2 block tracking-wider">Bet Amount</label>
                                <div class="flex bg-gradient-to-r from-[#0b0e14] to-[#1e293b] rounded-lg md:rounded-xl border border-[#2a3042] p-1">
                                    <div class="pl-3 py-2 text-[#8b5cf6] font-bold"><i class="fa-solid fa-coins text-sm"></i></div>
                                    <input type="number" id="minesBetInput" value="10" min="1" max="${this.balance}" class="w-full bg-transparent text-white px-3 font-bold text-base md:text-lg outline-none">
                                    <div class="flex pr-1">
                                        <button onclick="document.getElementById('minesBetInput').value = Math.min(${this.balance}, document.getElementById('minesBetInput').value * 2)" class="px-3 text-xs font-bold text-[#8b5cf6] hover:text-white transition-all duration-300 touch-button">2x</button>
                                        <button onclick="document.getElementById('minesBetInput').value = Math.max(1, document.getElementById('minesBetInput').value / 2)" class="px-3 text-xs font-bold text-[#8b5cf6] hover:text-white transition-all duration-300 touch-button">Â½</button>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-4 md:mb-6">
                                <label class="text-xs md:text-sm text-[#8b5cf6] font-bold mb-2 block tracking-wider">Mines Count</label>
                                <div class="grid grid-cols-5 gap-1 md:gap-2">
                                    ${[1,3,5,10,24].map(n => `
                                        <button onclick="app.setMinesCount(${n})" class="bg-gradient-to-r from-[#0b0e14] to-[#1e293b] border border-[#2a3042] text-[#b1bad3] rounded-lg md:rounded-xl py-1.5 md:py-2.5 text-xs md:text-sm font-bold hover:border-[#8b5cf6] hover:text-white transition-all duration-300 ${n===3?'border-[#8b5cf6] text-white shadow-[0_0_15px_rgba(139,92,246,0.3)]':''} touch-button" data-val="${n}">${n}</button>
                                    `).join('')}
                                </div>
                                <input type="hidden" id="minesCountInput" value="3">
                            </div>
                            <div class="bg-gradient-to-r from-[#0b0e14] to-[#1e293b] rounded-lg md:rounded-xl p-3 md:p-4 mb-4 md:mb-6 border border-[#2a3042] flex justify-between items-center">
                                <div>
                                    <div class="text-xs text-[#6b7280] tracking-wider">Next Tile</div>
                                    <div class="text-[#10b981] font-bold text-lg md:text-xl" id="minesNextMult">1.13x</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-xs text-[#6b7280] tracking-wider">Profit</div>
                                    <div class="text-white font-bold text-lg md:text-xl" id="minesProfit">0</div>
                                </div>
                            </div>
                            <button id="minesBtn" onclick="app.playMines()" class="w-full btn-primary py-3 rounded-xl md:rounded-2xl font-bold text-sm md:text-base tracking-wider hover:scale-[1.02] transition-all duration-300 touch-button">
                                <i class="fa-solid fa-play mr-1"></i> Start Game
                            </button>
                        </div>
                        <div class="flex-1 w-full bg-gradient-to-b from-[#161b26] to-[#11141c] rounded-xl md:rounded-2xl p-4 md:p-6 border border-[#2a3042] shadow-xl flex items-center justify-center relative overflow-hidden">
                            <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-[#8b5cf6] via-[#10b981] to-[#8b5cf6] animate-shimmer"></div>
                            <div class="mines-grid-container" id="minesGrid">
                                ${Array(25).fill(0).map((_,i)=>`
                                    <div id="tile-${i}" 
                                         onmousedown="app.startMinesDrag(${i}, event)" 
                                         onmouseenter="app.handleMinesDrag(${i})" 
                                         onmouseup="app.stopMinesDrag()"
                                         ontouchstart="app.startMinesDrag(${i}, event)"
                                         ontouchmove="app.handleMinesTouchMove(event)"
                                         ontouchend="app.stopMinesDrag()"
                                         class="mine-tile-modern touch-button"></div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
                this.minesActive = false;
                this.minesDragging = false;
                this.minesSelectedTiles.clear();
                this.setMinesCount(3);
            }

            setMinesCount(n) {
                if (this.minesActive) return;
                document.getElementById('minesCountInput').value = n;
                document.querySelectorAll('[data-val]').forEach(b => {
                    b.classList.remove('border-[#8b5cf6]', 'text-white', 'shadow-[0_0_20px_rgba(139,92,246,0.3)]');
                    if (parseInt(b.dataset.val) === n) {
                        b.classList.add('border-[#8b5cf6]', 'text-white', 'shadow-[0_0_20px_rgba(139,92,246,0.3)]');
                    }
                });
                this.updateMinesNextMult();
                this.playSound('click');
            }

            updateMinesNextMult() {
                if (!this.minesActive) {
                    const m = parseInt(document.getElementById('minesCountInput').value);
                    const mult = this.calculateMinesMultiplier(m, 1);
                    document.getElementById('minesNextMult').textContent = mult.toFixed(2) + 'x';
                    return;
                }
                const m = this.minesCount;
                const r = this.minesRevealedCount + 1;
                const mult = this.calculateMinesMultiplier(m, r);
                document.getElementById('minesNextMult').textContent = mult.toFixed(2) + 'x';
            }

            calculateMinesMultiplier(mines, revealed) {
                let multiplier = 1.0;
                for (let i = 0; i < revealed; i++) multiplier *= (25 - i) / (25 - mines - i);
                return multiplier;
            }

            // Mines drag selection functions
            startMinesDrag(tileId, event) {
                if (!this.minesActive || this.minesDragging) return;
                event.preventDefault();
                
                this.minesDragging = true;
                this.minesDragStartTile = tileId;
                this.minesSelectedTiles.clear();
                this.handleTileSelection(tileId);
            }

            handleMinesDrag(tileId) {
                if (!this.minesActive || !this.minesDragging) return;
                this.handleTileSelection(tileId);
            }

            handleMinesTouchMove(event) {
                if (!this.minesActive || !this.minesDragging) return;
                event.preventDefault();
                
                const touch = event.touches[0];
                const element = document.elementFromPoint(touch.clientX, touch.clientY);
                if (element && element.id && element.id.startsWith('tile-')) {
                    const tileId = parseInt(element.id.split('-')[1]);
                    this.handleTileSelection(tileId);
                }
            }

            handleTileSelection(tileId) {
                if (!this.minesActive || this.minesSelectedTiles.has(tileId)) return;
                
                const tile = document.getElementById(`tile-${tileId}`);
                if (!tile || tile.classList.contains('revealed')) return;
                
                // Add hover effect
                tile.classList.add('hover-effect');
                this.minesSelectedTiles.add(tileId);
                
                // Automatically click after a short delay if dragging stopped
                setTimeout(() => {
                    if (!this.minesDragging && this.minesSelectedTiles.has(tileId)) {
                        this.clickMineTile(tileId);
                        this.minesSelectedTiles.delete(tileId);
                    }
                }, 50);
            }

            stopMinesDrag() {
                if (!this.minesActive) return;
                
                this.minesDragging = false;
                
                // Process all selected tiles
                this.minesSelectedTiles.forEach(tileId => {
                    setTimeout(() => {
                        this.clickMineTile(tileId);
                    }, 10);
                });
                
                this.minesSelectedTiles.clear();
                this.minesDragStartTile = null;
            }

            playMines() {
                if (!this.checkMaintenance()) return;
                
                if (!this.userId) {
                    this.showToast('Please login to play', 'error');
                    return;
                }

                if (this.minesActive) {
                    this.cashOutMines();
                    return;
                }

                const betInput = document.getElementById('minesBetInput');
                const bet = parseFloat(betInput.value);
                const mines = parseInt(document.getElementById('minesCountInput').value);

                if (isNaN(bet) || bet <= 0) return;
                if (bet > this.balance) {
                    this.showToast('Insufficient funds', 'error');
                    return;
                }

                this.playSound('click');
                this.balance -= bet;
                this.updateBalance();
                this.recordWager(bet);

                this.minesBet = bet;
                this.minesCount = mines;
                this.minesActive = true;
                this.minesRevealedCount = 0;
                this.minesGrid = Array(25).fill('safe');

                let placed = 0;
                while (placed < mines) {
                    const idx = Math.floor(Math.random() * 25);
                    if (this.minesGrid[idx] === 'safe') {
                        this.minesGrid[idx] = 'mine';
                        placed++;
                    }
                }

                const btn = document.getElementById('minesBtn');
                btn.innerHTML = '<i class="fa-solid fa-money-bill-wave mr-1"></i> Cash Out <span id="minesCashoutVal" class="ml-1 bg-white/20 px-2 py-0.5 rounded text-xs">0</span>';
                btn.className = 'w-full bg-gradient-to-r from-[#10b981] to-[#059669] text-white py-3 rounded-xl md:rounded-2xl font-bold text-sm md:text-base tracking-wider hover:scale-[1.02] transition-all duration-300 touch-button';

                document.querySelectorAll('.mine-tile-modern').forEach(el => {
                    el.className = 'mine-tile-modern';
                    el.innerHTML = '';
                });

                this.updateMinesNextMult();
                document.getElementById('minesProfit').textContent = '0';
            }

            clickMineTile(idx) {
                if (!this.minesActive) return;
                const tile = document.getElementById(`tile-${idx}`);
                if (tile.classList.contains('revealed')) return;

                tile.classList.add('revealed');
                tile.classList.remove('hover-effect');

                if (this.minesGrid[idx] === 'mine') {
                    tile.classList.add('mine');
                    tile.innerHTML = '<i class="fa-solid fa-bomb text-white text-2xl md:text-3xl animate-bounce"></i>';
                    this.playSound('mine');
                    this.recordLoss(this.minesBet, 'Mines');
                    this.endMines(false, idx);
                } else {
                    tile.classList.add('gem');
                    tile.innerHTML = '<i class="fa-solid fa-gem text-[#10b981] text-xl md:text-2xl animate-pulse"></i>';
                    this.playSound('gem');
                    this.minesRevealedCount++;

                    const currentMult = this.calculateMinesMultiplier(this.minesCount, this.minesRevealedCount);
                    const currentWin = this.minesBet * currentMult;
                    document.getElementById('minesProfit').textContent = `${(currentWin - this.minesBet).toFixed(2)}`;

                    const cv = document.getElementById('minesCashoutVal');
                    if (cv) cv.textContent = `${currentWin.toFixed(2)}`;

                    this.updateMinesNextMult();

                    if (this.minesRevealedCount === (25 - this.minesCount)) {
                        this.cashOutMines();
                    }
                }
            }

            endMines(win, hitIdx) {
                this.minesActive = false;
                this.minesDragging = false;
                this.minesSelectedTiles.clear();
                
                const btn = document.getElementById('minesBtn');
                if (btn) {
                    btn.innerHTML = '<i class="fa-solid fa-play mr-1"></i> Start Game';
                    btn.className = 'w-full btn-primary py-3 rounded-xl md:rounded-2xl font-bold text-sm md:text-base tracking-wider hover:scale-[1.02] transition-all duration-300 touch-button';
                }

                this.minesGrid.forEach((type, idx) => {
                    const tile = document.getElementById(`tile-${idx}`);
                    if (!tile.classList.contains('revealed')) {
                        tile.classList.add('revealed');
                        if (type === 'mine') {
                            tile.innerHTML = '<i class="fa-solid fa-bomb text-white text-sm md:text-lg opacity-30"></i>';
                            tile.classList.add('mine-hidden');
                        } else {
                            tile.innerHTML = '<i class="fa-solid fa-gem text-white/10 text-sm md:text-lg"></i>';
                            tile.classList.add('safe-hidden');
                        }
                    }
                });

                if (!win) {
                    this.showToast('Boom! You hit a mine!', 'error');
                }
            }

            cashOutMines() {
                const mult = this.calculateMinesMultiplier(this.minesCount, this.minesRevealedCount);
                const win = this.minesBet * mult;
                this.balance += win;
                this.updateBalance();
                this.playSound('win');
                this.showToast(`Cashed out ${win.toFixed(2)} coins! (${mult.toFixed(2)}x)`, 'success');
                this.recordWin(win - this.minesBet, 'Mines');
                this.endMines(true, -1);
            }

            // BLACKJACK GAME - FIXED UI
            renderBlackjack() {
                this.bjInProgress = false;
                this.bjSettled = false;
                this.bjStandCalled = false;
                this.bjDeck = [];
                this.bjPlayerHand = [];
                this.bjDealerHand = [];

                this.mainContent.innerHTML = `
                    <div class="max-w-6xl mx-auto flex flex-col gap-4">
                        <div class="text-center mb-2">
                            <h2 class="text-2xl md:text-3xl font-bold text-white mb-1">Blackjack</h2>
                            <p class="text-gray-400 text-sm">Beat the dealer without going over 21</p>
                        </div>
                        
                        <div class="blackjack-table">
                            <!-- Dealer Section -->
                            <div class="w-full mb-4 md:mb-6">
                                <div class="flex items-center justify-center gap-2 mb-3">
                                    <i class="fa-solid fa-user-tie text-lg md:text-xl text-[#a7f3d0]"></i>
                                    <div class="text-[#a7f3d0] font-bold tracking-wider text-sm md:text-base">Dealer</div>
                                    <div class="bg-black/40 px-3 py-1.5 md:px-4 md:py-2 rounded-full text-white font-bold text-base md:text-lg" id="dealerScore">0</div>
                                </div>
                                <div id="dealerHand" class="hand-container"></div>
                            </div>
                            
                            <!-- Game Status -->
                            <div id="bjStatus" class="text-center my-3">
                                <div class="status-text text-white" id="bjGameStatus">Place your bet and deal!</div>
                            </div>
                            
                            <!-- Player Section -->
                            <div class="w-full mt-4 md:mt-6">
                                <div id="playerHand" class="hand-container mb-3"></div>
                                <div class="flex items-center justify-center gap-2">
                                    <i class="fa-solid fa-user text-lg md:text-xl text-[#a7f3d0]"></i>
                                    <div class="text-[#a7f3d0] font-bold tracking-wider text-sm md:text-base">You</div>
                                    <div class="bg-black/40 px-3 py-1.5 md:px-4 md:py-2 rounded-full text-white font-bold text-base md:text-lg" id="playerScore">0</div>
                                </div>
                            </div>
                            
                            <!-- Game Overlay -->
                            <div id="bjOverlay" class="absolute inset-0 bg-black/80 backdrop-blur-sm hidden z-20 flex-col items-center justify-center rounded-xl md:rounded-2xl">
                                <div id="bjMessage" class="text-2xl md:text-3xl font-black text-white mb-3 text-center"></div>
                                <div id="bjPayout" class="text-lg md:text-xl font-bold text-yellow-300 mb-4"></div>
                                <button onclick="app.resetBlackjackUI()" class="px-6 py-2.5 md:px-8 md:py-3 bg-gradient-to-r from-emerald-500 to-green-600 text-white text-base md:text-lg rounded-xl md:rounded-2xl font-bold shadow-xl hover:scale-110 transition-all duration-300 touch-button">
                                    <i class="fa-solid fa-rotate-right mr-2"></i> Play Again
                                </button>
                            </div>
                        </div>
                        
                        <!-- Game Controls -->
                        <div class="game-controls">
                            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                                <div class="flex items-center gap-3 bg-gradient-to-r from-[#0b0e14] to-[#1e293b] px-4 py-2.5 rounded-xl border border-[#2a3042]">
                                    <span class="text-gray-400 font-bold text-xs tracking-wider">BET</span>
                                    <input type="number" id="bjBetInput" value="50" min="1" max="${this.balance}" class="bg-transparent text-white font-bold text-lg w-24 outline-none text-center">
                                    <div class="flex gap-1">
                                        <button onclick="app.adjustBjBet(0.5)" class="text-xs text-[#8b5cf6] font-bold hover:text-white transition-all duration-300 hover:scale-110 touch-button">Â½</button>
                                        <button onclick="app.adjustBjBet(2)" class="text-xs text-[#8b5cf6] font-bold hover:text-white transition-all duration-300 hover:scale-110 touch-button">2x</button>
                                    </div>
                                </div>
                                
                                <div class="flex gap-2">
                                    <button id="btnDeal" onclick="app.bjDeal()" class="px-6 py-2.5 md:px-8 md:py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white font-black text-base md:text-lg rounded-xl md:rounded-2xl shadow-xl hover:scale-105 transition-all duration-300 touch-button">
                                        <i class="fa-solid fa-play mr-2"></i> DEAL CARDS
                                    </button>
                                    <div id="bjActions" class="hidden flex gap-2">
                                        <button id="btnHit" onclick="app.bjHit()" class="px-4 py-2.5 md:px-6 md:py-3 bg-gradient-to-r from-gray-700 to-gray-800 text-white font-bold text-base md:text-lg rounded-xl md:rounded-2xl shadow-lg hover:scale-105 transition-all duration-300 touch-button">
                                            <i class="fa-solid fa-plus mr-1"></i> HIT
                                        </button>
                                        <button id="btnStand" onclick="app.bjStand()" class="px-4 py-2.5 md:px-6 md:py-3 bg-gradient-to-r from-emerald-600 to-green-700 text-white font-black text-base md:text-lg rounded-xl md:rounded-2xl shadow-lg hover:scale-105 transition-all duration-300 touch-button">
                                            <i class="fa-solid fa-hand mr-1"></i> STAND
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            adjustBjBet(multiplier) {
                if (this.maintenanceMode) return;
                
                const betInput = document.getElementById('bjBetInput');
                const currentBet = parseFloat(betInput.value) || 50;
                let newBet = currentBet * multiplier;
                
                // Round to nearest whole number
                newBet = Math.round(newBet);
                
                // Ensure within limits
                newBet = Math.max(1, Math.min(newBet, this.balance));
                
                betInput.value = newBet;
                this.playSound('click');
            }

            bjDeal() {
                if (!this.checkMaintenance()) return;
                
                if (!this.userId) {
                    this.showToast('Please login to play', 'error');
                    return;
                }

                if (this.bjInProgress) return;

                const betInput = document.getElementById('bjBetInput');
                const bet = parseFloat(betInput.value);

                if (isNaN(bet) || bet <= 0) return;
                if (bet > this.balance) {
                    this.showToast('Insufficient funds', 'error');
                    return;
                }

                this.playSound('click');
                this.balance -= bet;
                this.updateBalance();
                this.recordWager(bet);
                this.bjBet = bet;

                // Create and shuffle deck
                const suits = ['â™ ', 'â™¥', 'â™¦', 'â™£'];
                const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
                let deck = [];

                for (let s of suits) {
                    for (let v of values) {
                        deck.push({
                            suit: s,
                            value: v,
                            color: (s === 'â™¥' || s === 'â™¦') ? 'text-red-500' : 'text-black'
                        });
                    }
                }

                // Shuffle deck
                for (let i = deck.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [deck[i], deck[j]] = [deck[j], deck[i]];
                }

                this.bjDeck = deck;
                this.bjPlayerHand = [];
                this.bjDealerHand = [];

                // Clear hands
                document.getElementById('dealerHand').innerHTML = '';
                document.getElementById('playerHand').innerHTML = '';
                document.getElementById('dealerScore').textContent = '0';
                document.getElementById('playerScore').textContent = '0';
                document.getElementById('bjGameStatus').textContent = 'Place your bet and deal!';

                // Update UI
                document.getElementById('btnDeal').classList.add('hidden');
                document.getElementById('bjActions').classList.remove('hidden');
                document.getElementById('bjActions').classList.add('flex');
                betInput.disabled = true;

                this.bjInProgress = true;
                this.bjSettled = false;
                this.bjStandCalled = false;

                // Deal initial cards with animation delays
                setTimeout(() => {
                    this.bjDealCardToPlayer();
                    this.playSound('card');
                }, 0);

                setTimeout(() => {
                    this.bjDealCardToDealer(true); // First dealer card face down
                    this.playSound('card');
                }, 400);

                setTimeout(() => {
                    this.bjDealCardToPlayer();
                    this.playSound('card');
                }, 800);

                setTimeout(() => {
                    this.bjDealCardToDealer(false); // Second dealer card face up
                    this.playSound('card');
                    
                    // Update scores after all cards are dealt
                    setTimeout(() => {
                        this.bjUpdateScores(true);
                        
                        // Check for blackjack
                        if (this.bjCalculateScore(this.bjPlayerHand) === 21) {
                            this.bjStand();
                        }
                    }, 300);
                }, 1200);
            }

            bjDealCardToPlayer(faceUp = true) {
                if (this.bjDeck.length === 0) return;
                
                const card = this.bjDeck.pop();
                this.bjPlayerHand.push(card);
                
                const handElement = document.getElementById('playerHand');
                const cardElement = this.createCardElement(card, faceUp);
                cardElement.style.animation = 'card-deal 0.5s ease-out forwards';
                handElement.appendChild(cardElement);
            }

            bjDealCardToDealer(faceDown = false) {
                if (this.bjDeck.length === 0) return;
                
                const card = this.bjDeck.pop();
                this.bjDealerHand.push(card);
                
                const handElement = document.getElementById('dealerHand');
                const cardElement = this.createCardElement(card, !faceDown);
                if (faceDown) {
                    cardElement.querySelector('.game-card-item').classList.add('flipped');
                    cardElement.id = 'dealerHiddenCard';
                }
                cardElement.style.animation = 'card-deal 0.5s ease-out forwards';
                handElement.appendChild(cardElement);
            }

            createCardElement(card, faceUp = true) {
                const container = document.createElement('div');
                container.className = 'card-container';
                
                const cardItem = document.createElement('div');
                cardItem.className = `game-card-item ${!faceUp ? 'flipped' : ''}`;
                
                const cardFace = document.createElement('div');
                cardFace.className = 'card-face';
                cardFace.innerHTML = `
                    <div class="text-sm md:text-lg font-bold leading-none ${card.color}">${card.value}<br><span class="text-xs">${card.suit}</span></div>
                    <div class="card-value ${card.color} text-3xl md:text-5xl">${card.suit}</div>
                    <div class="text-sm md:text-lg font-bold leading-none ${card.color} rotate-180">${card.value}<br><span class="text-xs">${card.suit}</span></div>
                `;
                
                const cardBack = document.createElement('div');
                cardBack.className = 'card-back';
                
                cardItem.appendChild(cardFace);
                cardItem.appendChild(cardBack);
                container.appendChild(cardItem);
                
                return container;
            }

            bjCalculateScore(hand) {
                let score = 0;
                let aces = 0;

                hand.forEach(card => {
                    if (['J', 'Q', 'K'].includes(card.value)) {
                        score += 10;
                    } else if (card.value === 'A') {
                        score += 11;
                        aces++;
                    } else {
                        score += parseInt(card.value);
                    }
                });

                // Adjust for aces if over 21
                while (score > 21 && aces > 0) {
                    score -= 10;
                    aces--;
                }

                return score;
            }

            bjUpdateScores(hideDealerScore = false) {
                const playerScore = this.bjCalculateScore(this.bjPlayerHand);
                document.getElementById('playerScore').textContent = playerScore;

                if (hideDealerScore && this.bjDealerHand.length > 0) {
                    // Only show first card's value for dealer
                    const firstCard = this.bjDealerHand[0];
                    let dealerVisibleScore = 0;
                    
                    if (['J', 'Q', 'K'].includes(firstCard.value)) {
                        dealerVisibleScore = 10;
                    } else if (firstCard.value === 'A') {
                        dealerVisibleScore = 11;
                    } else {
                        dealerVisibleScore = parseInt(firstCard.value);
                    }
                    
                    document.getElementById('dealerScore').textContent = dealerVisibleScore;
                } else {
                    const dealerScore = this.bjCalculateScore(this.bjDealerHand);
                    document.getElementById('dealerScore').textContent = dealerScore;
                }
            }

            bjHit() {
                if (!this.bjInProgress || this.bjSettled || this.bjStandCalled) return;

                this.playSound('card');
                this.bjDealCardToPlayer();
                
                setTimeout(() => {
                    this.bjUpdateScores(true);
                    const playerScore = this.bjCalculateScore(this.bjPlayerHand);
                    
                    if (playerScore > 21) {
                        this.bjEnd('BUSTED', 'loss');
                    }
                }, 300);
            }

            bjStand() {
                if (!this.bjInProgress || this.bjSettled || this.bjStandCalled) return;

                this.bjStandCalled = true;
                document.getElementById('bjActions').classList.add('hidden');
                document.getElementById('bjActions').classList.remove('flex');

                // Reveal dealer's hidden card
                const hiddenCard = document.getElementById('dealerHiddenCard');
                if (hiddenCard) {
                    setTimeout(() => {
                        hiddenCard.querySelector('.game-card-item').classList.remove('flipped');
                        this.playSound('card');
                        this.bjUpdateScores(false);
                        this.bjDealerPlay();
                    }, 500);
                }
            }

            bjDealerPlay() {
                const dealerScore = this.bjCalculateScore(this.bjDealerHand);
                
                if (dealerScore >= 17) {
                    setTimeout(() => {
                        this.bjDetermineWinner();
                    }, 1000);
                } else {
                    // Dealer hits
                    setTimeout(() => {
                        this.bjDealCardToDealer(false);
                        this.playSound('card');
                        
                        setTimeout(() => {
                            this.bjUpdateScores(false);
                            this.bjDealerPlay();
                        }, 500);
                    }, 1000);
                }
            }

            bjDetermineWinner() {
                const playerScore = this.bjCalculateScore(this.bjPlayerHand);
                const dealerScore = this.bjCalculateScore(this.bjDealerHand);

                if (playerScore > 21) {
                    this.bjEnd('BUSTED', 'loss');
                } else if (dealerScore > 21) {
                    this.bjEnd('DEALER BUSTED', 'win');
                } else if (playerScore > dealerScore) {
                    this.bjEnd('YOU WIN', 'win');
                } else if (playerScore < dealerScore) {
                    this.bjEnd('DEALER WINS', 'loss');
                } else {
                    this.bjEnd('PUSH', 'push');
                }
            }

            bjEnd(message, result) {
                this.bjSettled = true;
                this.bjInProgress = false;

                const overlay = document.getElementById('bjOverlay');
                const messageEl = document.getElementById('bjMessage');
                const payoutEl = document.getElementById('bjPayout');

                setTimeout(() => {
                    overlay.classList.remove('hidden');
                    overlay.classList.add('flex');
                    
                    if (messageEl) {
                        messageEl.textContent = message;
                        
                        switch(result) {
                            case 'win':
                                messageEl.style.color = '#10b981';
                                break;
                            case 'loss':
                                messageEl.style.color = '#ef4444';
                                break;
                            case 'push':
                                messageEl.style.color = '#f59e0b';
                                break;
                        }
                    }

                    let winAmount = 0;
                    
                    switch(result) {
                        case 'win':
                            winAmount = this.bjBet * 2;
                            this.balance += winAmount;
                            this.updateBalance();
                            this.recordWin(this.bjBet, 'Blackjack');
                            if (payoutEl) {
                                payoutEl.textContent = `+${winAmount} coins`;
                                payoutEl.style.color = '#10b981';
                            }
                            this.playSound('win');
                            
                            // Special effects for big wins
                            if (this.bjBet >= 100000) {
                                // Purple confetti for 100k+ wins
                                confetti({
                                    particleCount: 300,
                                    spread: 100,
                                    origin: { y: 0.6 },
                                    colors: ['#8b5cf6', '#7c3aed', '#6d28d9', '#5b21b6']
                                });
                                
                                // Show global alert for 200k+ wins
                                if (this.bjBet >= 200000) {
                                    this.showGlobalAlert(`${this.username} won ${winAmount.toLocaleString()} coins playing Blackjack!`, 'purple');
                                }
                            } else if (this.bjBet >= 10000) {
                                // Gold confetti for 10k+ wins
                                confetti({
                                    particleCount: 200,
                                    spread: 90,
                                    origin: { y: 0.6 },
                                    colors: ['#f59e0b', '#d97706', '#b45309']
                                });
                            }
                            break;
                            
                        case 'push':
                            winAmount = this.bjBet;
                            this.balance += winAmount;
                            this.updateBalance();
                            if (payoutEl) {
                                payoutEl.textContent = 'Bet returned';
                                payoutEl.style.color = '#f59e0b';
                            }
                            break;
                            
                        case 'loss':
                            this.recordLoss(this.bjBet, 'Blackjack');
                            if (payoutEl) {
                                payoutEl.textContent = `-${this.bjBet} coins`;
                                payoutEl.style.color = '#ef4444';
                            }
                            this.playSound('lose');
                            break;
                    }

                    document.getElementById('bjGameStatus').textContent = message;
                }, 1000);
            }

            resetBlackjackUI() {
                const overlay = document.getElementById('bjOverlay');
                overlay.classList.add('hidden');
                overlay.classList.remove('flex');

                document.getElementById('dealerHand').innerHTML = '';
                document.getElementById('playerHand').innerHTML = '';
                document.getElementById('dealerScore').textContent = '0';
                document.getElementById('playerScore').textContent = '0';
                document.getElementById('bjGameStatus').textContent = 'Place your bet and deal!';

                document.getElementById('btnDeal').classList.remove('hidden');
                document.getElementById('bjActions').classList.add('hidden');
                document.getElementById('bjActions').classList.remove('flex');

                const betInput = document.getElementById('bjBetInput');
                betInput.disabled = false;

                this.bjInProgress = false;
                this.bjSettled = false;
                this.bjStandCalled = false;
                this.playSound('click');
            }

            // CHICKEN ROAD GAME - UPDATED WITH LOWER WIN CHANCES
            renderChickenRoad() {
                this.chickenState.isPlaying = false;
                this.chickenState.currentStep = -1;
                this.chickenState.currentMultiplier = 1.00;

                this.mainContent.innerHTML = `
                    <div class="chicken-road-main">
                        <!-- Main Game Area -->
                        <div class="chicken-game-area">
                            <!-- Controls Sidebar -->
                            <div class="chicken-controls-sidebar">
                                <div class="chicken-controls-header">
                                    <div class="emoji">ðŸ”</div>
                                    <h2>CHICKEN ROAD</h2>
                                </div>

                                <!-- Bet Amount -->
                                <div class="chicken-control-group">
                                    <div class="flex justify-between">
                                        <label class="chicken-control-label">Bet Amount</label>
                                        <span class="text-xs text-[#b1bad3]">Max: ${this.balance.toLocaleString()}</span>
                                    </div>
                                    <div class="chicken-input-group">
                                        <input type="number" id="chickenBetInput" value="10" min="1" max="${this.balance}" class="chicken-bet-input">
                                        <div class="icon">ðŸ’°</div>
                                    </div>
                                    <div class="chicken-quick-buttons">
                                        <button class="chicken-quick-button" onclick="app.adjustChickenBet(0.5)">1/2</button>
                                        <button class="chicken-quick-button" onclick="app.adjustChickenBet(2)">2x</button>
                                    </div>
                                </div>

                                <!-- Difficulty -->
                                <div class="chicken-control-group">
                                    <label class="chicken-control-label">Difficulty</label>
                                    <select id="chickenDifficulty" class="chicken-select" onchange="app.updateChickenDifficulty()">
                                        <option value="easy">Easy (Low Risk)</option>
                                        <option value="medium">Medium</option>
                                        <option value="hard">Hard</option>
                                        <option value="expert">Expert (High Risk)</option>
                                    </select>
                                </div>

                                <!-- Stats Display -->
                                <div class="chicken-stats-box">
                                    <div class="chicken-stats-grid">
                                        <div>
                                            <div class="chicken-stat-label">Current Multiplier</div>
                                            <div class="chicken-stat-value text-[#8b5cf6]" id="chickenCurrentMult">1.00x</div>
                                        </div>
                                        <div>
                                            <div class="chicken-stat-label">Current Payout</div>
                                            <div class="chicken-stat-value text-[#10b981]" id="chickenCurrentPayout">0</div>
                                        </div>
                                    </div>
                                    <div class="chicken-stats-grid mt-3">
                                        <div>
                                            <div class="chicken-stat-label">Next Multiplier</div>
                                            <div class="chicken-stat-value text-[#8b5cf6]" id="chickenNextMult">1.02x</div>
                                        </div>
                                        <div>
                                            <div class="chicken-stat-label">Steps Remaining</div>
                                            <div class="chicken-stat-value text-white" id="chickenStepsRemaining">30</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Balance Display -->
                                <div class="chicken-control-group mt-2">
                                    <div class="flex items-center justify-between bg-gradient-to-r from-[#1e293b] to-[#0f172a] rounded-lg p-3 border border-[#2a3042]">
                                        <div class="flex items-center gap-2">
                                            <i class="fa-solid fa-wallet text-[#8b5cf6] text-sm"></i>
                                            <span class="text-[#b1bad3] font-bold text-sm">Balance</span>
                                        </div>
                                        <span class="text-white font-bold text-lg" id="chickenBalanceDisplay">${this.balance.toLocaleString()}</span>
                                    </div>
                                </div>

                                <!-- Main Action Button -->
                                <div class="chicken-main-action">
                                    <button id="chickenActionBtn" onclick="app.handleChickenAction()" class="chicken-action-button">
                                        <i class="fa-solid fa-play mr-1"></i> Start Game
                                    </button>
                                    <div class="chicken-game-info">
                                        <p>Cross the road to win! Click on lanes to hop.</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Road Container -->
                            <div class="chicken-road-container">
                                <!-- Camera Container -->
                                <div class="chicken-road-camera-container">
                                    <div id="chickenRoadCamera" class="chicken-road-camera">
                                        <!-- World Container -->
                                        <div id="chickenWorldContainer" class="chicken-world-container">
                                            <!-- Top Environment -->
                                            <div class="chicken-env-top" id="chickenEnvTop"></div>
                                            
                                            <!-- Road Area -->
                                            <div class="chicken-road-area">
                                                <!-- Road Borders -->
                                                <div class="road-border-top"></div>
                                                <div class="road-border-bottom"></div>
                                                
                                                <!-- Start Sidewalk -->
                                                <div class="chicken-sidewalk-start" id="chickenSidewalkStart">
                                                    <div class="text-5xl">ðŸ”</div>
                                                    <div class="text-white font-black text-2xl text-center drop-shadow-md">START</div>
                                                </div>
                                                
                                                <!-- Lanes Container -->
                                                <div id="chickenRoadContainer" class="chicken-road-lanes"></div>
                                                
                                                <!-- End Sidewalk -->
                                                <div class="chicken-sidewalk-end" id="chickenSidewalkEnd">
                                                    <div class="text-6xl drop-shadow-xl">ðŸŽ¯</div>
                                                    <div class="text-white font-black text-3xl text-center drop-shadow-md">GOAL</div>
                                                </div>
                                            </div>
                                            
                                            <!-- Bottom Environment -->
                                            <div class="chicken-env-bottom" id="chickenEnvBottom"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                // Initialize game
                this.updateChickenUI();
                this.updateChickenDifficulty();
                this.renderChickenEnvironment();
                this.renderChickenRoadLanes();
                // Set initial camera position
                setTimeout(() => this.updateChickenCamera(), 100);
            }

            renderChickenEnvironment() {
                // Generate environment props
                this.generateEnvironment('chickenEnvTop', 40, 'top');
                this.generateEnvironment('chickenEnvBottom', 40, 'bottom');
                this.generateSidewalkProps('chickenSidewalkStart');
                this.generateSidewalkProps('chickenSidewalkEnd');
            }

            generateEnvironment(containerId, count, align = 'bottom') {
                const container = document.getElementById(containerId);
                if (!container) return;
                
                const trees = ['ðŸŒ³', 'ðŸŒ²', 'ðŸŒµ', 'ðŸŒ´'];
                const rocks = ['ðŸª¨', 'ðŸ—¿'];
                const flowers = ['ðŸŒ·', 'ðŸŒ»', 'ðŸŒ¹', 'ðŸŒ¼'];
                
                container.innerHTML = '';
                
                // Generate Ponds
                const pondCount = Math.floor(Math.random() * 5) + 3;
                
                for(let i=0; i<pondCount; i++) {
                    const pond = document.createElement('div');
                    pond.className = 'pond';
                    const size = Math.random() * 60 + 40;
                    pond.style.width = `${size}px`;
                    pond.style.height = `${size * 0.6}px`;
                    pond.style.left = `${Math.random() * 100}%`;
                    if(align === 'bottom') pond.style.top = `${Math.random() * 20}px`;
                    else pond.style.bottom = `${Math.random() * 20}px`;
                    container.appendChild(pond);
                }

                // Generate Props
                for(let i=0; i<count; i++) {
                    const el = document.createElement('div');
                    const type = Math.random();
                    if(type < 0.6) el.textContent = trees[Math.floor(Math.random() * trees.length)];
                    else if (type < 0.8) el.textContent = rocks[Math.floor(Math.random() * rocks.length)];
                    else el.textContent = flowers[Math.floor(Math.random() * flowers.length)];

                    el.style.position = 'absolute';
                    el.style.fontSize = (1.5 + Math.random()) + 'rem';
                    el.style.filter = 'drop-shadow(2px 4px 6px rgba(0,0,0,0.4))';
                    el.style.left = `${Math.random() * 100}%`;
                    
                    if (align === 'bottom') {
                        el.style.top = `${Math.random() * 10}px`;
                    } else {
                        el.style.bottom = `${Math.random() * 10}px`;
                        el.style.zIndex = '5';
                    }
                    
                    container.appendChild(el);
                }
            }
            
            generateSidewalkProps(containerId) {
                const container = document.getElementById(containerId);
                if (!container) return;
                
                const props = ['ðŸ’¡', 'ðŸ§¯', 'ðŸ—‘ï¸', 'ðŸš²', 'ðŸš', 'ðŸš§'];
                
                // Clear existing props (keep the start/goal text)
                const existingProps = container.querySelectorAll('div');
                existingProps.forEach(p => {
                    if (!p.classList.contains('text-5xl') && !p.classList.contains('text-6xl') && !p.classList.contains('text-white')) {
                        p.remove();
                    }
                });
                
                for(let i=0; i<5; i++) {
                    const el = document.createElement('div');
                    el.textContent = props[Math.floor(Math.random() * props.length)];
                    el.style.fontSize = '1.5rem';
                    el.style.marginBottom = '0.5rem';
                    container.appendChild(el);
                }
            }

            adjustChickenBet(factor) {
                if (this.chickenState.isPlaying) return;
                const betInput = document.getElementById('chickenBetInput');
                let val = parseFloat(betInput.value) * factor;
                if (val < 1) val = 1;
                if (val > this.balance) val = this.balance;
                betInput.value = Math.round(val);
                this.playSound('click');
            }

            updateChickenDifficulty() {
                if (this.chickenState.isPlaying) return;
                const difficulty = document.getElementById('chickenDifficulty').value;
                this.chickenState.difficulty = difficulty;
                this.updateChickenUI();
                this.renderChickenRoadLanes();
                this.playSound('click');
            }

            updateChickenUI() {
                const multipliers = CHICKEN_MULTIPLIERS[this.chickenState.difficulty];
                const nextMultiplier = multipliers[0] || 1.02;
                
                document.getElementById('chickenNextMult').textContent = nextMultiplier.toFixed(2) + 'x';
                document.getElementById('chickenCurrentMult').textContent = this.chickenState.currentMultiplier.toFixed(2) + 'x';
                
                const bet = parseFloat(document.getElementById('chickenBetInput')?.value) || 10;
                const potentialWin = (bet * this.chickenState.currentMultiplier).toFixed(0);
                document.getElementById('chickenCurrentPayout').textContent = potentialWin;
                
                const stepsRemaining = 30 - (this.chickenState.currentStep + 1);
                document.getElementById('chickenStepsRemaining').textContent = stepsRemaining;
                
                // Update action button
                const actionBtn = document.getElementById('chickenActionBtn');
                const balanceDisplay = document.getElementById('chickenBalanceDisplay');
                
                if (balanceDisplay) {
                    balanceDisplay.textContent = this.balance.toLocaleString();
                }
                
                if (this.chickenState.isPlaying) {
                    if (this.chickenState.currentStep === -1) {
                        actionBtn.innerHTML = '<i class="fa-solid fa-play mr-1"></i> Game Starting...';
                        actionBtn.disabled = true;
                        actionBtn.style.background = 'linear-gradient(135deg, #2a3042 0%, #161b26 100%)';
                        actionBtn.style.color = '#6b7280';
                        actionBtn.style.boxShadow = 'none';
                    } else {
                        const currentWin = (bet * this.chickenState.currentMultiplier).toFixed(0);
                        actionBtn.innerHTML = `<i class="fa-solid fa-money-bill-wave mr-1"></i> Cash Out ${currentWin}`;
                        actionBtn.disabled = false;
                        actionBtn.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                        actionBtn.style.color = 'white';
                        actionBtn.style.boxShadow = '0 4px 0 #065f46';
                    }
                } else {
                    actionBtn.innerHTML = '<i class="fa-solid fa-play mr-1"></i> Start Game';
                    actionBtn.disabled = false;
                    actionBtn.style.background = 'linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%)';
                    actionBtn.style.boxShadow = '0 4px 0 #5b21b6';
                    actionBtn.style.color = 'white';
                }
                
                // Update bet input max value
                const betInput = document.getElementById('chickenBetInput');
                if (betInput) {
                    betInput.max = this.balance;
                    betInput.disabled = this.chickenState.isPlaying;
                }
                
                // Update difficulty select
                const difficultySelect = document.getElementById('chickenDifficulty');
                if (difficultySelect) {
                    difficultySelect.disabled = this.chickenState.isPlaying;
                }
            }

            handleChickenAction() {
                if (!this.checkMaintenance()) return;
                
                if (this.chickenState.isPlaying) {
                    this.chickenCashOut();
                } else {
                    this.startChickenGame();
                }
            }

            startChickenGame() {
                if (!this.userId) {
                    this.showToast('Please login to play', 'error');
                    return;
                }

                const betInput = document.getElementById('chickenBetInput');
                const bet = parseInt(betInput.value);

                if (isNaN(bet) || bet <= 0) {
                    this.showToast('Invalid bet amount', 'error');
                    return;
                }

                if (bet > this.balance) {
                    this.showToast('Insufficient funds', 'error');
                    return;
                }

                // Deduct bet
                this.balance -= bet;
                this.updateBalance();
                this.recordWager(bet);

                // Set game state
                this.chickenState.isPlaying = true;
                this.chickenState.bet = bet;
                this.chickenState.currentStep = -1;
                this.chickenState.currentMultiplier = 1.00;

                // Update UI
                this.updateChickenUI();
                this.renderChickenRoadLanes();
                this.updateChickenCamera();

                this.showToast('Game started! Click lanes to cross the road.', 'success');
                this.playSound('click');
            }

            renderChickenRoadLanes() {
                const container = document.getElementById('chickenRoadContainer');
                if (!container) return;
                
                const multipliers = CHICKEN_MULTIPLIERS[this.chickenState.difficulty];
                
                container.innerHTML = '';
                container.className = 'chicken-road-lanes';
                
                // Generate 30 lanes
                for (let i = 0; i < 30; i++) {
                    const lane = document.createElement('div');
                    lane.className = 'chicken-lane';
                    lane.id = `chicken-lane-${i}`;
                    
                    const mult = multipliers[i];
                    const isPassed = i <= this.chickenState.currentStep;
                    const isCurrent = i === this.chickenState.currentStep;
                    const isNext = i === this.chickenState.currentStep + 1;
                    const isFuture = i > this.chickenState.currentStep + 1;
                    
                    // Add lane separator
                    const separator = document.createElement('div');
                    separator.className = 'lane-separator';
                    lane.appendChild(separator);
                    
                    // Add lane number
                    const laneNumber = document.createElement('div');
                    laneNumber.className = 'absolute top-2 left-2 text-[10px] text-white/20 font-bold tracking-widest px-1 rounded';
                    laneNumber.textContent = `LANE ${i + 1}`;
                    lane.appendChild(laneNumber);
                    
                    // Add multiplier display
                    const multDisplay = document.createElement('div');
                    multDisplay.className = 'text-white font-bold text-xl z-20 drop-shadow-md';
                    multDisplay.textContent = `${mult.toFixed(2)}x`;
                    lane.appendChild(multDisplay);
                    
                    // Add cars to future and next lanes (if game is active)
                    if ((isNext || isFuture) && this.chickenState.isPlaying) {
                        const carCount = Math.floor(Math.random() * 2) + 1; // 1-2 cars per lane
                        const trafficContainer = document.createElement('div');
                        trafficContainer.className = "absolute inset-0 pointer-events-none z-0 overflow-hidden";
                        
                        const carColors = ['car-red', 'car-blue', 'car-yellow', 'car-white', 'car-black', 'car-green'];
                        
                        for (let c = 0; c < carCount; c++) {
                            const colorClass = carColors[Math.floor(Math.random() * carColors.length)];
                            const car = document.createElement('div');
                            car.className = "traffic-car";
                            car.innerHTML = `
                                <div class="car-model ${colorClass}">
                                    <div class="car-rear-window"></div>
                                    <div class="car-roof"></div>
                                    <div class="car-windshield"></div>
                                </div>
                            `;
                            
                            const minDuration = 1.2;
                            const maxDuration = 3.5;
                            const duration = minDuration + Math.random() * (maxDuration - minDuration);
                            const baseDelay = (c / carCount) * duration; 
                            const randomOffset = (Math.random() - 0.5) * 0.5;
                            const delay = Math.max(0, baseDelay + randomOffset);
                            
                            car.style.animationDuration = `${duration}s`;
                            car.style.animationDelay = `-${delay}s`;
                            
                            // Slight horizontal wiggle for realism
                            const wiggle = (Math.random() * 60) - 30; 
                            car.style.marginLeft = `${wiggle}px`;
                            
                            trafficContainer.appendChild(car);
                        }
                        lane.appendChild(trafficContainer);
                    }
                    
                    // Set lane state
                    if (isPassed) {
                        if (isCurrent && this.chickenState.isPlaying) {
                            // Current active lane with chicken
                            lane.style.background = 'linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(139, 92, 246, 0.1))';
                            lane.innerHTML += `
                                <div class="absolute inset-0 bg-gradient-to-b from-transparent via-[#8b5cf6]/10 to-transparent animate-pulse"></div>
                                <div class="text-6xl chicken-hop drop-shadow-2xl z-30 filter contrast-125">ðŸ”</div>
                                <div class="mt-6 text-[#8b5cf6] font-black text-2xl drop-shadow-[0_2px_2px_rgba(0,0,0,0.8)] bg-[#0b0e14]/90 px-3 py-1 rounded border border-[#8b5cf6] z-30">${mult.toFixed(2)}x</div>
                            `;
                        } else {
                            // Passed lane
                            lane.style.background = 'rgba(0, 0, 0, 0.1)';
                            lane.style.opacity = '0.6';
                            lane.style.filter = 'grayscale(0.3)';
                            multDisplay.innerHTML = `âœ” ${mult.toFixed(2)}x`;
                            multDisplay.style.color = '#8b5cf6';
                        }
                    } else if (isNext && this.chickenState.isPlaying) {
                        // Next active lane (with cars)
                        lane.style.background = 'linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05))';
                        lane.style.cursor = 'pointer';
                        
                        const potentialWin = (this.chickenState.bet * mult).toFixed(0);
                        lane.innerHTML = `
                            <div class="relative z-20 flex flex-col items-center transition-transform duration-200 group-hover:scale-110">
                                <div class="text-white/90 font-black text-3xl drop-shadow-[0_4px_4px_rgba(0,0,0,0.5)] bg-black/40 rounded-lg px-3 py-1 mb-2 backdrop-blur-sm">${mult.toFixed(2)}x</div>
                                <div class="text-[#10b981] font-bold text-sm bg-black/80 px-3 py-1 rounded-full border border-[#10b981]/50 shadow-lg shadow-[#10b981]/20">Win ${potentialWin}</div>
                            </div>
                            <div class="absolute inset-0 bg-gradient-to-b from-transparent via-white/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none"></div>
                            <div class="absolute bottom-4 text-[10px] text-white/50 uppercase font-bold tracking-widest animate-bounce">Tap to Hop</div>
                        `;
                        
                        lane.onclick = () => this.attemptChickenHop(i);
                    } else {
                        // Future lane (locked with cars)
                        lane.style.background = 'rgba(0, 0, 0, 0.2)';
                        lane.style.opacity = '0.5';
                        lane.style.filter = 'saturate(0.5)';
                        lane.style.cursor = 'not-allowed';
                    }
                    
                    container.appendChild(lane);
                }
                
                // Update camera after rendering lanes
                this.updateChickenCamera();
            }
            
            updateChickenCamera() {
                const camera = document.getElementById('chickenRoadCamera');
                if (!camera) return;
                
                const step = this.chickenState.currentStep;
                const laneWidth = 160; // Width of each lane
                const startWidth = 120; // Width of start sidewalk
                const container = document.querySelector('.chicken-road-container');
                if (!container) return;
                
                const containerWidth = container.clientWidth;
                
                // Calculate target position to center the current lane
                let targetX = 0;
                
                if (step === -1) {
                    // Start position - center the start area
                    targetX = -(startWidth / 2) + (containerWidth / 2);
                } else {
                    // Calculate position to center the current lane
                    const lanesPassed = step + 1; // Include current lane
                    const totalLaneWidthPassed = startWidth + (lanesPassed * laneWidth);
                    const centerOfCurrentLane = totalLaneWidthPassed - (laneWidth / 2);
                    targetX = -centerOfCurrentLane + (containerWidth / 2);
                    
                    // Add a little extra offset to show more of the next lane
                    targetX += laneWidth * 0.3;
                }
                
                // Ensure we don't go past the end
                const worldContainer = document.getElementById('chickenWorldContainer');
                if (worldContainer) {
                    const worldWidth = worldContainer.scrollWidth;
                    const maxOffset = containerWidth - worldWidth;
                    targetX = Math.min(0, Math.max(maxOffset, targetX));
                }
                
                camera.style.transform = `translateX(${targetX}px)`;
            }

            // FIXED: attemptChickenHop method - Complete implementation
            attemptChickenHop(step) {
                if (!this.chickenState.isPlaying || step !== this.chickenState.currentStep + 1) return;

                const difficulty = this.chickenState.difficulty;
                const multipliers = CHICKEN_MULTIPLIERS[difficulty];
                const targetMultiplier = multipliers[step];
                
                // Calculate win probability based on difficulty
                let winProbability;
                switch(difficulty) {
                    case 'easy':
                        winProbability = 0.85 - (step * 0.02); // Starts at 85%, decreases 2% each step
                        break;
                    case 'medium':
                        winProbability = 0.75 - (step * 0.03); // Starts at 75%, decreases 3% each step
                        break;
                    case 'hard':
                        winProbability = 0.65 - (step * 0.04); // Starts at 65%, decreases 4% each step
                        break;
                    case 'expert':
                        winProbability = 0.45 - (step * 0.05); // Starts at 45%, decreases 5% each step
                        break;
                    default:
                        winProbability = 0.85 - (step * 0.02);
                }
                
                // Ensure probability doesn't go below minimum
                winProbability = Math.max(0.05, winProbability);
                
                // Determine if hop is successful
                const isSuccessful = Math.random() < winProbability;
                
                if (isSuccessful) {
                    this.successChickenHop(step, targetMultiplier);
                } else {
                    this.crashChickenGame(step);
                }
            }

            successChickenHop(step, multiplier) {
                this.chickenState.currentStep = step;
                this.chickenState.currentMultiplier = multiplier;
                
                // Play sound
                this.playSound('hop');
                
                // Update UI
                this.updateChickenUI();
                this.renderChickenRoadLanes();
                this.updateChickenCamera();
                
                // Check if reached the end
                if (step === 29) {
                    setTimeout(() => {
                        this.chickenCashOut(true);
                    }, 500);
                }
            }

            crashChickenGame(failedStep) {
                this.chickenState.isPlaying = false;
                
                // Screen shake effect
                document.body.classList.add('shake-screen');
                setTimeout(() => document.body.classList.remove('shake-screen'), 500);
                
                // Show crash animation on the lane
                const lane = document.getElementById(`chicken-lane-${failedStep}`);
                if (lane) {
                    // Add crash car animation
                    const crashCar = document.createElement('div');
                    crashCar.className = 'crash-car-anim';
                    crashCar.innerHTML = `
                        <div class="car-model car-red scale-150 shadow-2xl">
                            <div class="car-rear-window"></div>
                            <div class="car-roof"></div>
                            <div class="car-windshield"></div>
                        </div>
                    `;
                    lane.appendChild(crashCar);
                    
                    // Show chicken getting hit
                    const chickenHit = document.createElement('div');
                    chickenHit.className = 'absolute text-5xl opacity-50 blur-sm grayscale rotate-90 transform translate-y-4 z-40';
                    chickenHit.textContent = 'ðŸ”';
                    lane.appendChild(chickenHit);
                    
                    // Add crash text
                    const crashText = document.createElement('div');
                    crashText.className = 'absolute bottom-1/4 text-red-500 font-bold text-lg bg-black/90 px-4 py-1 rounded border border-red-500 animate-bounce z-40';
                    crashText.textContent = 'CRASH!';
                    lane.appendChild(crashText);
                }
                
                // Record loss
                this.recordLoss(this.chickenState.bet, 'Chicken Road');
                
                // Show toast notification instead of full screen
                this.showToast(`Chicken got hit! Lost ${this.chickenState.bet} coins`, 'error');
                
                // Update UI after a delay to show animation
                setTimeout(() => {
                    this.updateChickenUI();
                    this.renderChickenRoadLanes();
                }, 1000);
                
                this.playSound('lose');
            }

            chickenCashOut(reachedEnd = false) {
                if (!this.chickenState.isPlaying) return;

                const winnings = this.chickenState.bet * this.chickenState.currentMultiplier;
                this.balance += winnings;
                this.chickenState.isPlaying = false;

                // Update balance and record win
                this.updateBalance();
                const profit = winnings - this.chickenState.bet;
                if (profit > 0) {
                    this.recordWin(profit, 'Chicken Road');
                }

                // Show notification
                this.showToast(`Success! Cashed out ${winnings.toFixed(0)} coins!`, 'success');
                this.updateChickenUI();
                this.renderChickenRoadLanes();
                
                // Play win sound and confetti for big wins
                if (profit >= 100) {
                    this.playSound('win');
                    if (profit >= this.bigWinThreshold) {
                        confetti({
                            particleCount: 150,
                            spread: 70,
                            origin: { y: 0.6 }
                        });
                    }
                }
                
                // Special effects for huge wins
                if (profit >= 100000) {
                    // Purple confetti for 100k+ wins
                    confetti({
                        particleCount: 300,
                        spread: 100,
                        origin: { y: 0.6 },
                        colors: ['#8b5cf6', '#7c3aed', '#6d28d9', '#5b21b6']
                    });
                    
                    // Show global alert for 200k+ wins
                    if (profit >= 200000) {
                        this.showGlobalAlert(`${this.username} won ${winnings.toFixed(0)} coins playing Chicken Road!`, 'purple');
                    }
                } else if (profit >= 10000) {
                    // Gold confetti for 10k+ wins
                    confetti({
                        particleCount: 200,
                        spread: 90,
                        origin: { y: 0.6 },
                        colors: ['#f59e0b', '#d97706', '#b45309']
                    });
                }
            }

            // COINFLIP GAME - UPDATED WITH LOWER WIN CHANCES
            renderCoinflip() {
                this.mainContent.innerHTML = `
                    <div class="max-w-6xl mx-auto">
                        <div class="text-center mb-6">
                            <h2 class="text-2xl md:text-3xl font-bold text-white mb-2">Coinflip</h2>
                            <p class="text-gray-400 text-sm">Heads or Tails - Flip to win!</p>
                        </div>
                        
                        <div class="flex flex-col lg:flex-row gap-6">
                            <!-- Left/Center: Game Board -->
                            <div class="flex-1 flex flex-col relative bg-[#0f1923] rounded-2xl border border-[#2a3042] shadow-xl overflow-hidden min-h-[500px]">
                                
                                <!-- Main Game Area -->
                                <div class="flex-1 flex flex-col items-center justify-center relative w-full p-4">
                                    
                                    <!-- Result Overlay -->
                                    <div id="coinflip-result-overlay" class="absolute z-20 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none opacity-0 transition-opacity duration-300">
                                        <span id="coinflip-result-text" class="text-6xl font-black uppercase tracking-widest drop-shadow-[0_4px_4px rgba(0,0,0,0.5)] text-white">WIN</span>
                                    </div>

                                    <!-- The Coin -->
                                    <div class="coin-container mb-8">
                                        <div id="coinflip-coin" class="coin">
                                            <div class="coin-side coin-side-heads">
                                                <i class="fa-solid fa-crown coin-icon"></i>
                                            </div>
                                            <div class="coin-side coin-side-tails">
                                                <i class="fa-solid fa-flag coin-icon"></i>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- In-Game Controls (Heads/Tails Buttons) -->
                                    <div id="coinflip-game-controls" class="flex gap-6 transition-all duration-300 opacity-0 pointer-events-none transform translate-y-4 mb-8">
                                        <button onclick="app.coinflipFlip('heads')" id="coinflip-btn-head-select" class="coinflip-side-btn group relative w-32 h-32 rounded-full bg-gradient-to-b from-[#1e293b] to-[#0f172a] border-4 border-[#334155] hover:border-[#f59e0b] hover:shadow-[0_0_20px_rgba(245,158,11,0.4)] flex flex-col items-center justify-center gap-2 transition-all">
                                            <div class="w-12 h-12 rounded-full bg-[#f59e0b] shadow-inner flex items-center justify-center text-yellow-900 font-bold text-xl">H</div>
                                            <span class="font-bold text-gray-300 group-hover:text-[#f59e0b] uppercase tracking-wide">Heads</span>
                                        </button>
                                        
                                        <button onclick="app.coinflipFlip('tails')" id="coinflip-btn-tail-select" class="coinflip-side-btn group relative w-32 h-32 rounded-full bg-gradient-to-b from-[#1e293b] to-[#0f172a] border-4 border-[#334155] hover:border-gray-400 hover:shadow-[0_0_20px_rgba(156,163,175,0.4)] flex flex-col items-center justify-center gap-2 transition-all">
                                            <div class="w-12 h-12 rounded-full bg-gray-300 shadow-inner flex items-center justify-center text-gray-800 font-bold text-xl">T</div>
                                            <span class="font-bold text-gray-300 group-hover:text-white uppercase tracking-wide">Tails</span>
                                        </button>
                                    </div>
                                    
                                    <div id="coinflip-waiting-message" class="text-gray-500 font-medium animate-pulse">
                                        Press Start to play
                                    </div>

                                </div>

                                <!-- History & Multiplier Roadmap (Bottom) -->
                                <div class="w-full bg-[#0f1923] border-t border-[#2a3042] p-4">
                                    <div class="max-w-4xl mx-auto">
                                        <div class="flex items-center gap-2 mb-2 text-xs font-bold text-gray-500 uppercase tracking-wider">
                                            <span>Round History</span>
                                            <div class="h-px bg-[#2a3042] flex-1"></div>
                                        </div>
                                        
                                        <!-- History Icons -->
                                        <div id="coinflip-history-row" class="flex gap-3 mb-4 h-10 items-center overflow-x-auto scrollbar-hide">
                                            <span class="text-gray-600 text-sm italic">No flips yet...</span>
                                        </div>

                                        <!-- Multiplier Roadmap -->
                                        <div class="relative pt-4">
                                            <div class="absolute top-0 left-0 w-full h-px bg-[#2a3042]"></div>
                                            <div id="coinflip-multiplier-roadmap" class="flex justify-between text-xs font-mono text-gray-400">
                                                <div class="text-center relative">
                                                    <div class="coinflip-roadmap-dot absolute -top-5 left-1/2 -translate-x-1/2 w-2 h-2 rounded-full bg-gray-600"></div>
                                                    <span>1.85Ã—</span>
                                                </div>
                                                <div class="text-center relative">
                                                    <div class="coinflip-roadmap-dot absolute -top-5 left-1/2 -translate-x-1/2 w-2 h-2 rounded-full bg-[#2a3042]"></div>
                                                    <span>3.42Ã—</span>
                                                </div>
                                                <div class="text-center relative">
                                                    <div class="coinflip-roadmap-dot absolute -top-5 left-1/2 -translate-x-1/2 w-2 h-2 rounded-full bg-[#2a3042]"></div>
                                                    <span>6.33Ã—</span>
                                                </div>
                                                <div class="text-center relative">
                                                    <div class="coinflip-roadmap-dot absolute -top-5 left-1/2 -translate-x-1/2 w-2 h-2 rounded-full bg-[#2a3042]"></div>
                                                    <span>11.71Ã—</span>
                                                </div>
                                                <div class="text-center relative">
                                                    <div class="coinflip-roadmap-dot absolute -top-5 left-1/2 -translate-x-1/2 w-2 h-2 rounded-full bg-[#2a3042]"></div>
                                                    <span>21.67Ã—</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Right: Control Panel -->
                            <div class="w-full lg:w-[350px] bg-[#1a242d] flex flex-col rounded-2xl border border-[#2a3042] shadow-2xl relative z-30">
                                
                                <!-- Balance Header -->
                                <div class="p-6 bg-[#212b36] border-b border-[#2a3042] rounded-t-2xl">
                                    <div class="text-gray-400 text-xs font-bold uppercase tracking-wider mb-1">Balance</div>
                                    <div class="flex items-center gap-1">
                                        <span class="text-[#10b981] font-bold text-lg">$</span>
                                        <span id="coinflip-balance-display" class="text-2xl font-mono font-bold text-white">${this.balance.toLocaleString()}</span>
                                    </div>
                                </div>

                                <!-- Controls Content -->
                                <div class="p-6 flex-1 flex flex-col gap-6">
                                    
                                    <!-- Bet Input Section -->
                                    <div id="coinflip-bet-controls" class="space-y-4">
                                        <div class="space-y-1">
                                            <label class="text-xs text-gray-400 font-bold uppercase tracking-wide">Bet Amount</label>
                                            <div class="flex bg-[#0f1923] border border-[#2a3042] rounded overflow-hidden focus-within:border-[#10b981] focus-within:ring-1 focus-within:ring-[#10b981]">
                                                <span class="px-4 py-3 text-gray-400 font-bold select-none border-r border-[#2a3042] bg-[#151e26]">$</span>
                                                <input type="number" id="coinflip-bet-input" value="10" min="0.01" step="0.01" class="w-full bg-transparent text-white font-mono p-3 outline-none">
                                            </div>
                                            
                                            <!-- Quick Bet Buttons -->
                                            <div class="grid grid-cols-4 gap-2 mt-2">
                                                <button onclick="app.coinflipAdjustBet(0.5)" class="bg-[#2a3042] hover:bg-[#374151] text-gray-300 text-xs font-bold py-2 rounded transition-all duration-300 touch-button">1/2</button>
                                                <button onclick="app.coinflipAdjustBet(2)" class="bg-[#2a3042] hover:bg-[#374151] text-gray-300 text-xs font-bold py-2 rounded transition-all duration-300 touch-button">2x</button>
                                                <button onclick="app.coinflipSetBet(10)" class="bg-[#2a3042] hover:bg-[#374151] text-gray-300 text-xs font-bold py-2 rounded transition-all duration-300 touch-button">Min</button>
                                                <button onclick="app.coinflipSetBet(${this.balance})" class="bg-[#2a3042] hover:bg-[#374151] text-gray-300 text-xs font-bold py-2 rounded transition-all duration-300 touch-button">Max</button>
                                            </div>
                                        </div>

                                        <button id="coinflip-btn-start" onclick="app.coinflipStartGame()" class="btn-primary w-full py-4 rounded-xl font-bold text-xl tracking-wide mt-4 touch-button">
                                            Start Game
                                        </button>
                                    </div>

                                    <!-- Active Game Stats -->
                                    <div id="coinflip-active-game-stats" class="hidden flex-col gap-4">
                                        <div class="bg-[#0f1923] p-4 rounded border border-[#2a3042] space-y-3">
                                            <div class="flex justify-between items-center">
                                                <span class="text-gray-400 text-xs uppercase font-bold">Current Streak</span>
                                                <span id="coinflip-streak-display" class="font-mono text-white font-bold">0</span>
                                            </div>
                                            <div class="flex justify-between items-center">
                                                <span class="text-gray-400 text-xs uppercase font-bold">Multiplier</span>
                                                <span id="coinflip-multiplier-display" class="font-mono text-[#f59e0b] font-bold">1.00Ã—</span>
                                            </div>
                                            <div class="w-full h-px bg-[#2a3042] my-2"></div>
                                            <div class="flex justify-between items-center">
                                                <span class="text-gray-400 text-xs uppercase font-bold">Profit on Win</span>
                                                <span id="coinflip-profit-display" class="font-mono text-[#10b981] font-bold">$0.00</span>
                                            </div>
                                        </div>

                                        <div class="text-center space-y-2 mt-4">
                                            <div class="text-xs text-gray-500 font-bold uppercase">Total Accumulated</div>
                                            <div id="coinflip-accumulated-display" class="text-3xl font-mono font-bold text-white">$0.00</div>
                                        </div>

                                        <button id="coinflip-btn-cashout" onclick="app.coinflipCashOut()" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white font-bold text-xl py-4 rounded-xl shadow-lg hover:scale-[1.02] transition-all duration-300 uppercase tracking-wide mt-auto touch-button">
                                            Cash Out
                                        </button>
                                    </div>

                                    <!-- Footer Info -->
                                    <div class="mt-auto text-center pt-6">
                                        <p class="text-[10px] text-gray-600 font-medium uppercase tracking-widest">
                                            Moon Casino
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Reset coinflip state
                this.coinflipState.isGameActive = false;
                this.coinflipState.isFlipping = false;
                this.coinflipState.currentBet = 0;
                this.coinflipState.accumulatedValue = 0;
                this.coinflipState.streak = 0;
                this.coinflipState.history = [];
                this.coinflipState.coinRotation = 0;
            }

            // Coinflip Game Functions
            updateCoinflipUI() {
                const balanceDisplay = document.getElementById('coinflip-balance-display');
                if (balanceDisplay) {
                    balanceDisplay.textContent = this.balance.toLocaleString();
                }
                
                if (this.coinflipState.isGameActive) {
                    const streakDisplay = document.getElementById('coinflip-streak-display');
                    const multiplierDisplay = document.getElementById('coinflip-multiplier-display');
                    const profitDisplay = document.getElementById('coinflip-profit-display');
                    const accumulatedDisplay = document.getElementById('coinflip-accumulated-display');
                    
                    if (streakDisplay) streakDisplay.textContent = this.coinflipState.streak;
                    
                    const currentMult = (this.coinflipState.accumulatedValue / this.coinflipState.currentBet) || 1;
                    if (multiplierDisplay) multiplierDisplay.textContent = `${currentMult.toFixed(2)}Ã—`;
                    
                    const nextVal = this.coinflipState.accumulatedValue * this.coinflipState.HOUSE_EDGE;
                    const profit = nextVal - this.coinflipState.accumulatedValue;
                    if (profitDisplay) profitDisplay.textContent = `+$${profit.toFixed(2)}`;
                    if (accumulatedDisplay) accumulatedDisplay.textContent = `$${this.coinflipState.accumulatedValue.toFixed(2)}`;
                }
            }

            coinflipStartGame() {
                if (!this.checkMaintenance()) return;
                
                if (!this.userId) {
                    this.showToast('Please login to play', 'error');
                    return;
                }

                const betInput = document.getElementById('coinflip-bet-input');
                const betAmount = parseFloat(betInput.value);

                if (isNaN(betAmount) || betAmount <= 0) {
                    this.showToast("Please enter a valid bet amount.", "error");
                    return;
                }
                if (betAmount > this.balance) {
                    this.showToast("Insufficient balance.", "error");
                    return;
                }

                // Deduct initial bet
                this.balance -= betAmount;
                this.updateBalance();
                this.recordWager(betAmount);

                // Set Game State
                this.coinflipState.isGameActive = true;
                this.coinflipState.currentBet = betAmount;
                this.coinflipState.accumulatedValue = betAmount;
                this.coinflipState.streak = 0;
                this.coinflipState.history = [];

                // UI Updates
                const betControls = document.getElementById('coinflip-bet-controls');
                const activeGameStats = document.getElementById('coinflip-active-game-stats');
                const gameControls = document.getElementById('coinflip-game-controls');
                const waitingMessage = document.getElementById('coinflip-waiting-message');
                const btnStart = document.getElementById('coinflip-btn-start');

                if (betControls) betControls.classList.add('hidden');
                if (activeGameStats) {
                    activeGameStats.classList.remove('hidden');
                    activeGameStats.classList.add('flex');
                }
                
                if (waitingMessage) waitingMessage.classList.add('hidden');
                if (gameControls) {
                    gameControls.classList.remove('hidden', 'opacity-0', 'pointer-events-none');
                    gameControls.classList.add('opacity-100', 'pointer-events-auto');
                }
                
                if (btnStart) {
                    btnStart.textContent = 'Game Active';
                    btnStart.classList.remove('btn-primary');
                    btnStart.classList.add('bg-[#2a3042]', 'text-gray-400', 'cursor-not-allowed');
                }

                this.coinflipClearHistoryUI();
                this.coinflipUpdateRoadmap();
                this.updateCoinflipUI();
                this.playSound('click');
            }

            coinflipFlip(choice) {
                if (!this.coinflipState.isGameActive || this.coinflipState.isFlipping) return;

                this.coinflipState.isFlipping = true;
                
                const gameControls = document.getElementById('coinflip-game-controls');
                if (gameControls) {
                    gameControls.style.pointerEvents = 'none';
                    gameControls.style.opacity = '0.5';
                }

                // Determine actual coin result (heads or tails)
                const random = Math.random();
                const result = random < 0.5 ? 'heads' : 'tails'; // 50/50 for heads/tails
                
                // Check if player's choice matches the result
                const isWin = (choice === result);

                // Animate Coin
                const coinElement = document.getElementById('coinflip-coin');
                const spins = 5;
                const degreesPerSpin = 360;
                const targetOffset = result === 'heads' ? 0 : 180;
                
                let nextRotation = this.coinflipState.coinRotation + (spins * degreesPerSpin);
                const remainder = nextRotation % 360;
                const adjustment = targetOffset - remainder;
                nextRotation += adjustment;

                if (nextRotation <= this.coinflipState.coinRotation) nextRotation += 360;

                this.coinflipState.coinRotation = nextRotation;
                coinElement.style.transform = `rotateY(${this.coinflipState.coinRotation}deg)`;

                // Wait for animation
                setTimeout(() => {
                    this.coinflipHandleResult(result, isWin);
                }, 1000);
            }

            coinflipHandleResult(resultSide, isWin) {
                this.coinflipState.isFlipping = false;
                const gameControls = document.getElementById('coinflip-game-controls');
                if (gameControls) {
                    gameControls.style.pointerEvents = 'auto';
                    gameControls.style.opacity = '1';
                }

                // Add to history
                this.coinflipAddToHistory(resultSide);

                if (isWin) {
                    // Win logic
                    this.coinflipState.streak++;
                    this.coinflipState.accumulatedValue = this.coinflipState.accumulatedValue * this.coinflipState.HOUSE_EDGE;
                    
                    this.coinflipShowResultOverlay("WIN", "text-[#10b981]");
                    this.coinflipUpdateRoadmap();
                    this.playSound('win');
                } else {
                    // Loss logic
                    this.coinflipState.accumulatedValue = 0;
                    this.coinflipShowResultOverlay("LOSS", "text-[#ef4444]");
                    this.playSound('lose');
                    
                    // End Game automatically on loss
                    setTimeout(() => this.coinflipEndGame(), 1000);
                }

                this.updateCoinflipUI();
            }

            coinflipCashOut() {
                if (!this.coinflipState.isGameActive) return;

                const winnings = this.coinflipState.accumulatedValue;
                this.balance += winnings;
                this.updateBalance();
                
                const profit = winnings - this.coinflipState.currentBet;
                if (profit > 0) {
                    this.recordWin(profit, 'Coinflip');
                    if (profit >= this.bigWinThreshold) {
                        confetti({
                            particleCount: 150,
                            spread: 70,
                            origin: { y: 0.6 }
                        });
                    }
                }
                
                this.coinflipShowResultOverlay(`+$${winnings.toFixed(2)}`, "text-[#f59e0b]");
                this.coinflipEndGame();
                this.playSound('win');
                
                // Special effects for huge wins
                if (profit >= 100000) {
                    // Purple confetti for 100k+ wins
                    confetti({
                        particleCount: 300,
                        spread: 100,
                        origin: { y: 0.6 },
                        colors: ['#8b5cf6', '#7c3aed', '#6d28d9', '#5b21b6']
                    });
                    
                    // Show global alert for 200k+ wins
                    if (profit >= 200000) {
                        this.showGlobalAlert(`${this.username} won ${winnings.toFixed(2)} coins playing Coinflip!`, 'purple');
                    }
                } else if (profit >= 10000) {
                    // Gold confetti for 10k+ wins
                    confetti({
                        particleCount: 200,
                        spread: 90,
                        origin: { y: 0.6 },
                        colors: ['#f59e0b', '#d97706', '#b45309']
                    });
                }
            }

            coinflipEndGame() {
                this.coinflipState.isGameActive = false;
                this.coinflipState.streak = 0;
                this.coinflipState.currentBet = 0;
                this.coinflipState.accumulatedValue = 0;

                // Reset UI
                const betControls = document.getElementById('coinflip-bet-controls');
                const activeGameStats = document.getElementById('coinflip-active-game-stats');
                const gameControls = document.getElementById('coinflip-game-controls');
                const waitingMessage = document.getElementById('coinflip-waiting-message');
                const btnStart = document.getElementById('coinflip-btn-start');

                if (betControls) betControls.classList.remove('hidden');
                if (activeGameStats) {
                    activeGameStats.classList.add('hidden');
                    activeGameStats.classList.remove('flex');
                }

                if (gameControls) {
                    gameControls.classList.add('hidden', 'opacity-0', 'pointer-events-none');
                    gameControls.classList.remove('opacity-100', 'pointer-events-auto');
                }
                if (waitingMessage) waitingMessage.classList.remove('hidden');
                
                if (btnStart) {
                    btnStart.textContent = 'Start Game';
                    btnStart.classList.add('btn-primary');
                    btnStart.classList.remove('bg-[#2a3042]', 'text-gray-400', 'cursor-not-allowed');
                }
            }

            coinflipAdjustBet(multiplier) {
                const betInput = document.getElementById('coinflip-bet-input');
                if (!betInput) return;
                
                let val = parseFloat(betInput.value) || 0;
                val = val * multiplier;
                betInput.value = val.toFixed(2);
                this.playSound('click');
            }

            coinflipSetBet(amount) {
                const betInput = document.getElementById('coinflip-bet-input');
                if (betInput) {
                    betInput.value = Math.min(amount, this.balance).toFixed(2);
                    this.playSound('click');
                }
            }

            coinflipShowResultOverlay(text, colorClass) {
                const resultOverlay = document.getElementById('coinflip-result-overlay');
                const resultText = document.getElementById('coinflip-result-text');
                
                if (!resultOverlay || !resultText) return;
                
                resultText.textContent = text;
                resultText.className = `text-6xl font-black uppercase tracking-widest drop-shadow-[0_4px_4px_rgba(0,0,0,0.5)] ${colorClass}`;
                
                resultOverlay.classList.remove('opacity-0');
                resultOverlay.style.transform = 'translate(-50%, -50%) scale(1.2)';
                
                setTimeout(() => {
                    resultOverlay.classList.add('opacity-0');
                    resultOverlay.style.transform = 'translate(-50%, -50%) scale(1)';
                }, 800);
            }

            coinflipAddToHistory(side) {
                const historyRow = document.getElementById('coinflip-history-row');
                if (!historyRow) return;
                
                this.coinflipState.history.push(side);
                
                if (this.coinflipState.history.length === 0) {
                    historyRow.innerHTML = '';
                }
                
                const item = document.createElement('div');
                item.className = 'coinflip-history-item flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs border-2';
                
                if (side === 'heads') {
                    item.classList.add('bg-[#f59e0b]', 'border-[#d97706]', 'text-yellow-900');
                    item.textContent = 'H';
                } else {
                    item.classList.add('bg-gray-400', 'border-gray-300', 'text-gray-900');
                    item.textContent = 'T';
                }
                
                historyRow.appendChild(item);
                historyRow.scrollLeft = historyRow.scrollWidth;
            }

            coinflipClearHistoryUI() {
                const historyRow = document.getElementById('coinflip-history-row');
                if (historyRow) {
                    historyRow.innerHTML = '<span class="text-gray-600 text-sm italic">No flips yet...</span>';
                }
            }

            coinflipUpdateRoadmap() {
                const roadmap = document.getElementById('coinflip-multiplier-roadmap');
                if (!roadmap) return;
                
                const startStreak = this.coinflipState.streak;
                let html = '';
                
                for (let i = 1; i <= 5; i++) {
                    const stepIndex = startStreak + i;
                    const multiplier = Math.pow(this.coinflipState.HOUSE_EDGE, stepIndex);
                    
                    html += `
                        <div class="text-center relative flex flex-col items-center">
                            <div class="coinflip-roadmap-dot w-2 h-2 rounded-full mb-2 ${i === 1 ? 'active' : 'bg-[#2a3042]'}"></div>
                            <span class="${i === 1 ? 'text-white font-bold' : 'text-gray-500'}">${multiplier.toFixed(2)}Ã—</span>
                        </div>
                    `;
                }
                
                roadmap.innerHTML = html;
            }

            // LEADERBOARD - Only show top 3 richest players
            async renderLeaderboard() {
                this.mainContent.innerHTML = `
                    <div class="max-w-6xl mx-auto">
                        <div class="text-center mb-6">
                            <h2 class="text-2xl md:text-3xl font-bold text-white mb-3">Leaderboard</h2>
                            <p class="text-gray-400 text-sm">Top 3 richest players</p>
                        </div>
                        
                        <div id="leaderboardContent" class="space-y-4">
                            <div class="text-center py-8">
                                <div class="loading-spinner mx-auto mb-3"></div>
                                <p class="text-gray-400 text-sm">Loading leaderboard...</p>
                            </div>
                        </div>
                    </div>
                `;
                
                await this.loadLeaderboard();
            }

            async loadLeaderboard() {
                try {
                    const snapshot = await database.ref('users').orderByChild('balance').limitToLast(100).once('value');
                    const users = [];

                    snapshot.forEach(child => {
                        const user = child.val();
                        if (user.username) { // Only include users with usernames
                            users.push({
                                username: user.username,
                                balance: user.balance || 0,
                                userId: user.userId,
                                totalWins: user.totalWins || 0,
                                biggestWin: user.biggestWin || 0
                            });
                        }
                    });

                    // Sort by balance (highest first)
                    users.sort((a, b) => b.balance - a.balance);
                    
                    // Take top 3
                    const topPlayers = users.slice(0, 3);
                    
                    // Find current user's position
                    let userPosition = -1;
                    let userData = null;
                    
                    if (this.userId) {
                        userPosition = users.findIndex(u => u.userId === this.userId);
                        if (userPosition !== -1) {
                            userData = users[userPosition];
                        }
                    }

                    // Display leaderboard
                    const leaderboardContent = document.getElementById('leaderboardContent');
                    leaderboardContent.innerHTML = '';

                    // Add top 3 players with medals
                    const medals = ['ðŸ¥‡', 'ðŸ¥ˆ', 'ðŸ¥‰'];
                    
                    topPlayers.forEach((player, index) => {
                        const div = document.createElement('div');
                        div.className = 'leaderboard-item';
                        
                        div.innerHTML = `
                            <div class="flex items-center gap-4 w-full">
                                <div class="text-2xl md:text-3xl font-bold w-10 md:w-12">${medals[index]}</div>
                                <div class="flex-1">
                                    <div class="text-white font-bold text-base md:text-lg">${player.username}</div>
                                    <div class="text-gray-400 text-xs md:text-sm">
                                        Wins: ${player.totalWins} | Biggest Win: ${player.biggestWin || 0}
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-xl md:text-2xl font-bold text-[#10b981]">${player.balance.toLocaleString()} coins</div>
                                    <div class="text-gray-400 text-xs mt-1">Balance</div>
                                </div>
                            </div>
                        `;
                        
                        // Highlight current user
                        if (player.userId === this.userId) {
                            div.style.borderColor = '#8b5cf6';
                            div.style.background = 'linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(139, 92, 246, 0.05))';
                            div.innerHTML += '<div class="absolute top-2 right-2 text-xs bg-[#8b5cf6] text-white px-2 py-1 rounded-full">YOU</div>';
                        }
                        
                        leaderboardContent.appendChild(div);
                    });

                    // Show user's position if not in top 3
                    if (userPosition !== -1 && userPosition >= 3) {
                        const userDiv = document.createElement('div');
                        userDiv.className = 'leaderboard-item mt-6';
                        userDiv.style.borderColor = '#8b5cf6';
                        userDiv.style.background = 'linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(139, 92, 246, 0.05))';
                        
                        userDiv.innerHTML = `
                            <div class="flex items-center gap-4 w-full">
                                <div class="text-lg md:text-xl font-bold w-10 md:w-12">#${userPosition + 1}</div>
                                <div class="flex-1">
                                    <div class="text-white font-bold text-base md:text-lg flex items-center gap-2">
                                        ${userData.username}
                                        <span class="text-xs bg-[#8b5cf6] text-white px-2 py-1 rounded-full">YOU</span>
                                    </div>
                                    <div class="text-gray-400 text-xs md:text-sm">
                                        Wins: ${userData.totalWins} | Biggest Win: ${userData.biggestWin || 0}
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-lg md:text-xl font-bold text-[#10b981]">${userData.balance.toLocaleString()} coins</div>
                                    <div class="text-gray-400 text-xs mt-1">Your Balance</div>
                                </div>
                            </div>
                            <div class="text-center mt-3 text-sm text-gray-400">
                                You are #${userPosition + 1} on the leaderboard
                            </div>
                        `;
                        
                        leaderboardContent.appendChild(userDiv);
                    }

                    if (users.length === 0) {
                        leaderboardContent.innerHTML = '<div class="text-center py-8 text-gray-400">No players yet</div>';
                    }
                } catch (error) {
                    console.error('Error loading leaderboard:', error);
                    leaderboardContent.innerHTML = '<div class="text-center py-8 text-red-400">Error loading leaderboard</div>';
                }
            }
        }

        // Initialize the app
        const app = new GameApp();
        
        // ADMIN FUNCTIONS - Can be called from browser console
        window.enableMaintenance = (minutes = 30) => app.enableMaintenance(minutes);
        window.disableMaintenance = () => app.disableMaintenance();
        window.checkMaintenance = () => console.log('Maintenance mode:', app.maintenanceMode);
    </script>
</body>
</html>
